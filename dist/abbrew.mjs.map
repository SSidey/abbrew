{"version":3,"file":"abbrew.mjs","sources":["../module/helpers/dice.mjs","../module/documents/attackprofile.mjs","../module/rules/rules-data/abbrew-rule.mjs","../module/helpers/config.mjs","../module/rules/rules-data/active-effect.mjs","../module/rules/choice-set-prompt.mjs","../module/rules/rules-data/choice-set.mjs","../module/rules/rule-field.mjs","../module/rules/rule-source.mjs","../module/rules/rules.mjs","../module/helpers/write-to-path.mjs","../module/documents/actor.mjs","../module/documents/item.mjs","../module/helpers/chat.mjs","../module/helpers/effects.mjs","../module/sheets/actor-sheet.mjs","../node_modules/@yaireo/tagify/dist/tagify.min.js","../module/sheets/item-sheet.mjs","../module/sheets/item-anatomy-sheet.mjs","../module/helpers/templates.mjs","../module/helpers/abbrew-roll.mjs","../module/helpers/turn-start.mjs","../module/abbrew.mjs"],"sourcesContent":["export async function d10Roll({\r\n    parts = [], data = {}, title,\r\n    flavour, dialogOptions, messageData = {}, options = {},\r\n    chatMessage = true, rollMode, flavor\r\n}) {\r\n\r\n    // TODO: Set up concept page, maybe under conditions?\r\n    // TODO: Negate should be an int value so as not to be too strong.\r\n    let dice = 1 + data.amplification;\r\n    let weakness = 0 + data.weakness\r\n\r\n    dice = '' + dice;\r\n    weakness = '' + weakness;\r\n\r\n    const fullParts = ['{' + dice + 'd10x>=' + data.criticalThreshold, ...parts];\r\n\r\n    const formula = fullParts.join('+') + ' -' + weakness + 'd10, 0}kh';\r\n\r\n    const defaultRollMode = rollMode || game.settings.get(\"core\", \"rollMode\");\r\n\r\n    const rollOptions = foundry.utils.mergeObject(options, {\r\n        flavor: flavor || title,\r\n        defaultRollMode,\r\n        rollMode\r\n    });\r\n\r\n    const roll = new CONFIG.Dice.AbbrewRoll(formula, data);\r\n\r\n    const configured = await roll.configureDialog({ title: \"Additional Modifiers\" });\r\n\r\n    await roll.evaluate({ async: true });\r\n\r\n    messageData = {};\r\n    messageData.flags = { data: data };\r\n\r\n    await roll.toMessage(messageData);\r\n}","import { d10Roll } from \"../helpers/dice.mjs\";\r\n\r\nHooks.on('init', () => {\r\n  $(document).on('click', '.damage-application button', onDamageAccept);\r\n});\r\n\r\nexport class AbbrewAttackProfile {\r\n  id = \"\";\r\n  abilityModifier = \"\";\r\n  damageBase = 0;\r\n  isWeapon = false;\r\n  weapon = {};\r\n  isMagic = false;\r\n  magic = {};\r\n\r\n  constructor(id, abilityModifier, damageBase, isWeapon, weapon, isMagic, magic) {\r\n    this.id = id;\r\n    this.abilityModifier = abilityModifier;\r\n    this.damageBase = damageBase;\r\n    this.isWeapon = isWeapon;\r\n    this.weapon = weapon;\r\n    this.isMagic = isMagic;\r\n    this.magic = magic;\r\n  }\r\n}\r\n\r\nexport async function useAttack(attack, attackProfile, actor) {\r\n\r\n  let title = `${attack.name} - ${game.i18n.localize(\"ABBREW.AttackRoll\")}`;\r\n\r\n  const rollData = getRollData(actor, attack, attackProfile);\r\n\r\n  // HERE: Look at skill rolls in 5e\r\n  // TODO: FUCKER WAS COMING FROM HERE\r\n  rollData.mod = 10;\r\n\r\n  // Compose roll options\r\n  const rollConfig = {\r\n    parts: [attackProfile.abilityModifier, '@attackProfile.damageBase'],\r\n    data: rollData,\r\n    title,\r\n    flavour: title,\r\n    dialogOptions: {\r\n      width: 400,\r\n      top: null,\r\n      left: window.innerWidth - 710\r\n    },\r\n    messageData: {\r\n      \"flags.abbrew.roll\": { type: \"attack\", attack: attack.id, attackProfile: attackProfile.id },\r\n      speaker: ChatMessage.getSpeaker({ actor: actor })\r\n    },\r\n    options: {\r\n      \"damageType\": attackProfile.damageType\r\n    }\r\n  };\r\n\r\n  const roll = await d10Roll(rollConfig);\r\n\r\n  return roll;\r\n}\r\n\r\nfunction getRollData(actor, attack, attackProfile) {\r\n  // If present, return the actor's roll data.\r\n  if (!actor) return null;\r\n  const rollData = actor.getRollData();\r\n  // Grab the item's system data as well.\r\n  rollData.attack = foundry.utils.deepClone(attack);\r\n  rollData.attackProfile = foundry.utils.deepClone(attackProfile);\r\n  rollData.criticalThreshold = getCriticalThreshold(actor, attackProfile);\r\n  rollData.amplification = getAmplification(actor, attackProfile);\r\n  rollData.weakness = getWeakness(actor, attackProfile);\r\n\r\n  return rollData;\r\n}\r\n\r\nfunction getCriticalThreshold(actor, attackProfile) {\r\n  const weaponThreshold = attackProfile.weapon.criticalThreshold;\r\n  const damageType = attackProfile.weapon.damageType;\r\n  const globalThreshold = actor.system.concepts['attack'].criticalThreshold;\r\n  let damageTypeThreshold = 10;\r\n  if (actor.system.concepts[damageType]) {\r\n    damageTypeThreshold = actor.system.concepts[damageType].criticalThreshold;\r\n  }\r\n\r\n  const calculatedThreshold = Math.min(weaponThreshold, globalThreshold, damageTypeThreshold)\r\n\r\n  // ABBREW: Minimum critical threshold is 5.\r\n  return Math.max(calculatedThreshold, 5);\r\n}\r\n\r\nfunction getAmplification(actor, attackProfile) {\r\n  const damageType = attackProfile.weapon.damageType;\r\n  return actor.system.concepts[damageType] ? actor.system.concepts[damageType].amplification : 0;\r\n}\r\n\r\nfunction getWeakness(actor, attackProfile) {\r\n  const damageType = attackProfile.weapon.damageType;\r\n  return actor.system.concepts[damageType] ? actor.system.concepts[damageType].weakness : 0;\r\n}\r\n\r\nasync function oold() {\r\n  let options = {};\r\n\r\n  // Ensure the options object is ready\r\n  options = foundry.utils.mergeObject({\r\n    configureDialog: true,\r\n    createMessage: true,\r\n    // \"flags.abbrew.use\": { type: this.type, itemId: this.id, itemUuid: this.uuid }\r\n  }, options);\r\n\r\n  const card = await displayCard(options, attack, attackProfile, actor);\r\n\r\n  return card;\r\n}\r\n\r\nasync function displayCard(options = {}, attack, attackProfile, actor) {\r\n\r\n  // Render the chat card template\r\n  const token = actor.token;\r\n  const templateData = {\r\n    actor: actor,\r\n    tokenId: token?.uuid || null,\r\n    item: this,\r\n    data: { attack, attackProfile },\r\n    labels: \"\",\r\n    hasAttack: true,\r\n    isHealing: false,\r\n    hasDamage: true,\r\n    isVersatile: false,\r\n    isSpell: false,\r\n    hasSave: false,\r\n    hasAreaTarget: false,\r\n    isTool: false,\r\n    hasAbilityCheck: false\r\n  };\r\n\r\n  // Handle passed data / don't look for item\r\n  const html = await renderTemplate(\"systems/abbrew/templates/chat/attack-card.hbs\", templateData);\r\n\r\n  // Create the ChatMessage data object\r\n  const chatData = {\r\n    user: game.user.id,\r\n    type: CONST.CHAT_MESSAGE_TYPES.OTHER,\r\n    content: html,\r\n    flavor: attack.name,\r\n    speaker: ChatMessage.getSpeaker({ actor: actor, token }),\r\n    flags: { \"core.canPopout\": true }\r\n  };\r\n\r\n  // If the Item was destroyed in the process of displaying its card - embed the item data in the chat message\r\n  //   if ( (this.type === \"consumable\") && !this.actor.items.has(this.id) ) {\r\n  //     chatData.flags[\"abbrew.itemData\"] = templateData.item.toObject();\r\n  //   }\r\n\r\n  // Merge in the flags from options\r\n  chatData.flags = foundry.utils.mergeObject(chatData.flags, options.flags);\r\n\r\n  /**\r\n   * A hook event that fires before an item chat card is created.\r\n   * @function abbrew.preDisplayCard\r\n   * @memberof hookEvents\r\n   * @param {Item5e} item             Item for which the chat card is being displayed.\r\n   * @param {object} chatData         Data used to create the chat message.\r\n   * @param {ItemUseOptions} options  Options which configure the display of the item chat card.\r\n   */\r\n  Hooks.callAll(\"abbrew.preDisplayCard\", this, chatData, options);\r\n\r\n  // Apply the roll mode to adjust message visibility\r\n  // ChatMessage.applyRollMode(chatData, options.rollMode ?? game.settings.get(\"core\", \"rollMode\"));\r\n\r\n  // const options = { createMessage: true };\r\n\r\n  // Create the Chat Message or return its data\r\n  const card = (options.createMessage !== false) ? await ChatMessage.create(chatData) : chatData;\r\n\r\n  /**\r\n   * A hook event that fires after an item chat card is created.\r\n   * @function abbrew.displayCard\r\n   * @memberof hookEvents\r\n   * @param {Item5e} item              Item for which the chat card is being displayed.\r\n   * @param {ChatMessage|object} card  The created ChatMessage instance or ChatMessageData depending on whether\r\n   *                                   options.createMessage was set to `true`.\r\n   */\r\n  Hooks.callAll(\"abbrew.displayCard\", this, card);\r\n\r\n  return card;\r\n}\r\n\r\nasync function onDamageAccept(event) {\r\n  console.log(event);\r\n  // Extract card data\r\n  const button = event.currentTarget;\r\n  const card = button.closest(\".chat-message\");\r\n  const messageId = card.closest(\".message\").dataset.messageId;\r\n  const message = game.messages.get(messageId);\r\n  const tokens = canvas.tokens.controlled.filter((token) => token.actor);\r\n  await tokens[0].actor.acceptDamage(message.rolls, message.flags.data);\r\n}\r\n\r\nexport async function onAttackCardAction(event) {\r\n  event.preventDefault();\r\n\r\n  // Extract card data\r\n  const button = event.currentTarget;\r\n  // Disable Button\r\n  button.disabled = true;\r\n  const card = button.closest(\".chat-card\");\r\n  const messageId = card.closest(\".message\").dataset.messageId;\r\n  const message = game.messages.get(messageId);\r\n  const action = button.dataset.action;\r\n\r\n  // Recover the actor for the chat card\r\n  const actor = await _getChatCardActor(card);\r\n  if (!actor) return;\r\n\r\n  // Validate permission to proceed with the roll\r\n  const isTargetted = action === \"contest\";\r\n  if (!(isTargetted || game.user.isGM || actor.isOwner)) {\r\n    return;\r\n  }\r\n\r\n  // Get the Item from stored flag data or by the item ID on the Actor\r\n  const storedData = message.getFlag(\"abbrew\", \"itemData\");\r\n  const item = storedData ? new this(storedData, { parent: actor }) : actor.attacks.get(card.dataset.itemId);\r\n  if (!item) {\r\n    const err = game.i18n.format(\"ABBREW.ActionWarningNoItem\", { item: card.dataset.itemId, name: actor.name });\r\n    return ui.notifications.error(err);\r\n  }\r\n\r\n  // TODO: Pull this up to the first dialog, we should pop the strong etc. one on\r\n  // clicking the sheet, not here. Give option to accept the damage only\r\n  await item.rollAttack({ event });\r\n\r\n  // Re-enable the button\r\n  button.disabled = false;\r\n}\r\n\r\n/**\r\n* Get the Actor which is the author of a chat card\r\n* @param {HTMLElement} card    The chat card being used\r\n* @returns {Actor|null}        The Actor document or null\r\n* @private\r\n*/\r\nasync function _getChatCardActor(card) {\r\n\r\n  // Case 1 - a synthetic actor from a Token\r\n  if (card.dataset.tokenId) {\r\n    const token = await fromUuid(card.dataset.tokenId);\r\n    if (!token) return null;\r\n    return token.actor;\r\n  }\r\n\r\n  // Case 2 - use Actor ID directory\r\n  const actorId = card.dataset.actorId;\r\n  return game.actors.get(actorId) || null;\r\n}","export class AbbrewRule {\r\n    id;\r\n    label;\r\n    type;\r\n    priority;\r\n    predicate;\r\n    // The property to modify e.g. system.statistics.strength.value\r\n    target;\r\n    source;\r\n    valid;\r\n\r\n    get _type() {\r\n        return this.type;\r\n    }\r\n\r\n    constructor(id, label, type, source, valid) {\r\n        this.type = type;\r\n        this.priority = 100;\r\n        this.id = id;\r\n        this.label = label;\r\n        this.valid = valid;\r\n        this.source = source;\r\n        this.predicate = \"\";\r\n        this.target = \"\";\r\n    }\r\n\r\n    template() { return JSON.stringify(this); };\r\n\r\n    static applyRule(rule, actorData) { return {}; }\r\n\r\n    static validate(candidate) {\r\n        return candidate.hasOwnProperty('type') && candidate.hasOwnProperty('priority') && candidate.hasOwnProperty('predicate') && candidate.hasOwnProperty('target');\r\n    }\r\n}\r\n\r\n","export const ABBREW = {};\r\n\r\n/**\r\n * The set of Ability Scores used within the sytem.\r\n * @type {Object}\r\n */\r\nABBREW.statistics = {\r\n  \"strength\": \"ABBREW.StatisticStrength\",\r\n  \"dexterity\": \"ABBREW.StatisticDexterity\",\r\n  \"constitution\": \"ABBREW.StatisticConstitution\",\r\n  \"agility\": \"ABBREW.StatisticAgility\",\r\n  \"intelligence\": \"ABBREW.StatisticIntelligence\",\r\n  \"will\": \"ABBREW.StatisticWill\",\r\n  \"wits\": \"ABBREW.StatisticWits\",\r\n  \"visualisation\": \"ABBREW.StatisticVisualisation\"\r\n};\r\n\r\nABBREW.StatisticAbbreviations = {\r\n  \"str\": \"ABBREW.StatisticStrengthAbbreviation\",\r\n  \"dex\": \"ABBREW.StatisticDexterityAbbreviation\",\r\n  \"con\": \"ABBREW.StatisticConstitutionAbbreviation\",\r\n  \"agi\": \"ABBREW.StatisticAgilityAbbreviation\",\r\n  \"int\": \"ABBREW.StatisticIntelligenceAbbreviation\",\r\n  \"wll\": \"ABBREW.StatisticWillAbbreviation\",\r\n  \"wts\": \"ABBREW.StatisticWitsAbbreviation\",\r\n  \"wis\": \"ABBREW.StatisticVisualisationAbbreviation\"\r\n};\r\n\r\nABBREW.ActionTypes = {\r\n  \"Damage\": \"damage\"\r\n};\r\n\r\nABBREW.Reach = {\r\n  \"natural\": \"ABBREW.ReachNatural\",\r\n  \"short\": \"ABBREW.ReachShort\",\r\n  \"standard\": \"ABBREW.ReachStandard\",\r\n  \"long\": \"ABBREW.ReachLong\"\r\n}\r\n\r\nABBREW.DamageTypes = {\r\n  \"physical\": \"ABBREW.physical\",\r\n  \"crushing\": \"ABBREW.crushing\",\r\n  \"slashing\": \"ABBREW.slashing\",\r\n  \"piercing\": \"ABBREW.piercing\"\r\n};\r\n\r\nABBREW.DamageProjection = {\r\n  \"arc\": \"ABBREW.Arc\",\r\n  \"thrust\": \"ABBREW.Thrust\"\r\n}\r\n\r\nABBREW.UI = {\r\n  \"RuleElements\": {\r\n    \"Prompt\": {\r\n      \"NoValidOptions\": \"ABBREW.NoValidOptions\",\r\n      \"NoSelectionMade\": \"ABBREW.NoSelectionMade\"\r\n    }\r\n  }\r\n}\r\n\r\nABBREW.RuleTypes = {\r\n  \"ActiveEffect\": \"ABBREW.ActiveEffect\",\r\n  \"ChoiceSet\": \"ABBREW.ChoiceSet\"\r\n}","import { AbbrewRule } from \"./abbrew-rule.mjs\";\r\nimport { ABBREW } from \"../../helpers/config.mjs\";\r\n\r\nexport class AbbrewActiveEffect extends AbbrewRule {\r\n\r\n    operator;\r\n    value;\r\n    requireEquippedItem;\r\n\r\n    static validOperators =\r\n        [\r\n            \"override\",\r\n            \"add\",\r\n            \"minus\",\r\n            \"multiply\",\r\n            \"divide\",\r\n            \"upgrade\",\r\n            \"downgrade\"\r\n        ]\r\n\r\n    constructor(id, label, candidate, source, valid) {\r\n        super(id, label, ABBREW.RuleTypes.ActiveEffect, source, valid);\r\n        if (candidate && typeof candidate == \"object\") {\r\n            candidate && Object.assign(this, candidate);\r\n            return;\r\n        }\r\n        this.operator = \"\";\r\n        this.value = \"\";\r\n        this.requireEquippedItem = false;\r\n    }\r\n\r\n    static validate(candidate) {\r\n        return super.validate(candidate) && candidate.hasOwnProperty('operator') && candidate.hasOwnProperty('value') && this.validOperators.includes(candidate.operator) && !!candidate.value;\r\n    }\r\n\r\n    static applyRule(rule, actorData) {\r\n        let changes = {};\r\n        let targetElement = rule.targetElement ? actorData.items.get(rule.targetElement) : actorData;\r\n        let targetElementType = rule.targetElement ? \"Item\" : \"Actor\";\r\n        let currentValue = getProperty(targetElement, rule.target)\r\n        if (!currentValue) {\r\n            return changes;\r\n        }\r\n\r\n        let targetType = getType(currentValue);\r\n        let ruleValue = null;\r\n        if (rule.value[0] == '$') {\r\n            ruleValue = getProperty(actorData.items.get(rule.source.item), rule.value.substring(1, rule.value.length));\r\n        } else if (rule.value[0] == 'Â£') {\r\n            ruleValue = getProperty(actorData, rule.value.substring(1, rule.value.length));\r\n        } else {\r\n            ruleValue = rule.value;\r\n        }\r\n\r\n        let delta = this._castDelta(ruleValue, targetType);\r\n\r\n        let newValue = getProperty(targetElement, rule.target)\r\n        switch (rule.operator) {\r\n            case \"override\":\r\n                newValue = delta;\r\n                break;\r\n            case \"add\":\r\n                newValue = newValue += delta;\r\n                break;\r\n            case \"minus\":\r\n                newValue = newValue -= delta;\r\n                break;\r\n            case \"multiply\":\r\n                newValue = newValue * delta;\r\n                break;\r\n            case \"divide\":\r\n                const divisor = delta !== 0 ? delta : 1;\r\n                newValue = newValue / divisor;\r\n                break;\r\n            case \"upgrade\":\r\n                newValue = newValue < delta ? delta : newValue;\r\n                break;\r\n            case \"downgrade\":\r\n                newValue = newValue > delta ? delta : newValue;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n\r\n        if (currentValue != newValue) {\r\n            const elementChanges = { [rule.target]: newValue, rules: [rule.id] };\r\n            let sourceValue = currentValue;\r\n            if (Object.keys(actorData.ruleOverrides).includes(rule.target)) {\r\n                sourceValue = actorData.ruleOverrides[rule.target].sourceValue;\r\n            }\r\n            changes = { target: rule.target, value: newValue, sourceValue, targetElementType, targetElement: rule.targetElement };\r\n            mergeObject(targetElement, elementChanges);\r\n        }\r\n\r\n        return changes;\r\n    }\r\n\r\n    static _castDelta(raw, type) {\r\n        let delta;\r\n        switch (type) {\r\n            case \"boolean\":\r\n                delta = Boolean(this._parseOrString(raw));\r\n                break;\r\n            case \"number\":\r\n                delta = Number.fromString(raw);\r\n                if (Number.isNaN(delta)) delta = 0;\r\n                break;\r\n            case \"string\":\r\n                delta = String(raw);\r\n                break;\r\n            default:\r\n                delta = this._parseOrString(raw);\r\n        }\r\n        return delta;\r\n    }\r\n\r\n    static _parseOrString(raw) {\r\n        try {\r\n            return JSON.parse(raw);\r\n        } catch (err) {\r\n            return raw;\r\n        }\r\n    }\r\n}","export class ChoiceSetPrompt extends Dialog {\r\n    selection;\r\n    choices;\r\n\r\n    constructor(data = { promptTitle, choices }, options = {}) {\r\n        options.buttons = {};\r\n        data.buttons = {};\r\n        super(data, options);\r\n        this.choices = data.content.choices;\r\n    }\r\n\r\n\r\n    /** @override */\r\n    get template() {\r\n        return \"systems/abbrew/templates/rules/choice-set-prompt.hbs\";\r\n    }\r\n\r\n    /** @override */\r\n    activateListeners($html) {\r\n        const html = $html[0];\r\n\r\n        html.querySelectorAll(\"a[data-choice], button[type=button]\").forEach((element) => {\r\n            element.addEventListener(\"click\", (event) => {\r\n                console.log('clicked');\r\n                // Get the actual selection\r\n                this.selection = event.currentTarget.dataset.id;\r\n                this.close();\r\n            });\r\n        });\r\n    }\r\n\r\n    getData() {\r\n        console.log(\"getData\", this);\r\n        // no super to Application\r\n        const data = super.getData();\r\n\r\n        data.header = this.data.header;\r\n        data.footer = this.data.footer;\r\n\r\n        data.choices = data.content.choices;\r\n        data.promptTitle = data.content.promptTitle;\r\n\r\n        console.log(data);\r\n\r\n        return data;\r\n    }\r\n\r\n    /** Return early if there is only one choice */\r\n    async resolveSelection() {\r\n        // Exit early if there are no valid choices\r\n        if (this.choices.length === 0) {\r\n            await this.close({ force: true });\r\n            return null;\r\n        }\r\n\r\n        const firstChoice = this.choices.at(0);\r\n        if (firstChoice && this.choices.length === 1) {\r\n            return (this.selection = firstChoice[0]);\r\n        }\r\n\r\n        this.render(true);\r\n        return new Promise((resolve) => {\r\n            this.resolve = resolve;\r\n        });\r\n    }\r\n\r\n    /** @override */\r\n    /** Close the dialog, applying the effect with configured target or warning the user that something went wrong. */\r\n    async close({ force = false } = {}) {\r\n        this.element.find(\"button, select\").css({ pointerEvents: \"none\" });\r\n        if (!this.selection) {\r\n            if (force) {\r\n                ui.notifications.warn(\r\n                    game.i18n.format(\"ABBREW.UI.RuleElements.Prompt.NoValidOptions\", {\r\n                        actor: this.actor.name,\r\n                        item: this.item.name,\r\n                    })\r\n                );\r\n            } else if (!this.allowNoSelection) {\r\n                ui.notifications.warn(\r\n                    game.i18n.format(\"ABBREW.UI.RuleElements.Prompt.NoSelectionMade\")\r\n                );\r\n            }\r\n        }\r\n\r\n        this.resolve?.(this.selection);\r\n        await super.close({ force });\r\n    }\r\n}","import { AbbrewRule } from \"./abbrew-rule.mjs\";\r\nimport { ABBREW } from \"../../helpers/config.mjs\";\r\nimport { ChoiceSetPrompt } from \"../choice-set-prompt.mjs\";\r\n\r\nexport class AbbrewChoiceSet extends AbbrewRule {\r\n\r\n    options;\r\n    choice;\r\n\r\n    set target(target) {\r\n        this.target = target;\r\n    }\r\n\r\n    constructor(id, label, candidate, source, valid) {\r\n        super(id, label, ABBREW.RuleTypes.ChoiceSet, source, valid);\r\n        if (candidate && typeof candidate == \"object\") {\r\n            candidate && Object.assign(this, candidate);\r\n            return;\r\n        }\r\n        this.options = [\"weapon\", \"armour\", \"consumable\", \"anatomy\"];\r\n        this.choice = \"\";\r\n    }\r\n\r\n    static validate(candidate) {\r\n        return super.validate(candidate) && candidate.hasOwnProperty('options');\r\n    }\r\n\r\n    static async applyRule(rule, actorData) {\r\n        return {};\r\n    }\r\n\r\n    static async getChoice(rule, actorData) {\r\n        if (rule.choice) {\r\n            return rule.choice;\r\n        }\r\n\r\n        let choices = [];\r\n\r\n        if (rule.options.includes(\"weapon\")) {\r\n            choices = mergeObject(choices, this.getItemWeapons(actorData));\r\n        }\r\n\r\n        if (rule.options.includes(\"armour\")) {\r\n            choices = mergeObject(choices, this.getItemArmour(actorData));\r\n        }\r\n\r\n        if (rule.options.includes(\"consumable\")) {\r\n            choices = mergeObject(choices, this.getItemConsumable(actorData));\r\n        }\r\n\r\n        if (rule.options.includes(\"anatomy\")) {\r\n            choices = mergeObject(choices, this.getItemAnatomy(actorData));\r\n        }\r\n\r\n        const data = { content: { promptTitle: \"Hello\", choices }, buttons: {} };\r\n        const choice = await new ChoiceSetPrompt(data).resolveSelection();\r\n\r\n        let parentItemId = rule.source.item;\r\n        if (!rule.source.actor) {\r\n            parentItemId = actorData.items.map(i => i.system.rules).flat(1).filter(i => i.id == rule.id)[0].source.item;\r\n        }\r\n        const parentItem = actorData.items.get(parentItemId);\r\n        // const duplicateItem = deepClone(parentItem);\r\n        for (let i = 0; i < parentItem.system.rules.length; i++) {\r\n            parentItem.system.rules[i].targetElement = choice;\r\n            if (parentItem.system.rules[i].id == rule.id) {\r\n                parentItem.system.rules[i].choice = choice;\r\n                const ruleContent = parentItem.system.rules[i].content;\r\n                let parsedContent = JSON.parse(ruleContent);\r\n                parsedContent.choice = choice;\r\n                parentItem.system.rules[i].content = JSON.stringify(parsedContent);\r\n            }\r\n        }\r\n        parentItem.update({ system: { rules: parentItem.system.rules } });\r\n        return choice;\r\n    }\r\n\r\n    static getItemWeapons(actorData) {\r\n        return actorData.itemTypes.item.filter(i => i.system.isWeapon).map(i => ({ id: i._id, name: i.name }));\r\n    }\r\n\r\n    static getItemArmour(actorData) {\r\n        return actorData.itemTypes.item.filter(i => i.system.isArmour).map(i => ({ id: i._id, name: i.name }));\r\n    }\r\n\r\n    static getItemConsumable(actorData) {\r\n        return actorData.itemTypes.item.filter(i => i.system.isConsumable).map(i => ({ id: i._id, name: i.name }));\r\n    }\r\n\r\n    static getItemAnatomy(actorData) {\r\n        return actorData.itemTypes.anatomy.map(i => ({ id: i._id, name: i.name }));\r\n    }\r\n}","import { AbbrewActiveEffect } from \"./rules-data/active-effect.mjs\";\r\nimport { AbbrewChoiceSet } from \"./rules-data/choice-set.mjs\";\r\n\r\nexport class AbbrewRuleField {\r\n    id;\r\n    type;\r\n    active;\r\n    label;\r\n    content;\r\n    source;\r\n    options;\r\n    targetElement;\r\n\r\n    constructor({ id, type, label, content, source }) {\r\n        this.id = id;\r\n        this.type = type;\r\n        this.active = true;\r\n        this.label = label;\r\n        this.content = content;\r\n        this.source = source;\r\n        this.options = options;\r\n        this.targetElement = \"\";\r\n    }\r\n}\r\n\r\nexport const options = [\r\n    new AbbrewActiveEffect(),\r\n    new AbbrewChoiceSet()\r\n]\r\n\r\n","export class RuleSource {\r\n    actor;\r\n    item;\r\n    uuid;\r\n\r\n    constructor(uuid) {\r\n        this.uuid = uuid;\r\n        this.actor = \"\";\r\n        this.item = \"\";\r\n        const parts = uuid.split('.');\r\n        for (let i = 0; i < parts.length; i++) {\r\n            if (parts[i] == \"Actor\") {\r\n                this.actor = parts[i + 1]\r\n            }\r\n            if (parts[i] == \"Item\") {\r\n                this.item = parts[i + 1];\r\n            }\r\n        }\r\n    }\r\n}","import { AbbrewRuleField, options } from \"./rule-field.mjs\";\r\nimport { AbbrewActiveEffect } from \"./rules-data/active-effect.mjs\";\r\nimport { AbbrewChoiceSet } from \"./rules-data/choice-set.mjs\";\r\nimport { ABBREW } from \"../helpers/config.mjs\";\r\nimport { AbbrewActor } from \"../documents/actor.mjs\";\r\nimport { AbbrewRule } from \"./rules-data/abbrew-rule.mjs\";\r\nimport { RuleSource } from \"./rule-source.mjs\";\r\n\r\n/**\r\n * Manage Rule instances through the Item Sheet via rule control buttons.\r\n * @param {MouseEvent} event      The left-click event on the rule control\r\n * @param {Item} item      The owning document which manages this rule\r\n */\r\nexport async function onManageRule(event, item) {\r\n    event.preventDefault();\r\n    const a = event.currentTarget;\r\n    const li = a.closest(\"li\");\r\n    const ruleId = li.dataset.ruleId;\r\n    let rules = foundry.utils.deepClone(item.system.rules);\r\n    switch (a.dataset.action) {\r\n        case \"create\":\r\n            const id = uuid();\r\n            rules = [new AbbrewRuleField({ id, type: 0, label: \"New Rule\", content: options[0].template(), source: new RuleSource(item.uuid) }),\r\n            ...rules,];\r\n            break;\r\n        case \"delete\":\r\n            rules = rules.filter(r => r.id != ruleId);\r\n            break;\r\n    }\r\n\r\n    return await item.update({\r\n        \"system.rules\": rules\r\n    });\r\n}\r\n\r\n/**\r\n * Provide UUID for rule instances\r\n * @returns UUID\r\n */\r\nfunction uuid() {\r\n    return Date.now().toString(36) + Math.random().toString(36).substr(2);\r\n}\r\n\r\n/**\r\n * Prepare rules for the given actor from their items.\r\n * @param {AbbrewActor} actor \r\n */\r\nexport async function prepareRules(actor) {\r\n    const rules = actor.items._source.map(i => i.system.rules).flat(1);\r\n    const validRules = [];\r\n    const sourceTargets = [];\r\n    for (let i = 0; i < rules.length; i++) {\r\n        const rule = rules[i];\r\n        if (!rule.active) {\r\n            continue;\r\n        }\r\n        if (sourceTargets[rule.source.uuid]) {\r\n            rule.targetElement = sourceTargets[rule.source.uuid];\r\n        }\r\n        const parsedRule = JSON.parse(rule.content);\r\n        let typedRule = {};\r\n        let valid = false;\r\n        switch (parsedRule.type) {\r\n            case ABBREW.RuleTypes.ActiveEffect:\r\n                console.log('Active Effect');\r\n                valid = AbbrewActiveEffect.validate(parsedRule);\r\n                typedRule = new AbbrewActiveEffect(rule.id, rule.label, parsedRule, rule.source, valid);\r\n                typedRule.targetElement = rule.targetElement;\r\n                const equipState = actor.items.get(typedRule.source.item).system.equipState;\r\n                if ((typedRule.requireEquippedItem && (equipState.worn || equipState.wielded)) || (!typedRule.requireEquippedItem)) {\r\n                    validRules.push(typedRule);\r\n                }\r\n                break;\r\n            case ABBREW.RuleTypes.ChoiceSet:\r\n                console.log('Choice Set');\r\n                valid = AbbrewChoiceSet.validate(parsedRule);\r\n                typedRule = new AbbrewChoiceSet(rule.id, rule.label, parsedRule, rule.source, valid);\r\n                const choice = await AbbrewChoiceSet.getChoice(typedRule, actor);\r\n                sourceTargets[rule.source.uuid] = choice;\r\n                typedRule.targetElement = choice;\r\n                typedRule.choice = choice;\r\n                validRules.push(typedRule);\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    await actor.update({ \"system.rules\": validRules });\r\n}\r\n\r\n/**\r\n * Apply a rule to a given actor.\r\n * @param {AbbrewRule} rule \r\n * @param {AbbrewActor} actorData \r\n * @returns changes element.\r\n */\r\nexport function applyRule(rule, actorData) {\r\n    let changes = {};\r\n    switch (rule.type) {\r\n        case ABBREW.RuleTypes.ActiveEffect:\r\n            changes = AbbrewActiveEffect.applyRule(rule, actorData);\r\n            break;\r\n        case ABBREW.RuleTypes.ChoiceSet:\r\n            changes = AbbrewChoiceSet.applyRule(rule, actorData);\r\n            break;\r\n        default:\r\n            break;\r\n    }\r\n\r\n    return changes;\r\n}\r\n","export function writeToPath(element, path, value) {    \r\n    let pathWrite = [];\r\n    pathWrite[path] = value;\r\n    let keyed = expandObject(pathWrite);\r\n    element.update(keyed);\r\n}","import { AbbrewAttackProfile } from \"./attackprofile.mjs\";\r\nimport { prepareRules, applyRule } from \"../rules/rules.mjs\";\r\nimport { writeToPath } from \"../helpers/write-to-path.mjs\";\r\n\r\n/**\r\n * Extend the base Actor document by defining a custom roll data structure which is ideal for the Simple system.\r\n * @extends {Actor}\r\n */\r\nexport class AbbrewActor extends Actor {\r\n  ruleOverrides;\r\n\r\n  /** @override */\r\n  prepareData() {\r\n    // Prepare data for the actor. Calling the super version of this executes\r\n    // the following, in order: data reset (to clear active effects),\r\n    // prepareBaseData(), prepareEmbeddedDocuments() (including active effects),\r\n    // prepareDerivedData().\r\n    console.log('before');\r\n    super.prepareData();\r\n    console.log('between');\r\n    console.log('after');\r\n  }\r\n\r\n  /** @override */\r\n  prepareBaseData() {\r\n    // Data modifications in this step occur before processing embedded\r\n    // documents or derived data.\r\n    console.log('is it before?');\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   * Augment the basic actor data with additional dynamic data. Typically,\r\n   * you'll want to handle most of your calculated/derived data in this step.\r\n   * Data calculated in this step should generally not exist in template.json\r\n   * (such as ability modifiers rather than ability scores) and should be\r\n   * available both inside and outside of character sheets (such as if an actor\r\n   * is queried and has a roll executed directly from it).\r\n   */\r\n  prepareDerivedData() {\r\n    const actorData = this;\r\n    const systemData = actorData.system;\r\n    const flags = actorData.flags.abbrew || {};\r\n\r\n    // Make separate methods for each Actor type (character, npc, etc.) to keep\r\n    // things organized.\r\n    this._prepareCharacterData(actorData);\r\n    this._prepareNpcData(actorData);\r\n  }\r\n\r\n  /**\r\n   * Prepare Character type specific data\r\n   */\r\n  _prepareCharacterData(actorData) {\r\n    if (actorData.type !== 'character') return;\r\n\r\n    // Make modifications to data here. For example:\r\n    const systemData = actorData.system;\r\n    // super.applyActiveEffects()\r\n    // Prepare\r\n    this._processRules(this);\r\n    this._prepareAbilityModifiers(systemData);\r\n    this._prepareAnatomy(systemData);\r\n    this._prepareMovement(systemData);\r\n    this._prepareDefences(systemData);\r\n    this._prepareArmour(systemData);\r\n    this._preparePower(systemData);\r\n    this._prepareActions(systemData);\r\n    this._prepareFeatures(systemData);\r\n  }\r\n\r\n  async _updateObject(event, formData) {\r\n    console.log('here');\r\n    // call super with revert to rawActor merged with actual changes?\r\n    await super._updateObject(event, formData);\r\n  }\r\n\r\n  _onUpdate(data, options, userId) {\r\n    console.log('here2');\r\n    // call super with revert to rawActor merged with actual changes?\r\n    super._onUpdate(data, options, userId);\r\n\r\n  }\r\n\r\n  async _preUpdate(changed, options, user) {\r\n    console.log('pre-update');\r\n\r\n    if (this.ruleOverrides) {\r\n      let flatChanges = flattenObject(changed, 1);\r\n      let flatChangesArray = Object.keys(flatChanges).map((key) => [key, flatChanges[key]]);\r\n      const overrideKeys = Object.keys(this.ruleOverrides);\r\n      flatChangesArray.forEach(c => {\r\n        if (overrideKeys.includes(c[0]) && this.ruleOverrides[c[0]].overrideValue == c[1]) {\r\n          const path = c[0];\r\n          let keys = path.split('.');\r\n          let prop = keys.pop();\r\n          let parent = keys.reduce((obj, key) => obj[key], changed);\r\n          delete parent[prop];\r\n        }\r\n      })\r\n    }\r\n\r\n    super._preUpdate(changed, options, user);\r\n  }\r\n\r\n\r\n  _onUpdateEmbeddedDocuments(embeddedName, documents, result, options, userId) {\r\n    console.log(`Update Object: ${embeddedName}`);\r\n    super._onUpdateEmbeddedDocuments(embeddedName, documents, result, options, userId);\r\n  }\r\n\r\n  _processRules(actorData) {\r\n    this.prepareItems(this);\r\n    this.resetItems(this);\r\n    prepareRules(this);\r\n    if (actorData.system.rules.length == 0) {\r\n      this.ruleOverrides = [];\r\n      return;\r\n    }\r\n\r\n    let changes = [];\r\n    this.ruleOverrides = [];\r\n    actorData.ruleOverrides = [];\r\n    actorData.system.rules\r\n      .filter(\r\n        r => r.valid\r\n      ).sort((r1, r2) => r2.priority - r1.priority)\r\n      .forEach(r => {\r\n        const ruleChange = applyRule(r, actorData);\r\n        if (Object.keys(ruleChange).length == 0) {\r\n          return;\r\n        }\r\n        changes[ruleChange.target] = {\r\n          overrideValue: ruleChange.value,\r\n          sourceValue: ruleChange.sourceValue,\r\n          targetType: ruleChange.targetType,\r\n          targetElement: ruleChange.targetElement\r\n        };\r\n        actorData.ruleOverrides[ruleChange.target] = changes[ruleChange.target];\r\n      });\r\n\r\n    this.ruleOverrides = changes;\r\n  }\r\n\r\n  /**\r\n   * Reset item overridden fields to pre-rule values.\r\n   * @param {AbbrewActor} actorData    \r\n   */\r\n  prepareItems(actorData) {\r\n    actorData.items.filter(i => i.system.rules.length > 0).forEach(i => {\r\n      i.system.rules.forEach(r => {\r\n        if (r.source.actor && r.source.item) {\r\n          return;\r\n        }\r\n        r.source.actor = this.id;\r\n        r.source.item = i.id;\r\n        r.source.uuid = `Actor.${this.id}.Item.${i.id}`;\r\n      });\r\n      const item = actorData.items.get(i.id);\r\n      writeToPath(item, 'system.rules', i.system.rules)\r\n    });\r\n  }\r\n\r\n  resetItems(actorData) {\r\n    if (!actorData.ruleOverrides) {\r\n      return;\r\n    }\r\n    for (const [key, override] of Object.entries(actorData.ruleOverrides)) {\r\n      if (override.targetType == \"Item\") {\r\n        const item = actorData.items.get(override.targetElement);\r\n        const path = key;\r\n        let keys = path.split('.');\r\n        let itemValue = keys.reduce((obj, key) => obj[key], item);\r\n        if (itemValue == override.overrideValue) {\r\n          writeToPath(item, path, override.sourceValue);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  async _updateDocuments(documentClass, { updates, options, pack }, user) {\r\n    console.log('update-documents');\r\n    super._updateDocuments(documentClass, { updates, options, pack }, user);\r\n  }\r\n\r\n  _prepareAnatomy(systemData) {\r\n    this.itemTypes.anatomy.forEach(\r\n      a => {\r\n        const tags = a.system.tags.replace(' ', '').split(',');\r\n        a.system.tagsArray = tags;\r\n        const armourPoints = a.system.armourPoints.replace(' ', '').split(',');\r\n        a.system.armourPointsArray = armourPoints;\r\n      }\r\n    );\r\n    systemData.anatomy = this.itemTypes.anatomy;\r\n  }\r\n\r\n  _prepareDefences(systemData) {\r\n    const defences = Object.fromEntries(Object.entries(this.itemTypes.defence).map(([k, v]) => [v.name, v.system]));\r\n    systemData.defences = { ...systemData.defences, ...defences };\r\n  }\r\n\r\n  _prepareFeatures(systemData) {\r\n    const weapons = this._getWeapons();\r\n    const attacks = weapons.map(w => this._prepareWeaponAttack(w, systemData));\r\n    systemData.attacks = attacks.flat();\r\n  }\r\n\r\n  _getWeapons() {\r\n    return this._getItemWeapons().map(i => ({ \"name\": i.name, \"img\": i.img, \"weaponId\": i._id, \"weight\": i.system.weight, \"concepts\": i.system.concepts, \"material\": i.system.material, \"equipState\": i.system.equipState, ...i.system.weapon }));\r\n  }\r\n\r\n  _getItemWeapons() {\r\n    return this.itemTypes.item.filter(i => i.system.isWeapon);\r\n  }\r\n\r\n  _prepareWeaponAttack(weapon) {\r\n    const results = weapon.weaponProfiles.split(',').map((wp, index) => {\r\n      const profileParts = wp.split('-');\r\n      const damageType = profileParts[0].replace(' ', '');\r\n      const attackType = profileParts[1];\r\n      // Handle Penalty here, check requirements are met.\r\n      const requirements = { strength: { value: 5 } }; // JSON.parse(weapon.requirements);\r\n      let damageBase = 0;\r\n      switch (profileParts[1]) {\r\n        case \"arc\":\r\n          damageBase = + weapon.material.structure + (requirements.strength.value * (1 + weapon.minimumEffectiveReach)) + (weapon.material.tier * 5);\r\n          break;\r\n        case \"thrust\":\r\n          damageBase = + weapon.material.structure + (weapon.material.tier * 5);\r\n          weapon.penetration = weapon.material.tier * 5;\r\n          break;\r\n        default:\r\n          return;\r\n      }\r\n\r\n      return new AbbrewAttackProfile(\r\n        index,\r\n        \"@system.statistics.strength.mod\",\r\n        damageBase,\r\n        true,\r\n        {\r\n          requirements: weapon.requirements,\r\n          reach: weapon.reach,\r\n          minimumEffectiveReach: weapon.minimumEffectiveReach,\r\n          focused: weapon.focused,\r\n          penetration: weapon.penetration,\r\n          traits: weapon.traits,\r\n          handsSupplied: weapon.handsSupplied,\r\n          handsRequired: weapon.handsRequired,\r\n          traitsArray: weapon.traitsArray,\r\n          criticalThreshold: weapon.criticalThreshold,\r\n          damageType: damageType,\r\n          attackType: attackType\r\n        },\r\n        false,\r\n        {}\r\n      );\r\n    });\r\n\r\n    return {\r\n      id: weapon.weaponId,\r\n      name: weapon.name,\r\n      image: weapon.img || \"icons/svg/sword.svg\",\r\n      isWeapon: true,\r\n      isEquipped: weapon.equipState.wielded,\r\n      profiles: results\r\n    }\r\n  };\r\n\r\n  async equipWeapon(id, equip) {\r\n    const updates = [];\r\n    updates.push({ _id: id, system: { equipState: { wielded: equip } } });\r\n    await this.updateEmbeddedDocuments(\"Item\", updates);\r\n  };\r\n\r\n  async equipArmour(id, equip) {\r\n    const updates = [];\r\n    updates.push({ _id: id, system: { equipState: equip } });\r\n    await this.updateEmbeddedDocuments(\"Item\", updates);\r\n  }\r\n\r\n  _prepareAbilityModifiers(systemData) {\r\n    // Loop through ability scores, and add their modifiers to our sheet output.\r\n    for (let [key, ability] of Object.entries(systemData.statistics)) {\r\n      // Calculate the modifier using abbrew rules.\r\n      ability.mod = Math.floor(ability.value / 2);\r\n    }\r\n  }\r\n\r\n  _prepareMovement(systemData) {\r\n    const base = systemData.statistics.agility.mod;\r\n    const limbs = systemData.anatomy.filter(a => a.system.tagsArray.includes('primary')).length;\r\n    systemData.movement.base = base * limbs;\r\n  }\r\n\r\n  _prepareArmour(systemData) {\r\n    systemData.armours = this.itemTypes.item.filter(a => a.system.isArmour);\r\n    let naturalBonuses = this.itemTypes.anatomy.map(a => a.system.armourBonus);\r\n    const naturalValue = foundry.utils.getProperty(this, this.system.naturalArmour);\r\n    naturalBonuses = naturalBonuses.map(b => { if (b === 'natural') { b = naturalValue; } return b; });\r\n    const initialValue = 0;\r\n    const fullArmourMax = naturalBonuses.map(b => +b).reduce((accumulator, currentValue) => accumulator + currentValue, initialValue);\r\n    systemData.armour.max = fullArmourMax;\r\n\r\n    const defencesArray = systemData.armour.defences.replaceAll(' ', '').split(',');\r\n    systemData.armour.defencesArray = defencesArray;\r\n  }\r\n\r\n  _preparePower(systemData) {\r\n    const result = this._sumValues(systemData);\r\n    systemData.attributes.power.value = result;\r\n  }\r\n\r\n  _prepareActions(systemData) {\r\n    const actions = 3;\r\n    systemData.actions = { current: actions, maximum: actions };\r\n  }\r\n\r\n  // TODO: Generalise or change\r\n  _sumValues(systemData) {\r\n    return Object.values(systemData.statistics).reduce(function (sum, ability) {\r\n      return sum += ability.value;\r\n    }, 0);\r\n  }\r\n\r\n  /**\r\n   * Prepare NPC type specific data.\r\n   */\r\n  _prepareNpcData(actorData) {\r\n    if (actorData.type !== 'npc') return;\r\n\r\n    // Make modifications to data here. For example:\r\n    const systemData = actorData.system;\r\n    systemData.xp = (systemData.cr * systemData.cr) * 100;\r\n  }\r\n\r\n  /**\r\n   * Override getRollData() that's supplied to rolls.\r\n   */\r\n  getRollData() {\r\n    const data = super.getRollData();\r\n\r\n    // Prepare character roll data.\r\n    this._getCharacterRollData(data);\r\n    this._getNpcRollData(data);\r\n\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * Prepare character roll data.\r\n   */\r\n  _getCharacterRollData(data) {\r\n    if (this.type !== 'character') return;\r\n\r\n    // Copy the ability scores to the top level, so that rolls can use\r\n    // formulas like `@str.mod + 4`.\r\n    if (data.statistics) {\r\n      for (let [k, v] of Object.entries(data.statistics)) {\r\n        data[k] = foundry.utils.deepClone(v);\r\n      }\r\n    }\r\n\r\n    // Add level for easier access, or fall back to 0.\r\n    if (data.attributes.level) {\r\n      data.lvl = data.attributes.level.value ?? 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Prepare NPC roll data.\r\n   */\r\n  _getNpcRollData(data) {\r\n    if (this.type !== 'npc') return;\r\n\r\n    // Process additional NPC data here.\r\n  }\r\n\r\n  async acceptDamage(damageRolls, attackData) {\r\n    // Gets targets\r\n    // [...(game.user.targets?.values() ?? [])].filter(t => !!t.actor)\r\n    const actor = this;\r\n    const systemData = this.system;\r\n    let damage = damageRolls[0]._total;\r\n    let damageRoll = damageRolls[0];\r\n    let damagePenetrate = attackData.attackProfile.weapon.penetration;\r\n    // const modRoll = damageRolls[0];\r\n    // modRoll.terms[0].rolls[0].terms[0].results[0] = {active: true, result: 1};\r\n    // const newRoll = await CONFIG.Dice.AbbrewRoll.fromRoll(modRoll);\r\n    let currentArmour = systemData.armour.value;\r\n    let newArmour = currentArmour;\r\n\r\n    const damageType = attackData.attackProfile.weapon.damageType;\r\n\r\n    if (!systemData.defences[damageType]) {\r\n      const untypedCritical = await this.getCriticalExplosions(damageRoll, 0, 0)\r\n      await this.handleDamage(systemData, damage, \"untyped\", untypedCritical);\r\n    }\r\n\r\n    const damageTypeDefence = systemData.defences[damageType];\r\n\r\n    if (damageTypeDefence.absorb) {\r\n      await this.absorbDamage(actor, systemData, damage);\r\n      return;\r\n    }\r\n    if (damageTypeDefence.immune) {\r\n      return;\r\n    }\r\n\r\n    if (damageTypeDefence.deflect && damageTypeDefence.conduct) {\r\n      // NOOP\r\n    }\r\n    else if (damageTypeDefence.deflect) {\r\n      damage = await this.deflectDamage(damageRoll);\r\n    }\r\n    else if (damageTypeDefence.conduct) {\r\n      damage = await this.conductDamage(damageRoll);\r\n    }\r\n\r\n    // TODO: Handle Resistance\r\n    // TODO: Handle Amplification\r\n\r\n    let criticalExplosions = await this.getCriticalExplosions(damageRoll, damageTypeDefence.vulnerable, damageTypeDefence.negate);\r\n\r\n    if (systemData.armour.defencesArray.includes(damageType)) {\r\n      const penetrate = damageTypeDefence.penetrate + damagePenetrate;\r\n\r\n      const armourAdjustment = damageTypeDefence.block - penetrate;\r\n\r\n      const fullDamage = damage;\r\n      const damageThroughArmour = currentArmour + armourAdjustment - damage;\r\n      if (damageThroughArmour < 0) {\r\n        damage = Math.min(Math.abs(damageThroughArmour), fullDamage);\r\n      } else {\r\n        damage = 0;\r\n      }\r\n\r\n      if (penetrate < currentArmour + damageTypeDefence.block) {\r\n        const availableArmour = currentArmour + armourAdjustment;\r\n        const damageToArmour = Math.min(availableArmour, fullDamage);\r\n        newArmour = currentArmour - damageToArmour;\r\n      } else {\r\n        newArmour = currentArmour;\r\n      }\r\n\r\n    }\r\n\r\n    let updates = {};\r\n    if (damage > 0) {\r\n      updates = await this.handleDamage(systemData, damage, damageType, criticalExplosions, attackData.attackProfile);\r\n    }\r\n\r\n    updates[\"system.armour.value\"] = newArmour;\r\n\r\n    await actor.update(updates);\r\n  }\r\n\r\n  async absorbDamage(actor, systemData, damage) {\r\n    let currentBlood = systemData.blood.value;\r\n    currentBlood = Math.min(currentBlood + damage, systemData.blood.fullMax);\r\n    const maxBlood = Math.max(currentBlood, systemData.blood.max);\r\n    await actor.update({ \"system.blood.value\": currentBlood, \"system.blood.max\": maxBlood });\r\n  }\r\n\r\n  async deflectDamage(damageRoll) {\r\n    const diceResults = damageRoll.terms[0].rolls[0].terms[0].results.reduce((a, b) => a + b.result, 0);\r\n    return damageRoll.total - diceResults;\r\n  }\r\n\r\n  async conductDamage(damageRoll) {\r\n    const diceResults = damageRoll.terms[0].rolls[0].terms[0].results.reduce((a, b) => a + b.result, 0);\r\n    const totalDice = damageRoll.terms[0].rolls[0].terms[0].results.length;\r\n    const maximiseDifference = (totalDice * 10) - diceResults;\r\n    return damageRoll.total + maximiseDifference;\r\n  }\r\n\r\n  async getCriticalExplosions(damageRoll, vulnerable, negate) {\r\n    const criticalThreshold = +damageRoll.terms[0].rolls[0].terms[0].modifiers[0].split('=')[1];\r\n    const criticalChecks = damageRoll.terms[0].rolls[0].terms[0].results.filter(r => r.result >= criticalThreshold).length;\r\n    return criticalChecks - negate + vulnerable;\r\n  }\r\n\r\n  async handleDamage(systemData, damage, damageType, criticalExplosions, attackProfile) {\r\n\r\n    if (damageType === \"heat\") {\r\n      return await this.handleHeat(systemData, damage, criticalExplosions, attackProfile);\r\n    }\r\n\r\n    if ([\"crushing\", \"slashing\", \"piercing\", \"untyped\"].includes(damageType)) {\r\n      return await this.handlePhysical(systemData, damage, criticalExplosions, attackProfile);\r\n    }\r\n  }\r\n\r\n  async handleHeat(systemData, damage, criticalExplosions, attackProfile) {\r\n    const healingWounds = systemData.wounds.healing += damage;\r\n    const thermalState = systemData.state += attackProfile.thermalChange;\r\n    // Can we add conditions automatically? would be good to add burned here...\r\n    const updates = { \"system.wounds.healing\": damage };\r\n    if (criticalExplosions) {\r\n      let currentBlood = systemData.blood.value -= damage;\r\n      let maxBlood = systemData.blood.max -= damage;\r\n      updates[\"system.blood.current\"] = currentBlood;\r\n      updates[\"system.blood.max\"] = maxBlood;\r\n    }\r\n    return updates;\r\n  }\r\n\r\n  async handlePhysical(systemData, damage, criticalExplosions, attackProfile) {\r\n    const updates = {};\r\n\r\n    if (systemData.canBleed) {\r\n      let activeWounds = systemData.wounds.active += damage;\r\n      updates[\"system.wounds.active\"] = activeWounds;\r\n    }\r\n\r\n    if (systemData.suffersPain) {\r\n      const pain = systemData.pain += damage;\r\n      updates[\"system.pain\"] = pain;\r\n    }\r\n\r\n    if (criticalExplosions) {\r\n      switch (attackProfile.weapon.damageType) {\r\n        case \"crushing\":\r\n          await this.handleCrushingCritical(updates, damage, criticalExplosions);\r\n          break;\r\n        case \"slashing\":\r\n          await this.handleSlashingCritical(updates, damage, criticalExplosions);\r\n          break;\r\n        case \"piercing\":\r\n          await this.handlePiercingCritical(updates, damage, criticalExplosions);\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    }\r\n\r\n    return updates;\r\n  }\r\n\r\n  async handleCrushingCritical(updates, damage, _) {\r\n    updates[\"system.conditions.sundered\"] = damage;\r\n  }\r\n\r\n  async handleSlashingCritical(updates, damage, _) {\r\n    updates[\"system.wounds.active\"] += damage;\r\n  }\r\n\r\n  async handlePiercingCritical(updates, _, criticalExplosions) {\r\n    updates[\"system.conditions.gushingWounds\"] = criticalExplosions;\r\n  }\r\n}","import { d10Roll } from \"../helpers/dice.mjs\";\r\n\r\n/**\r\n * Extend the basic Item with some very simple modifications.\r\n * @extends {Item}\r\n */\r\nexport class AbbrewItem extends Item {\r\n  /**\r\n   * Augment the basic Item data model with additional dynamic data.\r\n   */\r\n  prepareData() {\r\n    // As with the actor class, items are documents that can have their data\r\n    // preparation methods overridden (such as prepareBaseData()).\r\n    super.prepareData();\r\n  }\r\n\r\n  /**\r\n   * Prepare a data object which is passed to any Roll formulas which are created related to this Item\r\n   * @private\r\n   */\r\n  getRollData() {\r\n    // If present, return the actor's roll data.\r\n    if (!this.actor) return null;\r\n    const rollData = this.actor.getRollData();\r\n    // Grab the item's system data as well.\r\n    rollData.item = foundry.utils.deepClone(this.system);\r\n\r\n    return rollData;\r\n  }\r\n\r\n  /**\r\n   * Handle clickable rolls.\r\n   * @param {Event} event   The originating click event\r\n   * @private\r\n   */\r\n  async roll() {\r\n    const item = this;\r\n\r\n    // Initialize chat data.\r\n    const speaker = ChatMessage.getSpeaker({ actor: this.actor });\r\n    const rollMode = game.settings.get('core', 'rollMode');\r\n    const label = `[${item.type}] ${item.name}`;\r\n\r\n    // If there's no roll data, send a chat message.\r\n    if (!this.system.formula) {\r\n      ChatMessage.create({\r\n        speaker: speaker,\r\n        rollMode: rollMode,\r\n        flavor: label,\r\n        content: item.system.description ?? ''\r\n      });\r\n    }\r\n    // Otherwise, create a roll and send a chat message from it.\r\n    else {\r\n      // Retrieve roll data.\r\n      const rollData = this.getRollData();\r\n\r\n      // Invoke the roll and submit it to chat.\r\n      const roll = new Roll(rollData.item.formula, rollData);\r\n      // If you need to store the value first, uncomment the next line.\r\n      // let result = await roll.roll({async: true});\r\n      roll.toMessage({\r\n        speaker: speaker,\r\n        rollMode: rollMode,\r\n        flavor: label,\r\n      });\r\n      return roll;\r\n    }\r\n  }\r\n\r\n  async use(config = {}, options = {}) {\r\n    let item = this;\r\n    const is = item.system;\r\n    const as = item.actor.system;\r\n\r\n    // Ensure the options object is ready\r\n    options = foundry.utils.mergeObject({\r\n      configureDialog: true,\r\n      createMessage: true,\r\n      \"flags.abbrew.use\": { type: this.type, itemId: this.id, itemUuid: this.uuid }\r\n    }, options);\r\n\r\n    const card = await this.displayCard(options);\r\n\r\n    return card;\r\n  }\r\n\r\n  async displayCard(options = {}) {\r\n\r\n    // Render the chat card template\r\n    const token = this.actor.token;\r\n    const templateData = {\r\n      actor: this.actor,\r\n      tokenId: token?.uuid || null,\r\n      item: this,\r\n      data: await this.getChatData(),\r\n      labels: this.labels,\r\n      hasAttack: this.hasAttack,\r\n      isHealing: this.isHealing,\r\n      hasDamage: this.hasDamage,\r\n      isVersatile: this.isVersatile,\r\n      isSpell: this.type === \"spell\",\r\n      hasSave: this.hasSave,\r\n      hasAreaTarget: this.hasAreaTarget,\r\n      isTool: this.type === \"tool\",\r\n      hasAbilityCheck: this.hasAbilityCheck\r\n    };\r\n\r\n    const html = await renderTemplate(\"systems/abbrew/templates/chat/item-card.hbs\", templateData);\r\n\r\n    // Create the ChatMessage data object\r\n    const chatData = {\r\n      user: game.user.id,\r\n      type: CONST.CHAT_MESSAGE_TYPES.OTHER,\r\n      content: html,\r\n      flavor: this.name,\r\n      speaker: ChatMessage.getSpeaker({ actor: this.actor, token }),\r\n      flags: { \"core.canPopout\": true }\r\n    };\r\n\r\n    // If the Item was destroyed in the process of displaying its card - embed the item data in the chat message\r\n    //   if ( (this.type === \"consumable\") && !this.actor.items.has(this.id) ) {\r\n    //     chatData.flags[\"abbrew.itemData\"] = templateData.item.toObject();\r\n    //   }\r\n\r\n    // Merge in the flags from options\r\n    chatData.flags = foundry.utils.mergeObject(chatData.flags, options.flags);\r\n\r\n    /**\r\n     * A hook event that fires before an item chat card is created.\r\n     * @function abbrew.preDisplayCard\r\n     * @memberof hookEvents\r\n     * @param {Item5e} item             Item for which the chat card is being displayed.\r\n     * @param {object} chatData         Data used to create the chat message.\r\n     * @param {ItemUseOptions} options  Options which configure the display of the item chat card.\r\n     */\r\n    Hooks.callAll(\"abbrew.preDisplayCard\", this, chatData, options);\r\n\r\n    // Apply the roll mode to adjust message visibility\r\n    // ChatMessage.applyRollMode(chatData, options.rollMode ?? game.settings.get(\"core\", \"rollMode\"));\r\n\r\n    // const options = { createMessage: true };\r\n\r\n    // Create the Chat Message or return its data\r\n    const card = (options.createMessage !== false) ? await ChatMessage.create(chatData) : chatData;\r\n\r\n    /**\r\n     * A hook event that fires after an item chat card is created.\r\n     * @function abbrew.displayCard\r\n     * @memberof hookEvents\r\n     * @param {Item5e} item              Item for which the chat card is being displayed.\r\n     * @param {ChatMessage|object} card  The created ChatMessage instance or ChatMessageData depending on whether\r\n     *                                   options.createMessage was set to `true`.\r\n     */\r\n    Hooks.callAll(\"abbrew.displayCard\", this, card);\r\n\r\n    return card;\r\n  }\r\n\r\n  async getChatData(htmlOptions = {}) {\r\n    const data = this.toObject().system;\r\n    const labels = this.labels;\r\n\r\n    // Rich text description\r\n    data.description = await TextEditor.enrichHTML(data.description, {\r\n      async: true,\r\n      relativeTo: this,\r\n      rollData: this.getRollData(),\r\n      ...htmlOptions\r\n    });\r\n\r\n    // Item type specific properties\r\n    const props = [];\r\n    // switch ( this.type ) {\r\n    //   case \"consumable\":\r\n    //     this._consumableChatData(data, labels, props); break;\r\n    //   case \"equipment\":\r\n    //     this._equipmentChatData(data, labels, props); break;\r\n    //   case \"feat\":\r\n    //     this._featChatData(data, labels, props); break;\r\n    //   case \"loot\":\r\n    //     this._lootChatData(data, labels, props); break;\r\n    //   case \"spell\":\r\n    //     this._spellChatData(data, labels, props); break;\r\n    //   case \"tool\":\r\n    //     this._toolChatData(data, labels, props); break;\r\n    //   case \"weapon\":\r\n    //     this._weaponChatData(data, labels, props); break;\r\n    // }\r\n\r\n    // // Equipment properties\r\n    // if ( data.hasOwnProperty(\"equipped\") && ![\"loot\", \"tool\"].includes(this.type) ) {\r\n    //   if ( data.attunement === CONFIG.DND5E.attunementTypes.REQUIRED ) {\r\n    //     props.push(CONFIG.DND5E.attunements[CONFIG.DND5E.attunementTypes.REQUIRED]);\r\n    //   }\r\n    //   props.push(\r\n    //     game.i18n.localize(data.equipped ? \"DND5E.Equipped\" : \"DND5E.Unequipped\"),\r\n    //     game.i18n.localize(data.proficient ? \"DND5E.Proficient\" : \"DND5E.NotProficient\")\r\n    //   );\r\n    // }\r\n\r\n    // // Ability activation properties\r\n    // if ( data.hasOwnProperty(\"activation\") ) {\r\n    //   props.push(\r\n    //     labels.activation + (data.activation?.condition ? ` (${data.activation.condition})` : \"\"),\r\n    //     labels.target,\r\n    //     labels.range,\r\n    //     labels.duration\r\n    //   );\r\n    // }\r\n\r\n    // Filter properties and return\r\n    data.properties = props.filter(p => !!p);\r\n    return data;\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n  /*  Chat Message Helpers                        */\r\n  /* -------------------------------------------- */\r\n\r\n  /**\r\n   * Apply listeners to chat messages.\r\n   * @param {HTML} html  Rendered chat message.\r\n   */\r\n  static chatListeners(html) {\r\n    html.on(\"click\", \".card-buttons button\", this._onChatCardAction.bind(this));\r\n    html.on(\"click\", \".item-name\", this._onChatCardToggleContent.bind(this));\r\n  }\r\n\r\n  static async _onChatCardAction(event) {\r\n    event.preventDefault();\r\n\r\n    // Extract card data\r\n    const button = event.currentTarget;\r\n    // Disable Button\r\n    button.disabled = true;\r\n    const card = button.closest(\".chat-card\");\r\n    const messageId = card.closest(\".message\").dataset.messageId;\r\n    const message = game.messages.get(messageId);\r\n    const action = button.dataset.action;\r\n\r\n    // Recover the actor for the chat card\r\n    const actor = await this._getChatCardActor(card);\r\n    if (!actor) return;\r\n\r\n    // Validate permission to proceed with the roll\r\n    const isTargetted = action === \"contest\";\r\n    if (!(isTargetted || game.user.isGM || actor.isOwner)) {\r\n      return;\r\n    }\r\n\r\n    // Get the Item from stored flag data or by the item ID on the Actor\r\n    const storedData = message.getFlag(\"abbrew\", \"itemData\");\r\n    const item = storedData ? new this(storedData, { parent: actor }) : actor.items.get(card.dataset.itemId);\r\n    if (!item) {\r\n      const err = game.i18n.format(\"ABBREW.ActionWarningNoItem\", { item: card.dataset.itemId, name: actor.name });\r\n      return ui.notifications.error(err);\r\n    }\r\n\r\n    await item.rollAttack({ event });\r\n\r\n    // Re-enable the button\r\n    button.disabled = false;\r\n  }\r\n\r\n  async rollAttack(options = {}) {\r\n\r\n    const { rollData, parts } = this.getAttack();\r\n\r\n    let title = `${this.name} - ${game.i18n.localize(\"ABBREW.AttackRoll\")}`;\r\n\r\n    // HERE: Look at skill rolls in 5e\r\n    // TODO: FUCKER WAS COMING FROM HERE\r\n    rollData.mod = 10;\r\n\r\n    // Compose roll options\r\n    const rollConfig = foundry.utils.mergeObject({\r\n      actor: this.actor,\r\n      data: rollData,\r\n      critical: this.getCriticalThreshold(),\r\n      title,\r\n      flavor: title,\r\n      dialogOptions: {\r\n        width: 400,\r\n        top: options.event ? options.event.clientY - 80 : null,\r\n        left: window.innerWidth - 710\r\n      },\r\n      messageData: {\r\n        \"flags.abbrew.roll\": { type: \"attack\", itemId: this.id, itemUuid: this.uuid },\r\n        speaker: ChatMessage.getSpeaker({ actor: this.actor })\r\n      }\r\n    }, options);\r\n    rollConfig.parts = parts.concat(options.parts ?? []);\r\n\r\n    const roll = await d10Roll(rollConfig);\r\n\r\n    return roll;\r\n\r\n  }\r\n\r\n  // TODO: Allow to change\r\n  getCriticalThreshold() {\r\n    return 10;\r\n  }\r\n\r\n  // TODO: Check this is needed\r\n  getAttack() {\r\n    const rollData = this.getRollData();\r\n    const parts = [];\r\n    return { rollData, parts };\r\n  }\r\n\r\n  async update(data = {}, context = {}) {\r\n    console.log('update item');\r\n    super.update(data, context);\r\n  }\r\n\r\n  /**\r\n   * Handle toggling the visibility of chat card content when the name is clicked\r\n   * @param {Event} event   The originating click event\r\n   * @private\r\n   */\r\n  static _onChatCardToggleContent(event) {\r\n    event.preventDefault();\r\n    const header = event.currentTarget;\r\n    const card = header.closest(\".chat-card\");\r\n    const content = card.querySelector(\".card-content\");\r\n    content.style.display = content.style.display === \"none\" ? \"block\" : \"none\";\r\n  }\r\n\r\n  /**\r\n * Get the Actor which is the author of a chat card\r\n * @param {HTMLElement} card    The chat card being used\r\n * @returns {Actor|null}        The Actor document or null\r\n * @private\r\n */\r\n  static async _getChatCardActor(card) {\r\n\r\n    // Case 1 - a synthetic actor from a Token\r\n    if (card.dataset.tokenId) {\r\n      const token = await fromUuid(card.dataset.tokenId);\r\n      if (!token) return null;\r\n      return token.actor;\r\n    }\r\n\r\n    // Case 2 - use Actor ID directory\r\n    const actorId = card.dataset.actorId;\r\n    return game.actors.get(actorId) || null;\r\n  }\r\n\r\n  /**\r\n   * Get the Actor which is the author of a chat card\r\n   * @param {HTMLElement} card    The chat card being used\r\n   * @returns {Actor[]}            An Array of Actor documents, if any\r\n   * @private\r\n   */\r\n  static _getChatCardTargets(card) {\r\n    let targets = canvas.tokens.controlled.filter(t => !!t.actor);\r\n    if (!targets.length && game.user.character) targets = targets.concat(game.user.character.getActiveTokens());\r\n    if (!targets.length) ui.notifications.warn(game.i18n.localize(\"DND5E.ActionWarningNoToken\"));\r\n    return targets;\r\n  }\r\n}\r\n","export async function ChatAbbrew(dataset, element, actor) {\r\n    return;\r\n\r\n    const itemId = element.closest('.item').dataset.itemId;\r\n    const item = actor.items.get(itemId);\r\n\r\n    const templateData = {\r\n        actor,\r\n        item,\r\n        dataset,\r\n        description: item.system.description\r\n    };\r\n\r\n    const html = await renderTemplate(\"systems/abbrew/templates/chat/item-card.hbs\", templateData);\r\n\r\n    // Create the ChatMessage data object\r\n    const chatData = {\r\n        user: game.user.id,\r\n        type: CONST.CHAT_MESSAGE_TYPES.OTHER,\r\n        content: html,\r\n        flavor: item.name,\r\n        speaker: ChatMessage.getSpeaker({ actor, token: actor.token }),\r\n        flags: { \"core.canPopout\": true }\r\n    };\r\n\r\n    // If the Item was destroyed in the process of displaying its card - embed the item data in the chat message\r\n    //   if ( (this.type === \"consumable\") && !this.actor.items.has(this.id) ) {\r\n    //     chatData.flags[\"abbrew.itemData\"] = templateData.item.toObject();\r\n    //   }\r\n\r\n    // Merge in the flags from options\r\n    // chatData.flags = foundry.utils.mergeObject(chatData.flags, options.flags); \r\n\r\n    /**\r\n     * A hook event that fires before an item chat card is created.\r\n     * @function abbrew.preDisplayCard\r\n     * @memberof hookEvents\r\n     * @param {Item5e} item             Item for which the chat card is being displayed.\r\n     * @param {object} chatData         Data used to create the chat message.\r\n     * @param {ItemUseOptions} options  Options which configure the display of the item chat card.\r\n     */\r\n    // Hooks.callAll(\"abbrew.preDisplayCard\", this, chatData, options);\r\n\r\n    // Apply the roll mode to adjust message visibility\r\n    // ChatMessage.applyRollMode(chatData, options.rollMode ?? game.settings.get(\"core\", \"rollMode\"));\r\n\r\n    const options = { createMessage: true };\r\n\r\n    // Create the Chat Message or return its data\r\n    const card = (options.createMessage !== false) ? await ChatMessage.create(chatData) : chatData;\r\n\r\n    /**\r\n     * A hook event that fires after an item chat card is created.\r\n     * @function abbrew.displayCard\r\n     * @memberof hookEvents\r\n     * @param {Item5e} item              Item for which the chat card is being displayed.\r\n     * @param {ChatMessage|object} card  The created ChatMessage instance or ChatMessageData depending on whether\r\n     *                                   options.createMessage was set to `true`.\r\n     */\r\n    Hooks.callAll(\"abbrew.displayCard\", this, card);\r\n\r\n    return card;\r\n}","/**\r\n * Manage Active Effect instances through the Actor Sheet via effect control buttons.\r\n * @param {MouseEvent} event      The left-click event on the effect control\r\n * @param {Actor|Item} owner      The owning document which manages this effect\r\n */\r\n export function onManageActiveEffect(event, owner) {\r\n  event.preventDefault();\r\n  const a = event.currentTarget;\r\n  const li = a.closest(\"li\");\r\n  const effect = li.dataset.effectId ? owner.effects.get(li.dataset.effectId) : null;\r\n  switch ( a.dataset.action ) {\r\n    case \"create\":\r\n      return owner.createEmbeddedDocuments(\"ActiveEffect\", [{\r\n        label: \"New Effect\",\r\n        icon: \"icons/svg/aura.svg\",\r\n        source: owner.uuid,\r\n        \"duration.rounds\": li.dataset.effectType === \"temporary\" ? 1 : undefined,\r\n        disabled: li.dataset.effectType === \"inactive\"\r\n      }]);\r\n    case \"edit\":\r\n      return effect.sheet.render(true);\r\n    case \"delete\":\r\n      return effect.delete();\r\n    case \"toggle\":\r\n      return effect.update({disabled: !effect.disabled});\r\n  }\r\n}\r\n\r\n/**\r\n * Prepare the data structure for Active Effects which are currently applied to an Actor or Item.\r\n * @param {ActiveEffect[]} effects    The array of Active Effect instances to prepare sheet data for\r\n * @return {object}                   Data for rendering\r\n */\r\nexport function prepareActiveEffectCategories(effects) {\r\n\r\n    // Define effect header categories\r\n    const categories = {\r\n      temporary: {\r\n        type: \"temporary\",\r\n        label: \"Temporary Effects\",\r\n        effects: []\r\n      },\r\n      passive: {\r\n        type: \"passive\",\r\n        label: \"Passive Effects\",\r\n        effects: []\r\n      },\r\n      inactive: {\r\n        type: \"inactive\",\r\n        label: \"Inactive Effects\",\r\n        effects: []\r\n      }\r\n    };\r\n\r\n    // Iterate over active effects, classifying them into categories\r\n    for ( let e of effects ) {\r\n      e._getSourceName(); // Trigger a lookup for the source name\r\n      if ( e.disabled ) categories.inactive.effects.push(e);\r\n      else if ( e.isTemporary ) categories.temporary.effects.push(e);\r\n      else categories.passive.effects.push(e);\r\n    }\r\n    return categories;\r\n}","import { useAttack, onAttackCardAction } from \"../documents/attackprofile.mjs\";\r\nimport { ChatAbbrew } from \"../helpers/chat.mjs\";\r\nimport { onManageActiveEffect, prepareActiveEffectCategories } from \"../helpers/effects.mjs\";\r\n\r\n/**\r\n * Extend the basic ActorSheet\r\n * @extends {ActorSheet}\r\n */\r\nexport class AbbrewActorSheet extends ActorSheet {\r\n\r\n  /** @override */\r\n  static get defaultOptions() {\r\n    return mergeObject(super.defaultOptions, {\r\n      classes: [\"abbrew\", \"sheet\", \"actor\"],\r\n      template: \"systems/abbrew/templates/actor/actor-sheet.hbs\",\r\n      width: 600,\r\n      height: 600,\r\n      tabs: [{ navSelector: \".sheet-tabs\", contentSelector: \".sheet-body\", initial: \"features\" }]\r\n    });\r\n  }\r\n\r\n  /** @override */\r\n  get template() {\r\n    return `systems/abbrew/templates/actor/actor-${this.actor.type}-sheet.hbs`;\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n\r\n  /** @override */\r\n  getData() {\r\n    // Retrieve the data structure from the base sheet. You can inspect or log\r\n    // the context variable to see the structure, but some key properties for\r\n    // sheets are the actor object, the data object, whether or not it's\r\n    // editable, the items array, and the effects array.\r\n    const context = super.getData();\r\n\r\n    // Use a safe clone of the actor data for further operations.\r\n    const actorData = this.actor.toObject(false);\r\n\r\n    // Add the actor's data to context.data for easier access, as well as flags.\r\n    context.system = actorData.system;\r\n    context.flags = actorData.flags;\r\n\r\n    // Prepare character data and items.\r\n    if (actorData.type == 'character') {\r\n      this._prepareItems(context);\r\n      this._prepareCharacterData(context);\r\n      this._prepareAttacks(context);\r\n      this._prepareArmours(context);\r\n      context.displayConditions  = actorData.system.displayConditions;\r\n    }\r\n\r\n    // Prepare NPC data and items.\r\n    if (actorData.type == 'npc') {\r\n      this._prepareItems(context);\r\n    }\r\n\r\n    // Add roll data for TinyMCE editors.\r\n    context.rollData = context.actor.getRollData();\r\n\r\n    // Prepare active effects\r\n    context.effects = prepareActiveEffectCategories(this.actor.effects);\r\n\r\n    return context;\r\n  }\r\n\r\n  /**\r\n   * Organize and classify Items for Character sheets.\r\n   *\r\n   * @param {Object} actorData The actor to prepare.\r\n   *\r\n   * @return {undefined}\r\n   */\r\n  _prepareCharacterData(context) {\r\n    // Handle ability scores.\r\n    for (let [k, v] of Object.entries(context.system.statistics)) {\r\n      v.label = game.i18n.localize(CONFIG.ABBREW.statistics[k]) ?? k;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Organize and classify Items for Character sheets.\r\n   *\r\n   * @param {Object} actorData The actor to prepare.\r\n   *\r\n   * @return {undefined}\r\n   */\r\n  _prepareItems(context) {\r\n    // Initialize containers.\r\n    const anatomy = [];\r\n    const resources = [];\r\n    const abilities = [];\r\n    const gear = [];\r\n    const features = [];\r\n    const spells = {\r\n      0: [],\r\n      1: [],\r\n      2: [],\r\n      3: [],\r\n      4: [],\r\n      5: [],\r\n      6: [],\r\n      7: [],\r\n      8: [],\r\n      9: []\r\n    };\r\n\r\n    // Iterate through items, allocating to containers\r\n    for (let i of context.items) {\r\n      i.img = i.img || DEFAULT_TOKEN;\r\n      // Append to resources.\r\n      if (i.type === 'anatomy') {\r\n        anatomy.push(i);\r\n      }\r\n      // Append to resources.\r\n      else if (i.type === 'resource') {\r\n        resources.push(i);\r\n      }\r\n      // Append to gear.\r\n      else if (i.type === 'item') {\r\n        gear.push(i);\r\n      }\r\n      // Append to features.\r\n      else if (i.type === 'feature') {\r\n        features.push(i);\r\n      }\r\n      // Append to Abilities\r\n      else if (i.type === 'ability') {\r\n        abilities.push(i);\r\n      }\r\n      // Append to spells.\r\n      else if (i.type === 'spell') {\r\n        if (i.system.spellLevel != undefined) {\r\n          spells[i.system.spellLevel].push(i);\r\n        }\r\n      }\r\n    }\r\n\r\n    // Assign and return\r\n    // ABDOC: name here in context used in hbs to pull values\r\n    context.resource = resources;\r\n    context.gear = gear;\r\n    context.features = features;\r\n    context.spells = spells;\r\n    context.anatomy = anatomy;\r\n    context.ability = abilities;\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n\r\n  _prepareAttacks(context) {\r\n    context.attacks = context.system.attacks;\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n\r\n  _prepareArmours(context) {\r\n    context.armours = context.system.armours;\r\n  }\r\n\r\n\r\n  /* -------------------------------------------- */\r\n\r\n  /** @override */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n\r\n    // Render the item sheet for viewing/editing prior to the editable check.\r\n    html.find('.item-edit').click(ev => {\r\n      const li = $(ev.currentTarget).parents(\".item\");\r\n      const item = this.actor.items.get(li.data(\"itemId\"));\r\n      item.sheet.render(true);\r\n    });\r\n\r\n    // -------------------------------------------------------------\r\n    // Everything below here is only needed if the sheet is editable\r\n    if (!this.isEditable) return;\r\n\r\n    // Show/Hide Conditions\r\n    html.find('.conditions-header').click(async ev => {\r\n      const context = super.getData();\r\n      await this.actor.update({\"system.displayConditions\": !this.actor.system.displayConditions});\r\n    });\r\n\r\n    // Add Inventory Item\r\n    html.find('.item-create').click(this._onItemCreate.bind(this));\r\n\r\n    // Delete Inventory Item\r\n    html.find('.item-delete').click(ev => {\r\n      const li = $(ev.currentTarget).parents(\".item\");\r\n      const item = this.actor.items.get(li.data(\"itemId\"));\r\n      item.delete();\r\n      li.slideUp(200, () => this.render(false));\r\n    });\r\n\r\n    // Active Effect management\r\n    html.find(\".effect-control\").click(ev => onManageActiveEffect(ev, this.actor));\r\n\r\n    // Rollable abilities.\r\n    html.find('.rollable .item-image').click(this._onItemUse.bind(this));\r\n\r\n    // attacks\r\n    html.find('.equip-weapon').click(this._equipWeapon.bind(this));\r\n    html.find('.rollable.attack').click(this._onAttackUse.bind(this));\r\n\r\n    // armour\r\n    html.find('.equip-armour').click(this._equipArmour.bind(this));    \r\n\r\n    // Drag events for macros.\r\n    if (this.actor.isOwner) {\r\n      let handler = ev => this._onDragStart(ev);\r\n      html.find('li.item').each((i, li) => {\r\n        if (li.classList.contains(\"inventory-header\")) return;\r\n        li.setAttribute(\"draggable\", true);\r\n        li.addEventListener(\"dragstart\", handler, false);\r\n      });\r\n    }\r\n  }\r\n\r\n  async _equipWeapon(event) {\r\n    event.preventDefault();\r\n    const dataSet = event.target.dataset\r\n    const weaponId = dataSet.weaponid;\r\n    const equip = dataSet.equip === \"true\";\r\n    await this.actor.equipWeapon(weaponId, equip)\r\n  }\r\n\r\n  async _equipArmour(event) {\r\n    event.preventDefault();\r\n    const dataSet = event.target.dataset\r\n    const armourId = dataSet.armourid;\r\n    const equip = dataSet.equip === \"true\";\r\n    await this.actor.equipArmour(armourId, equip)\r\n  }\r\n\r\n  /**\r\n   * Handle creating a new Owned Item for the actor using initial data defined in the HTML dataset\r\n   * @param {Event} event   The originating click event\r\n   * @private\r\n   */\r\n  async _onItemCreate(event) {\r\n    event.preventDefault();\r\n    const header = event.currentTarget;\r\n    const type = header.dataset.type;\r\n\r\n    // Check to make sure the newly created class doesn't take player over level cap\r\n    if (type === \"ability\" && (this.actor.system.IP.current + 1 > this.actor.system.IP.total)) {\r\n      const err = game.i18n.format(\"ABBREW.InspirationPointsExceededWarn\", { max: this.actor.system.IP.total });\r\n      return ui.notifications.error(err);\r\n    }\r\n\r\n    const itemData = {\r\n      name: game.i18n.format(\"ABBREW.ItemNew\", { type: game.i18n.localize(`ITEM.Type${type.capitalize()}`) }),\r\n      type: type,\r\n      system: { ...header.dataset.type }\r\n    };\r\n    delete itemData.system.type;\r\n\r\n    return this.actor.createEmbeddedDocuments(\"Item\", [itemData]);\r\n  }\r\n\r\n  /**\r\n   * Handle clickable rolls.\r\n   * @param {Event} event   The originating click event\r\n   * @private\r\n   */\r\n  async _onItemUse(event) {\r\n    event.preventDefault();\r\n    const element = event.currentTarget;\r\n    const dataset = element.dataset;\r\n    const actor = this.actor;\r\n    ChatAbbrew(dataset, element, actor);\r\n    const itemId = event.currentTarget.closest(\".item\").dataset.itemId;\r\n    const item = this.actor.items.get(itemId);\r\n    // await this.displayCard(dataset, element, actor)\r\n    return item.use({}, { event });\r\n  }\r\n\r\n  async _onAttackUse(event) {\r\n    event.preventDefault();\r\n    console.log(event);\r\n    const data = event.target.dataset;\r\n    const attack = this.actor.system.attacks.filter(a => a.id === data.attack)[0];\r\n    const attackProfile = attack.profiles.flat().filter(ap => ap.id === + data.attackprofile)[0];\r\n    useAttack(attack, attackProfile, this.actor);\r\n  }\r\n}\r\n","/**\n * Tagify (v 4.17.8) - tags input component\n * By undefined\n * https://github.com/yairEO/tagify\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n * \r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n * \r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n * THE SOFTWARE.\r\n * \r\n * THE SOFTWARE IS NOT PERMISSIBLE TO BE SOLD.\n */\n\n!function(t,e){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=e():\"function\"==typeof define&&define.amd?define(e):(t=\"undefined\"!=typeof globalThis?globalThis:t||self).Tagify=e()}(this,(function(){\"use strict\";function t(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function e(e){for(var s=1;s<arguments.length;s++){var a=null!=arguments[s]?arguments[s]:{};s%2?t(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):t(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(t,e,i){return(e=function(t){var e=function(t,e){if(\"object\"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||\"default\");if(\"object\"!=typeof s)return s;throw new TypeError(\"@@toPrimitive must return a primitive value.\")}return(\"string\"===e?String:Number)(t)}(t,\"string\");return\"symbol\"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const s=(t,e,i,s)=>(t=\"\"+t,e=\"\"+e,s&&(t=t.trim(),e=e.trim()),i?t==e:t.toLowerCase()==e.toLowerCase()),a=(t,e)=>t&&Array.isArray(t)&&t.map((t=>n(t,e)));function n(t,e){var i,s={};for(i in t)e.indexOf(i)<0&&(s[i]=t[i]);return s}function o(t){var e=document.createElement(\"div\");return t.replace(/\\&#?[0-9a-z]+;/gi,(function(t){return e.innerHTML=t,e.innerText}))}function r(t){return(new DOMParser).parseFromString(t.trim(),\"text/html\").body.firstElementChild}function l(t,e){for(e=e||\"previous\";t=t[e+\"Sibling\"];)if(3==t.nodeType)return t}function d(t){return\"string\"==typeof t?t.replace(/&/g,\"&amp;\").replace(/</g,\"&lt;\").replace(/>/g,\"&gt;\").replace(/\"/g,\"&quot;\").replace(/`|'/g,\"&#039;\"):t}function h(t){var e=Object.prototype.toString.call(t).split(\" \")[1].slice(0,-1);return t===Object(t)&&\"Array\"!=e&&\"Function\"!=e&&\"RegExp\"!=e&&\"HTMLUnknownElement\"!=e}function g(t,e,i){function s(t,e){for(var i in e)if(e.hasOwnProperty(i)){if(h(e[i])){h(t[i])?s(t[i],e[i]):t[i]=Object.assign({},e[i]);continue}if(Array.isArray(e[i])){t[i]=Object.assign([],e[i]);continue}t[i]=e[i]}}return t instanceof Object||(t={}),s(t,e),i&&s(t,i),t}function p(){const t=[],e={};for(let i of arguments)for(let s of i)h(s)?e[s.value]||(t.push(s),e[s.value]=1):t.includes(s)||t.push(s);return t}function c(t){return String.prototype.normalize?\"string\"==typeof t?t.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g,\"\"):void 0:t}var u=()=>/(?=.*chrome)(?=.*android)/i.test(navigator.userAgent);function m(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)))}function v(t){return t&&t.classList&&t.classList.contains(this.settings.classNames.tag)}function f(t,e){var i=window.getSelection();return e=e||i.getRangeAt(0),\"string\"==typeof t&&(t=document.createTextNode(t)),e&&(e.deleteContents(),e.insertNode(t)),t}function T(t,e,i){return t?(e&&(t.__tagifyTagData=i?e:g({},t.__tagifyTagData||{},e)),t.__tagifyTagData):(console.warn(\"tag element doesn't exist\",t,e),e)}var w={delimiters:\",\",pattern:null,tagTextProp:\"value\",maxTags:1/0,callbacks:{},addTagOnBlur:!0,onChangeAfterBlur:!0,duplicates:!1,whitelist:[],blacklist:[],enforceWhitelist:!1,userInput:!0,keepInvalidTags:!1,createInvalidTags:!0,mixTagsAllowedAfter:/,|\\.|\\:|\\s/,mixTagsInterpolator:[\"[[\",\"]]\"],backspace:!0,skipInvalid:!1,pasteAsTags:!0,editTags:{clicks:2,keepInvalid:!0},transformTag:()=>{},trim:!0,a11y:{focusableTags:!1},mixMode:{insertAfterTag:\"Â \"},autoComplete:{enabled:!0,rightKey:!1},classNames:{namespace:\"tagify\",mixMode:\"tagify--mix\",selectMode:\"tagify--select\",input:\"tagify__input\",focus:\"tagify--focus\",tagNoAnimation:\"tagify--noAnim\",tagInvalid:\"tagify--invalid\",tagNotAllowed:\"tagify--notAllowed\",scopeLoading:\"tagify--loading\",hasMaxTags:\"tagify--hasMaxTags\",hasNoTags:\"tagify--noTags\",empty:\"tagify--empty\",inputInvalid:\"tagify__input--invalid\",dropdown:\"tagify__dropdown\",dropdownWrapper:\"tagify__dropdown__wrapper\",dropdownHeader:\"tagify__dropdown__header\",dropdownFooter:\"tagify__dropdown__footer\",dropdownItem:\"tagify__dropdown__item\",dropdownItemActive:\"tagify__dropdown__item--active\",dropdownItemHidden:\"tagify__dropdown__item--hidden\",dropdownInital:\"tagify__dropdown--initial\",tag:\"tagify__tag\",tagText:\"tagify__tag-text\",tagX:\"tagify__tag__removeBtn\",tagLoading:\"tagify__tag--loading\",tagEditing:\"tagify__tag--editable\",tagFlash:\"tagify__tag--flash\",tagHide:\"tagify__tag--hide\"},dropdown:{classname:\"\",enabled:2,maxItems:10,searchKeys:[\"value\",\"searchBy\"],fuzzySearch:!0,caseSensitive:!1,accentedSearch:!0,includeSelectedTags:!1,highlightFirst:!1,closeOnSelect:!0,clearOnSelect:!0,position:\"all\",appendTarget:null},hooks:{beforeRemoveTag:()=>Promise.resolve(),beforePaste:()=>Promise.resolve(),suggestionClick:()=>Promise.resolve()}};function b(){this.dropdown={};for(let t in this._dropdown)this.dropdown[t]=\"function\"==typeof this._dropdown[t]?this._dropdown[t].bind(this):this._dropdown[t];this.dropdown.refs()}var y={refs(){this.DOM.dropdown=this.parseTemplate(\"dropdown\",[this.settings]),this.DOM.dropdown.content=this.DOM.dropdown.querySelector(\"[data-selector='tagify-suggestions-wrapper']\")},getHeaderRef(){return this.DOM.dropdown.querySelector(\"[data-selector='tagify-suggestions-header']\")},getFooterRef(){return this.DOM.dropdown.querySelector(\"[data-selector='tagify-suggestions-footer']\")},getAllSuggestionsRefs(){return[...this.DOM.dropdown.content.querySelectorAll(this.settings.classNames.dropdownItemSelector)]},show(t){var e,i,a,n=this.settings,o=\"mix\"==n.mode&&!n.enforceWhitelist,r=!n.whitelist||!n.whitelist.length,l=\"manual\"==n.dropdown.position;if(t=void 0===t?this.state.inputText:t,!(r&&!o&&!n.templates.dropdownItemNoMatch||!1===n.dropdown.enable||this.state.isLoading||this.settings.readonly)){if(clearTimeout(this.dropdownHide__bindEventsTimeout),this.suggestedListItems=this.dropdown.filterListItems(t),t&&!this.suggestedListItems.length&&(this.trigger(\"dropdown:noMatch\",t),n.templates.dropdownItemNoMatch&&(a=n.templates.dropdownItemNoMatch.call(this,{value:t}))),!a){if(this.suggestedListItems.length)t&&o&&!this.state.editing.scope&&!s(this.suggestedListItems[0].value,t)&&this.suggestedListItems.unshift({value:t});else{if(!t||!o||this.state.editing.scope)return this.input.autocomplete.suggest.call(this),void this.dropdown.hide();this.suggestedListItems=[{value:t}]}i=\"\"+(h(e=this.suggestedListItems[0])?e.value:e),n.autoComplete&&i&&0==i.indexOf(t)&&this.input.autocomplete.suggest.call(this,e)}this.dropdown.fill(a),n.dropdown.highlightFirst&&this.dropdown.highlightOption(this.DOM.dropdown.content.querySelector(n.classNames.dropdownItemSelector)),this.state.dropdown.visible||setTimeout(this.dropdown.events.binding.bind(this)),this.state.dropdown.visible=t||!0,this.state.dropdown.query=t,this.setStateSelection(),l||setTimeout((()=>{this.dropdown.position(),this.dropdown.render()})),setTimeout((()=>{this.trigger(\"dropdown:show\",this.DOM.dropdown)}))}},hide(t){var e=this.DOM,i=e.scope,s=e.dropdown,a=\"manual\"==this.settings.dropdown.position&&!t;if(s&&document.body.contains(s)&&!a)return window.removeEventListener(\"resize\",this.dropdown.position),this.dropdown.events.binding.call(this,!1),i.setAttribute(\"aria-expanded\",!1),s.parentNode.removeChild(s),setTimeout((()=>{this.state.dropdown.visible=!1}),100),this.state.dropdown.query=this.state.ddItemData=this.state.ddItemElm=this.state.selection=null,this.state.tag&&this.state.tag.value.length&&(this.state.flaggedTags[this.state.tag.baseOffset]=this.state.tag),this.trigger(\"dropdown:hide\",s),this},toggle(t){this.dropdown[this.state.dropdown.visible&&!t?\"hide\":\"show\"]()},render(){var t,e,i,s=(t=this.DOM.dropdown,(i=t.cloneNode(!0)).style.cssText=\"position:fixed; top:-9999px; opacity:0\",document.body.appendChild(i),e=i.clientHeight,i.parentNode.removeChild(i),e),a=this.settings;return\"number\"==typeof a.dropdown.enabled&&a.dropdown.enabled>=0?(this.DOM.scope.setAttribute(\"aria-expanded\",!0),document.body.contains(this.DOM.dropdown)||(this.DOM.dropdown.classList.add(a.classNames.dropdownInital),this.dropdown.position(s),a.dropdown.appendTarget.appendChild(this.DOM.dropdown),setTimeout((()=>this.DOM.dropdown.classList.remove(a.classNames.dropdownInital)))),this):this},fill(t){t=\"string\"==typeof t?t:this.dropdown.createListHTML(t||this.suggestedListItems);var e,i=this.settings.templates.dropdownContent.call(this,t);this.DOM.dropdown.content.innerHTML=(e=i)?e.replace(/\\>[\\r\\n ]+\\</g,\"><\").replace(/(<.*?>)|\\s+/g,((t,e)=>e||\" \")):\"\"},fillHeaderFooter(){var t=this.dropdown.filterListItems(this.state.dropdown.query),e=this.parseTemplate(\"dropdownHeader\",[t]),i=this.parseTemplate(\"dropdownFooter\",[t]),s=this.dropdown.getHeaderRef(),a=this.dropdown.getFooterRef();e&&s?.parentNode.replaceChild(e,s),i&&a?.parentNode.replaceChild(i,a)},refilter(t){t=t||this.state.dropdown.query||\"\",this.suggestedListItems=this.dropdown.filterListItems(t),this.dropdown.fill(),this.suggestedListItems.length||this.dropdown.hide(),this.trigger(\"dropdown:updated\",this.DOM.dropdown)},position(t){var e=this.settings.dropdown;if(\"manual\"!=e.position){var i,s,a,n,o,r,l=this.DOM.dropdown,d=e.placeAbove,h=e.appendTarget===document.body,g=h?window.pageYOffset:e.appendTarget.scrollTop,p=document.fullscreenElement||document.webkitFullscreenElement||document.documentElement,c=p.clientHeight,u=Math.max(p.clientWidth||0,window.innerWidth||0)>480?e.position:\"all\",m=this.DOM[\"input\"==u?\"input\":\"scope\"];if(t=t||l.clientHeight,this.state.dropdown.visible){if(\"text\"==u?(a=(i=function(){const t=document.getSelection();if(t.rangeCount){const e=t.getRangeAt(0),i=e.startContainer,s=e.startOffset;let a,n;if(s>0)return n=document.createRange(),n.setStart(i,s-1),n.setEnd(i,s),a=n.getBoundingClientRect(),{left:a.right,top:a.top,bottom:a.bottom};if(i.getBoundingClientRect)return i.getBoundingClientRect()}return{left:-9999,top:-9999}}()).bottom,s=i.top,n=i.left,o=\"auto\"):(r=function(t){for(var e=0,i=0;t&&t!=p;)e+=t.offsetLeft||0,i+=t.offsetTop||0,t=t.parentNode;return{left:e,top:i}}(e.appendTarget),s=(i=m.getBoundingClientRect()).top-r.top,a=i.bottom-1-r.top,n=i.left-r.left,o=i.width+\"px\"),!h){let t=function(){for(var t=0,i=e.appendTarget.parentNode;i;)t+=i.scrollTop||0,i=i.parentNode;return t}();s+=t,a+=t}s=Math.floor(s),a=Math.ceil(a),d=void 0===d?c-i.bottom<t:d,l.style.cssText=\"left:\"+(n+window.pageXOffset)+\"px; width:\"+o+\";\"+(d?\"top: \"+(s+g)+\"px\":\"top: \"+(a+g)+\"px\"),l.setAttribute(\"placement\",d?\"top\":\"bottom\"),l.setAttribute(\"position\",u)}}},events:{binding(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];var e=this.dropdown.events.callbacks,i=this.listeners.dropdown=this.listeners.dropdown||{position:this.dropdown.position.bind(this,null),onKeyDown:e.onKeyDown.bind(this),onMouseOver:e.onMouseOver.bind(this),onMouseLeave:e.onMouseLeave.bind(this),onClick:e.onClick.bind(this),onScroll:e.onScroll.bind(this)},s=t?\"addEventListener\":\"removeEventListener\";\"manual\"!=this.settings.dropdown.position&&(document[s](\"scroll\",i.position,!0),window[s](\"resize\",i.position),window[s](\"keydown\",i.onKeyDown)),this.DOM.dropdown[s](\"mouseover\",i.onMouseOver),this.DOM.dropdown[s](\"mouseleave\",i.onMouseLeave),this.DOM.dropdown[s](\"mousedown\",i.onClick),this.DOM.dropdown.content[s](\"scroll\",i.onScroll)},callbacks:{onKeyDown(t){if(this.state.hasFocus&&!this.state.composing){var e=this.DOM.dropdown.querySelector(this.settings.classNames.dropdownItemActiveSelector),i=this.dropdown.getSuggestionDataByNode(e);switch(t.key){case\"ArrowDown\":case\"ArrowUp\":case\"Down\":case\"Up\":t.preventDefault();var s=this.dropdown.getAllSuggestionsRefs(),a=\"ArrowUp\"==t.key||\"Up\"==t.key;e&&(e=this.dropdown.getNextOrPrevOption(e,!a)),e&&e.matches(this.settings.classNames.dropdownItemSelector)||(e=s[a?s.length-1:0]),this.dropdown.highlightOption(e,!0);break;case\"Escape\":case\"Esc\":this.dropdown.hide();break;case\"ArrowRight\":if(this.state.actions.ArrowLeft)return;case\"Tab\":if(\"mix\"!=this.settings.mode&&e&&!this.settings.autoComplete.rightKey&&!this.state.editing){t.preventDefault();var n=this.dropdown.getMappedValue(i);return this.input.autocomplete.set.call(this,n),!1}return!0;case\"Enter\":t.preventDefault(),this.settings.hooks.suggestionClick(t,{tagify:this,tagData:i,suggestionElm:e}).then((()=>{if(e)return this.dropdown.selectOption(e),e=this.dropdown.getNextOrPrevOption(e,!a),void this.dropdown.highlightOption(e);this.dropdown.hide(),\"mix\"!=this.settings.mode&&this.addTags(this.state.inputText.trim(),!0)})).catch((t=>t));break;case\"Backspace\":{if(\"mix\"==this.settings.mode||this.state.editing.scope)return;const t=this.input.raw.call(this);\"\"!=t&&8203!=t.charCodeAt(0)||(!0===this.settings.backspace?this.removeTags():\"edit\"==this.settings.backspace&&setTimeout(this.editTag.bind(this),0))}}}},onMouseOver(t){var e=t.target.closest(this.settings.classNames.dropdownItemSelector);e&&this.dropdown.highlightOption(e)},onMouseLeave(t){this.dropdown.highlightOption()},onClick(t){if(0==t.button&&t.target!=this.DOM.dropdown&&t.target!=this.DOM.dropdown.content){var e=t.target.closest(this.settings.classNames.dropdownItemSelector),i=this.dropdown.getSuggestionDataByNode(e);this.state.actions.selectOption=!0,setTimeout((()=>this.state.actions.selectOption=!1),50),this.settings.hooks.suggestionClick(t,{tagify:this,tagData:i,suggestionElm:e}).then((()=>{e?this.dropdown.selectOption(e,t):this.dropdown.hide()})).catch((t=>console.warn(t)))}},onScroll(t){var e=t.target,i=e.scrollTop/(e.scrollHeight-e.parentNode.clientHeight)*100;this.trigger(\"dropdown:scroll\",{percentage:Math.round(i)})}}},getSuggestionDataByNode(t){var e=t&&t.getAttribute(\"value\");return this.suggestedListItems.find((t=>t.value==e))||null},getNextOrPrevOption(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var i=this.dropdown.getAllSuggestionsRefs(),s=i.findIndex((e=>e===t));return e?i[s+1]:i[s-1]},highlightOption(t,e){var i,s=this.settings.classNames.dropdownItemActive;if(this.state.ddItemElm&&(this.state.ddItemElm.classList.remove(s),this.state.ddItemElm.removeAttribute(\"aria-selected\")),!t)return this.state.ddItemData=null,this.state.ddItemElm=null,void this.input.autocomplete.suggest.call(this);i=this.dropdown.getSuggestionDataByNode(t),this.state.ddItemData=i,this.state.ddItemElm=t,t.classList.add(s),t.setAttribute(\"aria-selected\",!0),e&&(t.parentNode.scrollTop=t.clientHeight+t.offsetTop-t.parentNode.clientHeight),this.settings.autoComplete&&(this.input.autocomplete.suggest.call(this,i),this.dropdown.position())},selectOption(t,e){var i=this.settings.dropdown,s=i.clearOnSelect,a=i.closeOnSelect;if(!t)return this.addTags(this.state.inputText,!0),void(a&&this.dropdown.hide());e=e||{};var n=t.getAttribute(\"value\"),o=\"noMatch\"==n,r=this.suggestedListItems.find((t=>(t.value??t)==n));this.trigger(\"dropdown:select\",{data:r,elm:t,event:e}),n&&(r||o)?(this.state.editing?this.onEditTagDone(null,g({__isValid:!0},this.normalizeTags([r])[0])):this[\"mix\"==this.settings.mode?\"addMixTags\":\"addTags\"]([r||this.input.raw.call(this)],s),this.DOM.input.parentNode&&(setTimeout((()=>{this.DOM.input.focus(),this.toggleFocusClass(!0)})),a&&setTimeout(this.dropdown.hide.bind(this)),t.addEventListener(\"transitionend\",(()=>{this.dropdown.fillHeaderFooter(),setTimeout((()=>t.remove()),100)}),{once:!0}),t.classList.add(this.settings.classNames.dropdownItemHidden))):a&&setTimeout(this.dropdown.hide.bind(this))},selectAll(t){this.suggestedListItems.length=0,this.dropdown.hide(),this.dropdown.filterListItems(\"\");var e=this.dropdown.filterListItems(\"\");return t||(e=this.state.dropdown.suggestions),this.addTags(e,!0),this},filterListItems(t,e){var i,s,a,n,o,r=this.settings,l=r.dropdown,d=(e=e||{},[]),g=[],p=r.whitelist,u=l.maxItems>=0?l.maxItems:1/0,m=l.searchKeys,v=0;if(!(t=\"select\"==r.mode&&this.value.length&&this.value[0][r.tagTextProp]==t?\"\":t)||!m.length)return d=l.includeSelectedTags?p:p.filter((t=>!this.isTagDuplicate(h(t)?t.value:t))),this.state.dropdown.suggestions=d,d.slice(0,u);function f(t,e){return e.toLowerCase().split(\" \").every((e=>t.includes(e.toLowerCase())))}for(o=l.caseSensitive?\"\"+t:(\"\"+t).toLowerCase();v<p.length;v++){let t,r;i=p[v]instanceof Object?p[v]:{value:p[v]};let u=!Object.keys(i).some((t=>m.includes(t)))?[\"value\"]:m;l.fuzzySearch&&!e.exact?(a=u.reduce(((t,e)=>t+\" \"+(i[e]||\"\")),\"\").toLowerCase().trim(),l.accentedSearch&&(a=c(a),o=c(o)),t=0==a.indexOf(o),r=a===o,s=f(a,o)):(t=!0,s=u.some((t=>{var s=\"\"+(i[t]||\"\");return l.accentedSearch&&(s=c(s),o=c(o)),l.caseSensitive||(s=s.toLowerCase()),r=s===o,e.exact?s===o:0==s.indexOf(o)}))),n=!l.includeSelectedTags&&this.isTagDuplicate(h(i)?i.value:i),s&&!n&&(r&&t?g.push(i):\"startsWith\"==l.sortby&&t?d.unshift(i):d.push(i))}return this.state.dropdown.suggestions=g.concat(d),\"function\"==typeof l.sortby?l.sortby(g.concat(d),o):g.concat(d).slice(0,u)},getMappedValue(t){var e=this.settings.dropdown.mapValueTo;return e?\"function\"==typeof e?e(t):t[e]||t.value:t.value},createListHTML(t){return g([],t).map(((t,i)=>{\"string\"!=typeof t&&\"number\"!=typeof t||(t={value:t});var s=this.dropdown.getMappedValue(t);return s=\"string\"==typeof s?d(s):s,this.settings.templates.dropdownItem.apply(this,[e(e({},t),{},{mappedValue:s}),this])})).join(\"\")}};const x=\"@yaireo/tagify/\";var O,D={empty:\"empty\",exceed:\"number of tags exceeded\",pattern:\"pattern mismatch\",duplicate:\"already exists\",notAllowed:\"not allowed\"},M={wrapper:(t,e)=>`<tags class=\"${e.classNames.namespace} ${e.mode?`${e.classNames[e.mode+\"Mode\"]}`:\"\"} ${t.className}\"\\n                    ${e.readonly?\"readonly\":\"\"}\\n                    ${e.disabled?\"disabled\":\"\"}\\n                    ${e.required?\"required\":\"\"}\\n                    ${\"select\"===e.mode?\"spellcheck='false'\":\"\"}\\n                    tabIndex=\"-1\">\\n            <span ${!e.readonly&&e.userInput?\"contenteditable\":\"\"} tabIndex=\"0\" data-placeholder=\"${e.placeholder||\"&#8203;\"}\" aria-placeholder=\"${e.placeholder||\"\"}\"\\n                class=\"${e.classNames.input}\"\\n                role=\"textbox\"\\n                aria-autocomplete=\"both\"\\n                aria-multiline=\"${\"mix\"==e.mode}\"></span>\\n                &#8203;\\n        </tags>`,tag(t,e){let i=e.settings;return`<tag title=\"${t.title||t.value}\"\\n                    contenteditable='false'\\n                    spellcheck='false'\\n                    tabIndex=\"${i.a11y.focusableTags?0:-1}\"\\n                    class=\"${i.classNames.tag} ${t.class||\"\"}\"\\n                    ${this.getAttributes(t)}>\\n            <x title='' class=\"${i.classNames.tagX}\" role='button' aria-label='remove tag'></x>\\n            <div>\\n                <span class=\"${i.classNames.tagText}\">${t[i.tagTextProp]||t.value}</span>\\n            </div>\\n        </tag>`},dropdown(t){var e=t.dropdown,i=\"manual\"==e.position,s=`${t.classNames.dropdown}`;return`<div class=\"${i?\"\":s} ${e.classname}\" role=\"listbox\" aria-labelledby=\"dropdown\">\\n                    <div data-selector='tagify-suggestions-wrapper' class=\"${t.classNames.dropdownWrapper}\"></div>\\n                </div>`},dropdownContent(t){var e=this.settings,i=this.state.dropdown.suggestions;return`\\n            ${e.templates.dropdownHeader.call(this,i)}\\n            ${t}\\n            ${e.templates.dropdownFooter.call(this,i)}\\n        `},dropdownItem(t){return`<div ${this.getAttributes(t)}\\n                    class='${this.settings.classNames.dropdownItem} ${t.class?t.class:\"\"}'\\n                    tabindex=\"0\"\\n                    role=\"option\">${t.mappedValue||t.value}</div>`},dropdownHeader(t){return`<header data-selector='tagify-suggestions-header' class=\"${this.settings.classNames.dropdownHeader}\"></header>`},dropdownFooter(t){var e=t.length-this.settings.dropdown.maxItems;return e>0?`<footer data-selector='tagify-suggestions-footer' class=\"${this.settings.classNames.dropdownFooter}\">\\n                ${e} more items. Refine your search.\\n            </footer>`:\"\"},dropdownItemNoMatch:null};var I={customBinding(){this.customEventsList.forEach((t=>{this.on(t,this.settings.callbacks[t])}))},binding(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];var e,i=this.events.callbacks,s=t?\"addEventListener\":\"removeEventListener\";if(!this.state.mainEvents||!t){for(var a in this.state.mainEvents=t,t&&!this.listeners.main&&(this.events.bindGlobal.call(this),this.settings.isJQueryPlugin&&jQuery(this.DOM.originalInput).on(\"tagify.removeAllTags\",this.removeAllTags.bind(this))),e=this.listeners.main=this.listeners.main||{focus:[\"input\",i.onFocusBlur.bind(this)],keydown:[\"input\",i.onKeydown.bind(this)],click:[\"scope\",i.onClickScope.bind(this)],dblclick:[\"scope\",i.onDoubleClickScope.bind(this)],paste:[\"input\",i.onPaste.bind(this)],drop:[\"input\",i.onDrop.bind(this)],compositionstart:[\"input\",i.onCompositionStart.bind(this)],compositionend:[\"input\",i.onCompositionEnd.bind(this)]})this.DOM[e[a][0]][s](a,e[a][1]);clearInterval(this.listeners.main.originalInputValueObserverInterval),this.listeners.main.originalInputValueObserverInterval=setInterval(i.observeOriginalInputValue.bind(this),500);var n=this.listeners.main.inputMutationObserver||new MutationObserver(i.onInputDOMChange.bind(this));n.disconnect(),\"mix\"==this.settings.mode&&n.observe(this.DOM.input,{childList:!0})}},bindGlobal(t){var e,i=this.events.callbacks,s=t?\"removeEventListener\":\"addEventListener\";if(this.listeners&&(t||!this.listeners.global))for(e of(this.listeners.global=this.listeners.global||[{type:this.isIE?\"keydown\":\"input\",target:this.DOM.input,cb:i[this.isIE?\"onInputIE\":\"onInput\"].bind(this)},{type:\"keydown\",target:window,cb:i.onWindowKeyDown.bind(this)},{type:\"blur\",target:this.DOM.input,cb:i.onFocusBlur.bind(this)},{type:\"click\",target:document,cb:i.onClickAnywhere.bind(this)}],this.listeners.global))e.target[s](e.type,e.cb)},unbindGlobal(){this.events.bindGlobal.call(this,!0)},callbacks:{onFocusBlur(t){var e=this.settings,i=t.target?this.trim(t.target.textContent):\"\",s=this.value?.[0]?.[e.tagTextProp],a=t.type,n=e.dropdown.enabled>=0,o={relatedTarget:t.relatedTarget},r=this.state.actions.selectOption&&(n||!e.dropdown.closeOnSelect),l=this.state.actions.addNew&&n,d=t.relatedTarget&&v.call(this,t.relatedTarget)&&this.DOM.scope.contains(t.relatedTarget);if(\"blur\"==a){if(t.relatedTarget===this.DOM.scope)return this.dropdown.hide(),void this.DOM.input.focus();this.postUpdate(),e.onChangeAfterBlur&&this.triggerChangeEvent()}if(!r&&!l)if(this.state.hasFocus=\"focus\"==a&&+new Date,this.toggleFocusClass(this.state.hasFocus),\"mix\"!=e.mode){if(\"focus\"==a)return this.trigger(\"focus\",o),void(0!==e.dropdown.enabled&&e.userInput||this.dropdown.show(this.value.length?\"\":void 0));\"blur\"==a&&(this.trigger(\"blur\",o),this.loading(!1),\"select\"==e.mode&&(d&&(this.removeTags(),i=\"\"),s===i&&(i=\"\")),i&&!this.state.actions.selectOption&&e.addTagOnBlur&&this.addTags(i,!0)),this.DOM.input.removeAttribute(\"style\"),this.dropdown.hide()}else\"focus\"==a?this.trigger(\"focus\",o):\"blur\"==t.type&&(this.trigger(\"blur\",o),this.loading(!1),this.dropdown.hide(),this.state.dropdown.visible=void 0,this.setStateSelection())},onCompositionStart(t){this.state.composing=!0},onCompositionEnd(t){this.state.composing=!1},onWindowKeyDown(t){var e,i=document.activeElement,s=v.call(this,i)&&this.DOM.scope.contains(document.activeElement),a=s&&i.hasAttribute(\"readonly\");if(s&&!a)switch(e=i.nextElementSibling,t.key){case\"Backspace\":this.settings.readonly||(this.removeTags(i),(e||this.DOM.input).focus());break;case\"Enter\":setTimeout(this.editTag.bind(this),0,i)}},onKeydown(t){var e=this.settings;if(!this.state.composing&&e.userInput){\"select\"==e.mode&&e.enforceWhitelist&&this.value.length&&\"Tab\"!=t.key&&t.preventDefault();var i=this.trim(t.target.textContent);if(this.trigger(\"keydown\",{event:t}),\"mix\"==e.mode){switch(t.key){case\"Left\":case\"ArrowLeft\":this.state.actions.ArrowLeft=!0;break;case\"Delete\":case\"Backspace\":if(this.state.editing)return;var s=document.getSelection(),a=\"Delete\"==t.key&&s.anchorOffset==(s.anchorNode.length||0),n=s.anchorNode.previousSibling,r=1==s.anchorNode.nodeType||!s.anchorOffset&&n&&1==n.nodeType&&s.anchorNode.previousSibling;o(this.DOM.input.innerHTML);var d,h,g,p=this.getTagElms();if(\"edit\"==e.backspace&&r)return d=1==s.anchorNode.nodeType?null:s.anchorNode.previousElementSibling,setTimeout(this.editTag.bind(this),0,d),void t.preventDefault();if(u()&&r instanceof Element)return g=l(r),r.hasAttribute(\"readonly\")||r.remove(),this.DOM.input.focus(),void setTimeout((()=>{this.placeCaretAfterNode(g),this.DOM.input.click()}));if(\"BR\"==s.anchorNode.nodeName)return;if((a||r)&&1==s.anchorNode.nodeType?h=0==s.anchorOffset?a?p[0]:null:p[Math.min(p.length,s.anchorOffset)-1]:a?h=s.anchorNode.nextElementSibling:r instanceof Element&&(h=r),3==s.anchorNode.nodeType&&!s.anchorNode.nodeValue&&s.anchorNode.previousElementSibling&&t.preventDefault(),(r||a)&&!e.backspace)return void t.preventDefault();if(\"Range\"!=s.type&&!s.anchorOffset&&s.anchorNode==this.DOM.input&&\"Delete\"!=t.key)return void t.preventDefault();if(\"Range\"!=s.type&&h&&h.hasAttribute(\"readonly\"))return void this.placeCaretAfterNode(l(h));clearTimeout(O),O=setTimeout((()=>{var t=document.getSelection();o(this.DOM.input.innerHTML),!a&&t.anchorNode.previousSibling,this.value=[].map.call(p,((t,e)=>{var i=T(t);if(t.parentNode||i.readonly)return i;this.trigger(\"remove\",{tag:t,index:e,data:i})})).filter((t=>t))}),20)}return!0}switch(t.key){case\"Backspace\":\"select\"==e.mode&&e.enforceWhitelist&&this.value.length?this.removeTags():this.state.dropdown.visible&&\"manual\"!=e.dropdown.position||\"\"!=t.target.textContent&&8203!=i.charCodeAt(0)||(!0===e.backspace?this.removeTags():\"edit\"==e.backspace&&setTimeout(this.editTag.bind(this),0));break;case\"Esc\":case\"Escape\":if(this.state.dropdown.visible)return;t.target.blur();break;case\"Down\":case\"ArrowDown\":this.state.dropdown.visible||this.dropdown.show();break;case\"ArrowRight\":{let t=this.state.inputSuggestion||this.state.ddItemData;if(t&&e.autoComplete.rightKey)return void this.addTags([t],!0);break}case\"Tab\":{let s=\"select\"==e.mode;if(!i||s)return!0;t.preventDefault()}case\"Enter\":if(this.state.dropdown.visible&&\"manual\"!=e.dropdown.position)return;t.preventDefault(),setTimeout((()=>{this.state.dropdown.visible||this.state.actions.selectOption||this.addTags(i,!0)}))}}},onInput(t){this.postUpdate();var e=this.settings;if(\"mix\"==e.mode)return this.events.callbacks.onMixTagsInput.call(this,t);var i=this.input.normalize.call(this),s=i.length>=e.dropdown.enabled,a={value:i,inputElm:this.DOM.input},n=this.validateTag({value:i});\"select\"==e.mode&&this.toggleScopeValidation(n),a.isValid=n,this.state.inputText!=i&&(this.input.set.call(this,i,!1),-1!=i.search(e.delimiters)?this.addTags(i)&&this.input.set.call(this):e.dropdown.enabled>=0&&this.dropdown[s?\"show\":\"hide\"](i),this.trigger(\"input\",a))},onMixTagsInput(t){var e,i,s,a,n,o,r,l,d=this.settings,h=this.value.length,p=this.getTagElms(),c=document.createDocumentFragment(),m=window.getSelection().getRangeAt(0),v=[].map.call(p,(t=>T(t).value));if(\"deleteContentBackward\"==t.inputType&&u()&&this.events.callbacks.onKeydown.call(this,{target:t.target,key:\"Backspace\"}),this.value.slice().forEach((t=>{t.readonly&&!v.includes(t.value)&&c.appendChild(this.createTagElem(t))})),c.childNodes.length&&(m.insertNode(c),this.setRangeAtStartEnd(!1,c.lastChild)),p.length!=h)return this.value=[].map.call(this.getTagElms(),(t=>T(t))),void this.update({withoutChangeEvent:!0});if(this.hasMaxTags())return!0;if(window.getSelection&&(o=window.getSelection()).rangeCount>0&&3==o.anchorNode.nodeType){if((m=o.getRangeAt(0).cloneRange()).collapse(!0),m.setStart(o.focusNode,0),s=(e=m.toString().slice(0,m.endOffset)).split(d.pattern).length-1,(i=e.match(d.pattern))&&(a=e.slice(e.lastIndexOf(i[i.length-1]))),a){if(this.state.actions.ArrowLeft=!1,this.state.tag={prefix:a.match(d.pattern)[0],value:a.replace(d.pattern,\"\")},this.state.tag.baseOffset=o.baseOffset-this.state.tag.value.length,l=this.state.tag.value.match(d.delimiters))return this.state.tag.value=this.state.tag.value.replace(d.delimiters,\"\"),this.state.tag.delimiters=l[0],this.addTags(this.state.tag.value,d.dropdown.clearOnSelect),void this.dropdown.hide();n=this.state.tag.value.length>=d.dropdown.enabled;try{r=(r=this.state.flaggedTags[this.state.tag.baseOffset]).prefix==this.state.tag.prefix&&r.value[0]==this.state.tag.value[0],this.state.flaggedTags[this.state.tag.baseOffset]&&!this.state.tag.value&&delete this.state.flaggedTags[this.state.tag.baseOffset]}catch(t){}(r||s<this.state.mixMode.matchedPatternCount)&&(n=!1)}else this.state.flaggedTags={};this.state.mixMode.matchedPatternCount=s}setTimeout((()=>{this.update({withoutChangeEvent:!0}),this.trigger(\"input\",g({},this.state.tag,{textContent:this.DOM.input.textContent})),this.state.tag&&this.dropdown[n?\"show\":\"hide\"](this.state.tag.value)}),10)},onInputIE(t){var e=this;setTimeout((function(){e.events.callbacks.onInput.call(e,t)}))},observeOriginalInputValue(){this.DOM.originalInput.parentNode||this.destroy(),this.DOM.originalInput.value!=this.DOM.originalInput.tagifyValue&&this.loadOriginalValues()},onClickAnywhere(t){t.target==this.DOM.scope||this.DOM.scope.contains(t.target)||(this.toggleFocusClass(!1),this.state.hasFocus=!1)},onClickScope(t){var e=this.settings,i=t.target.closest(\".\"+e.classNames.tag),s=+new Date-this.state.hasFocus;if(t.target!=this.DOM.scope){if(!t.target.classList.contains(e.classNames.tagX))return i?(this.trigger(\"click\",{tag:i,index:this.getNodeIndex(i),data:T(i),event:t}),void(1!==e.editTags&&1!==e.editTags.clicks||this.events.callbacks.onDoubleClickScope.call(this,t))):void(t.target==this.DOM.input&&(\"mix\"==e.mode&&this.fixFirefoxLastTagNoCaret(),s>500)?this.state.dropdown.visible?this.dropdown.hide():0===e.dropdown.enabled&&\"mix\"!=e.mode&&this.dropdown.show(this.value.length?\"\":void 0):\"select\"!=e.mode||0!==e.dropdown.enabled||this.state.dropdown.visible||this.dropdown.show());this.removeTags(t.target.parentNode)}else this.DOM.input.focus()},onPaste(t){t.preventDefault();var e,i,s=this.settings;if(\"select\"==s.mode&&s.enforceWhitelist||!s.userInput)return!1;s.readonly||(e=t.clipboardData||window.clipboardData,i=e.getData(\"Text\"),s.hooks.beforePaste(t,{tagify:this,pastedText:i,clipboardData:e}).then((e=>{void 0===e&&(e=i),e&&(this.injectAtCaret(e,window.getSelection().getRangeAt(0)),\"mix\"==this.settings.mode?this.events.callbacks.onMixTagsInput.call(this,t):this.settings.pasteAsTags?this.addTags(this.state.inputText+e,!0):this.state.inputText=e)})).catch((t=>t)))},onDrop(t){t.preventDefault()},onEditTagInput(t,e){var i=t.closest(\".\"+this.settings.classNames.tag),s=this.getNodeIndex(i),a=T(i),n=this.input.normalize.call(this,t),o={[this.settings.tagTextProp]:n,__tagId:a.__tagId},r=this.validateTag(o);this.editTagChangeDetected(g(a,o))||!0!==t.originalIsValid||(r=!0),i.classList.toggle(this.settings.classNames.tagInvalid,!0!==r),a.__isValid=r,i.title=!0===r?a.title||a.value:r,n.length>=this.settings.dropdown.enabled&&(this.state.editing&&(this.state.editing.value=n),this.dropdown.show(n)),this.trigger(\"edit:input\",{tag:i,index:s,data:g({},this.value[s],{newValue:n}),event:e})},onEditTagPaste(t,e){var i=(e.clipboardData||window.clipboardData).getData(\"Text\");e.preventDefault();var s=f(i);this.setRangeAtStartEnd(!1,s)},onEditTagFocus(t){this.state.editing={scope:t,input:t.querySelector(\"[contenteditable]\")}},onEditTagBlur(t){if(this.state.hasFocus||this.toggleFocusClass(),this.DOM.scope.contains(t)){var e,i,s=this.settings,a=t.closest(\".\"+s.classNames.tag),n=T(a),o=this.input.normalize.call(this,t),r={[s.tagTextProp]:o,__tagId:n.__tagId},l=n.__originalData,d=this.editTagChangeDetected(g(n,r)),h=this.validateTag(r);if(o)if(d){if(e=this.hasMaxTags(),i=g({},l,{[s.tagTextProp]:this.trim(o),__isValid:h}),s.transformTag.call(this,i,l),!0!==(h=(!e||!0===l.__isValid)&&this.validateTag(i))){if(this.trigger(\"invalid\",{data:i,tag:a,message:h}),s.editTags.keepInvalid)return;s.keepInvalidTags?i.__isValid=h:i=l}else s.keepInvalidTags&&(delete i.title,delete i[\"aria-invalid\"],delete i.class);this.onEditTagDone(a,i)}else this.onEditTagDone(a,l);else this.onEditTagDone(a)}},onEditTagkeydown(t,e){if(!this.state.composing)switch(this.trigger(\"edit:keydown\",{event:t}),t.key){case\"Esc\":case\"Escape\":e.parentNode.replaceChild(e.__tagifyTagData.__originalHTML,e),this.state.editing=!1;case\"Enter\":case\"Tab\":t.preventDefault(),t.target.blur()}},onDoubleClickScope(t){var e,i,s=t.target.closest(\".\"+this.settings.classNames.tag),a=T(s),n=this.settings;s&&n.userInput&&!1!==a.editable&&(e=s.classList.contains(this.settings.classNames.tagEditing),i=s.hasAttribute(\"readonly\"),\"select\"==n.mode||n.readonly||e||i||!this.settings.editTags||this.editTag(s),this.toggleFocusClass(!0),this.trigger(\"dblclick\",{tag:s,index:this.getNodeIndex(s),data:T(s)}))},onInputDOMChange(t){t.forEach((t=>{t.addedNodes.forEach((t=>{if(\"<div><br></div>\"==t.outerHTML)t.replaceWith(document.createElement(\"br\"));else if(1==t.nodeType&&t.querySelector(this.settings.classNames.tagSelector)){let e=document.createTextNode(\"\");3==t.childNodes[0].nodeType&&\"BR\"!=t.previousSibling.nodeName&&(e=document.createTextNode(\"\\n\")),t.replaceWith(e,...[...t.childNodes].slice(0,-1)),this.placeCaretAfterNode(e)}else if(v.call(this,t)&&(3!=t.previousSibling?.nodeType||t.previousSibling.textContent||t.previousSibling.remove(),t.previousSibling&&\"BR\"==t.previousSibling.nodeName)){t.previousSibling.replaceWith(\"\\nâ\");let e=t.nextSibling,i=\"\";for(;e;)i+=e.textContent,e=e.nextSibling;i.trim()&&this.placeCaretAfterNode(t.previousSibling)}})),t.removedNodes.forEach((t=>{t&&\"BR\"==t.nodeName&&v.call(this,e)&&(this.removeTags(e),this.fixFirefoxLastTagNoCaret())}))}));var e=this.DOM.input.lastChild;e&&\"\"==e.nodeValue&&e.remove(),e&&\"BR\"==e.nodeName||this.DOM.input.appendChild(document.createElement(\"br\"))}}};function N(t,e){if(!t){console.warn(\"Tagify:\",\"input element not found\",t);const e=new Proxy(this,{get:()=>()=>e});return e}if(t.__tagify)return console.warn(\"Tagify: \",\"input element is already Tagified - Same instance is returned.\",t),t.__tagify;var i;g(this,function(t){var e=document.createTextNode(\"\");function i(t,i,s){s&&i.split(/\\s+/g).forEach((i=>e[t+\"EventListener\"].call(e,i,s)))}return{off(t,e){return i(\"remove\",t,e),this},on(t,e){return e&&\"function\"==typeof e&&i(\"add\",t,e),this},trigger(i,s,a){var n;if(a=a||{cloneData:!0},i)if(t.settings.isJQueryPlugin)\"remove\"==i&&(i=\"removeTag\"),jQuery(t.DOM.originalInput).triggerHandler(i,[s]);else{try{var o=\"object\"==typeof s?s:{value:s};if((o=a.cloneData?g({},o):o).tagify=this,s.event&&(o.event=this.cloneEvent(s.event)),s instanceof Object)for(var r in s)s[r]instanceof HTMLElement&&(o[r]=s[r]);n=new CustomEvent(i,{detail:o})}catch(t){console.warn(t)}e.dispatchEvent(n)}}}}(this)),this.isFirefox=/firefox|fxios/i.test(navigator.userAgent)&&!/seamonkey/i.test(navigator.userAgent),this.isIE=window.document.documentMode,e=e||{},this.getPersistedData=(i=e.id,t=>{let e,s=\"/\"+t;if(1==localStorage.getItem(x+i+\"/v\",1))try{e=JSON.parse(localStorage[x+i+s])}catch(t){}return e}),this.setPersistedData=(t=>t?(localStorage.setItem(x+t+\"/v\",1),(e,i)=>{let s=\"/\"+i,a=JSON.stringify(e);e&&i&&(localStorage.setItem(x+t+s,a),dispatchEvent(new Event(\"storage\")))}):()=>{})(e.id),this.clearPersistedData=(t=>e=>{const i=x+\"/\"+t+\"/\";if(e)localStorage.removeItem(i+e);else for(let t in localStorage)t.includes(i)&&localStorage.removeItem(t)})(e.id),this.applySettings(t,e),this.state={inputText:\"\",editing:!1,composing:!1,actions:{},mixMode:{},dropdown:{},flaggedTags:{}},this.value=[],this.listeners={},this.DOM={},this.build(t),b.call(this),this.getCSSVars(),this.loadOriginalValues(),this.events.customBinding.call(this),this.events.binding.call(this),t.autofocus&&this.DOM.input.focus(),t.__tagify=this}return N.prototype={_dropdown:y,getSetTagData:T,helpers:{sameStr:s,removeCollectionProp:a,omit:n,isObject:h,parseHTML:r,escapeHTML:d,extend:g,concatWithoutDups:p,getUID:m,isNodeTag:v},customEventsList:[\"change\",\"add\",\"remove\",\"invalid\",\"input\",\"click\",\"keydown\",\"focus\",\"blur\",\"edit:input\",\"edit:beforeUpdate\",\"edit:updated\",\"edit:start\",\"edit:keydown\",\"dropdown:show\",\"dropdown:hide\",\"dropdown:select\",\"dropdown:updated\",\"dropdown:noMatch\",\"dropdown:scroll\"],dataProps:[\"__isValid\",\"__removed\",\"__originalData\",\"__originalHTML\",\"__tagId\"],trim(t){return this.settings.trim&&t&&\"string\"==typeof t?t.trim():t},parseHTML:r,templates:M,parseTemplate(t,e){return r((t=this.settings.templates[t]||t).apply(this,e))},set whitelist(t){const e=t&&Array.isArray(t);this.settings.whitelist=e?t:[],this.setPersistedData(e?t:[],\"whitelist\")},get whitelist(){return this.settings.whitelist},generateClassSelectors(t){for(let e in t){let i=e;Object.defineProperty(t,i+\"Selector\",{get(){return\".\"+this[i].split(\" \")[0]}})}},applySettings(t,i){w.templates=this.templates;var s=g({},w,\"mix\"==i.mode?{dropdown:{position:\"text\"}}:{}),a=this.settings=g({},s,i);if(a.disabled=t.hasAttribute(\"disabled\"),a.readonly=a.readonly||t.hasAttribute(\"readonly\"),a.placeholder=d(t.getAttribute(\"placeholder\")||a.placeholder||\"\"),a.required=t.hasAttribute(\"required\"),this.generateClassSelectors(a.classNames),void 0===a.dropdown.includeSelectedTags&&(a.dropdown.includeSelectedTags=a.duplicates),this.isIE&&(a.autoComplete=!1),[\"whitelist\",\"blacklist\"].forEach((e=>{var i=t.getAttribute(\"data-\"+e);i&&(i=i.split(a.delimiters))instanceof Array&&(a[e]=i)})),\"autoComplete\"in i&&!h(i.autoComplete)&&(a.autoComplete=w.autoComplete,a.autoComplete.enabled=i.autoComplete),\"mix\"==a.mode&&(a.pattern=a.pattern||/@/,a.autoComplete.rightKey=!0,a.delimiters=i.delimiters||null,a.tagTextProp&&!a.dropdown.searchKeys.includes(a.tagTextProp)&&a.dropdown.searchKeys.push(a.tagTextProp)),t.pattern)try{a.pattern=new RegExp(t.pattern)}catch(t){}if(a.delimiters){a._delimiters=a.delimiters;try{a.delimiters=new RegExp(this.settings.delimiters,\"g\")}catch(t){}}a.disabled&&(a.userInput=!1),this.TEXTS=e(e({},D),a.texts||{}),(\"select\"!=a.mode||i.dropdown?.enabled)&&a.userInput||(a.dropdown.enabled=0),a.dropdown.appendTarget=i.dropdown?.appendTarget||document.body;let n=this.getPersistedData(\"whitelist\");Array.isArray(n)&&(this.whitelist=Array.isArray(a.whitelist)?p(a.whitelist,n):n)},getAttributes(t){var e,i=this.getCustomAttributes(t),s=\"\";for(e in i)s+=\" \"+e+(void 0!==t[e]?`=\"${i[e]}\"`:\"\");return s},getCustomAttributes(t){if(!h(t))return\"\";var e,i={};for(e in t)\"__\"!=e.slice(0,2)&&\"class\"!=e&&t.hasOwnProperty(e)&&void 0!==t[e]&&(i[e]=d(t[e]));return i},setStateSelection(){var t=window.getSelection(),e={anchorOffset:t.anchorOffset,anchorNode:t.anchorNode,range:t.getRangeAt&&t.rangeCount&&t.getRangeAt(0)};return this.state.selection=e,e},getCSSVars(){var t=getComputedStyle(this.DOM.scope,null);var e;this.CSSVars={tagHideTransition:(t=>{let e=t.value;return\"s\"==t.unit?1e3*e:e})(function(t){if(!t)return{};var e=(t=t.trim().split(\" \")[0]).split(/\\d+/g).filter((t=>t)).pop().trim();return{value:+t.split(e).filter((t=>t))[0].trim(),unit:e}}((e=\"tag-hide-transition\",t.getPropertyValue(\"--\"+e))))}},build(t){var e=this.DOM;this.settings.mixMode.integrated?(e.originalInput=null,e.scope=t,e.input=t):(e.originalInput=t,e.originalInput_tabIndex=t.tabIndex,e.scope=this.parseTemplate(\"wrapper\",[t,this.settings]),e.input=e.scope.querySelector(this.settings.classNames.inputSelector),t.parentNode.insertBefore(e.scope,t),t.tabIndex=-1)},destroy(){this.events.unbindGlobal.call(this),this.DOM.scope.parentNode.removeChild(this.DOM.scope),this.DOM.originalInput.tabIndex=this.DOM.originalInput_tabIndex,delete this.DOM.originalInput.__tagify,this.dropdown.hide(!0),clearTimeout(this.dropdownHide__bindEventsTimeout),clearInterval(this.listeners.main.originalInputValueObserverInterval)},loadOriginalValues(t){var e,i=this.settings;if(this.state.blockChangeEvent=!0,void 0===t){const e=this.getPersistedData(\"value\");t=e&&!this.DOM.originalInput.value?e:i.mixMode.integrated?this.DOM.input.textContent:this.DOM.originalInput.value}if(this.removeAllTags(),t)if(\"mix\"==i.mode)this.parseMixTags(t),(e=this.DOM.input.lastChild)&&\"BR\"==e.tagName||this.DOM.input.insertAdjacentHTML(\"beforeend\",\"<br>\");else{try{JSON.parse(t)instanceof Array&&(t=JSON.parse(t))}catch(t){}this.addTags(t,!0).forEach((t=>t&&t.classList.add(i.classNames.tagNoAnimation)))}else this.postUpdate();this.state.lastOriginalValueReported=i.mixMode.integrated?\"\":this.DOM.originalInput.value},cloneEvent(t){var e={};for(var i in t)\"path\"!=i&&(e[i]=t[i]);return e},loading(t){return this.state.isLoading=t,this.DOM.scope.classList[t?\"add\":\"remove\"](this.settings.classNames.scopeLoading),this},tagLoading(t,e){return t&&t.classList[e?\"add\":\"remove\"](this.settings.classNames.tagLoading),this},toggleClass(t,e){\"string\"==typeof t&&this.DOM.scope.classList.toggle(t,e)},toggleScopeValidation(t){var e=!0===t||void 0===t;!this.settings.required&&t&&t===this.TEXTS.empty&&(e=!0),this.toggleClass(this.settings.classNames.tagInvalid,!e),this.DOM.scope.title=e?\"\":t},toggleFocusClass(t){this.toggleClass(this.settings.classNames.focus,!!t)},triggerChangeEvent:function(){if(!this.settings.mixMode.integrated){var t=this.DOM.originalInput,e=this.state.lastOriginalValueReported!==t.value,i=new CustomEvent(\"change\",{bubbles:!0});e&&(this.state.lastOriginalValueReported=t.value,i.simulated=!0,t._valueTracker&&t._valueTracker.setValue(Math.random()),t.dispatchEvent(i),this.trigger(\"change\",this.state.lastOriginalValueReported),t.value=this.state.lastOriginalValueReported)}},events:I,fixFirefoxLastTagNoCaret(){},setRangeAtStartEnd(t,e){if(e){t=\"number\"==typeof t?t:!!t,e=e.lastChild||e;var i=document.getSelection();if(i.focusNode instanceof Element&&!this.DOM.input.contains(i.focusNode))return!0;try{i.rangeCount>=1&&[\"Start\",\"End\"].forEach((s=>i.getRangeAt(0)[\"set\"+s](e,t||e.length)))}catch(t){}}},placeCaretAfterNode(t){if(t&&t.parentNode){var e=t,i=window.getSelection(),s=i.getRangeAt(0);i.rangeCount&&(s.setStartAfter(e),s.collapse(!0),i.removeAllRanges(),i.addRange(s))}},insertAfterTag(t,e){if(e=e||this.settings.mixMode.insertAfterTag,t&&t.parentNode&&e)return e=\"string\"==typeof e?document.createTextNode(e):e,t.parentNode.insertBefore(e,t.nextSibling),e},editTagChangeDetected(t){var e=t.__originalData;for(var i in e)if(!this.dataProps.includes(i)&&t[i]!=e[i])return!0;return!1},getTagTextNode(t){return t.querySelector(this.settings.classNames.tagTextSelector)},setTagTextNode(t,e){this.getTagTextNode(t).innerHTML=d(e)},editTag(t,e){t=t||this.getLastTag(),e=e||{},this.dropdown.hide();var i=this.settings,s=this.getTagTextNode(t),a=this.getNodeIndex(t),n=T(t),o=this.events.callbacks,r=this,l=!0;if(s){if(!(n instanceof Object&&\"editable\"in n)||n.editable)return n=T(t,{__originalData:g({},n),__originalHTML:t.cloneNode(!0)}),T(n.__originalHTML,n.__originalData),s.setAttribute(\"contenteditable\",!0),t.classList.add(i.classNames.tagEditing),s.addEventListener(\"focus\",o.onEditTagFocus.bind(this,t)),s.addEventListener(\"blur\",(function(){setTimeout((()=>o.onEditTagBlur.call(r,r.getTagTextNode(t))))})),s.addEventListener(\"input\",o.onEditTagInput.bind(this,s)),s.addEventListener(\"paste\",o.onEditTagPaste.bind(this,s)),s.addEventListener(\"keydown\",(e=>o.onEditTagkeydown.call(this,e,t))),s.addEventListener(\"compositionstart\",o.onCompositionStart.bind(this)),s.addEventListener(\"compositionend\",o.onCompositionEnd.bind(this)),e.skipValidation||(l=this.editTagToggleValidity(t)),s.originalIsValid=l,this.trigger(\"edit:start\",{tag:t,index:a,data:n,isValid:l}),s.focus(),this.setRangeAtStartEnd(!1,s),this}else console.warn(\"Cannot find element in Tag template: .\",i.classNames.tagTextSelector)},editTagToggleValidity(t,e){var i;if(e=e||T(t))return(i=!(\"__isValid\"in e)||!0===e.__isValid)||this.removeTagsFromValue(t),this.update(),t.classList.toggle(this.settings.classNames.tagNotAllowed,!i),e.__isValid;console.warn(\"tag has no data: \",t,e)},onEditTagDone(t,e){e=e||{};var i={tag:t=t||this.state.editing.scope,index:this.getNodeIndex(t),previousData:T(t),data:e};this.trigger(\"edit:beforeUpdate\",i,{cloneData:!1}),this.state.editing=!1,delete e.__originalData,delete e.__originalHTML,t&&e[this.settings.tagTextProp]?(t=this.replaceTag(t,e),this.editTagToggleValidity(t,e),this.settings.a11y.focusableTags?t.focus():this.placeCaretAfterNode(t)):t&&this.removeTags(t),this.trigger(\"edit:updated\",i),this.dropdown.hide(),this.settings.keepInvalidTags&&this.reCheckInvalidTags()},replaceTag(t,e){e&&e.value||(e=t.__tagifyTagData),e.__isValid&&1!=e.__isValid&&g(e,this.getInvalidTagAttrs(e,e.__isValid));var i=this.createTagElem(e);return t.parentNode.replaceChild(i,t),this.updateValueByDOMTags(),i},updateValueByDOMTags(){this.value.length=0,[].forEach.call(this.getTagElms(),(t=>{t.classList.contains(this.settings.classNames.tagNotAllowed.split(\" \")[0])||this.value.push(T(t))})),this.update()},injectAtCaret(t,e){return!(e=e||this.state.selection?.range)&&t?(this.appendMixTags(t),this):(f(t,e),this.setRangeAtStartEnd(!1,t),this.updateValueByDOMTags(),this.update(),this)},input:{set(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:\"\",e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var i=this.settings.dropdown.closeOnSelect;this.state.inputText=t,e&&(this.DOM.input.innerHTML=d(\"\"+t)),!t&&i&&this.dropdown.hide.bind(this),this.input.autocomplete.suggest.call(this),this.input.validate.call(this)},raw(){return this.DOM.input.textContent},validate(){var t=!this.state.inputText||!0===this.validateTag({value:this.state.inputText});return this.DOM.input.classList.toggle(this.settings.classNames.inputInvalid,!t),t},normalize(t){var e=t||this.DOM.input,i=[];e.childNodes.forEach((t=>3==t.nodeType&&i.push(t.nodeValue))),i=i.join(\"\\n\");try{i=i.replace(/(?:\\r\\n|\\r|\\n)/g,this.settings.delimiters.source.charAt(0))}catch(t){}return i=i.replace(/\\s/g,\" \"),this.trim(i)},autocomplete:{suggest(t){if(this.settings.autoComplete.enabled){\"string\"==typeof(t=t||{value:\"\"})&&(t={value:t});var e=this.dropdown.getMappedValue(t);if(\"number\"!=typeof e){var i=e.substr(0,this.state.inputText.length).toLowerCase(),s=e.substring(this.state.inputText.length);e&&this.state.inputText&&i==this.state.inputText.toLowerCase()?(this.DOM.input.setAttribute(\"data-suggest\",s),this.state.inputSuggestion=t):(this.DOM.input.removeAttribute(\"data-suggest\"),delete this.state.inputSuggestion)}}},set(t){var e=this.DOM.input.getAttribute(\"data-suggest\"),i=t||(e?this.state.inputText+e:null);return!!i&&(\"mix\"==this.settings.mode?this.replaceTextWithNode(document.createTextNode(this.state.tag.prefix+i)):(this.input.set.call(this,i),this.setRangeAtStartEnd(!1,this.DOM.input)),this.input.autocomplete.suggest.call(this),this.dropdown.hide(),!0)}}},getTagIdx(t){return this.value.findIndex((e=>e.__tagId==(t||{}).__tagId))},getNodeIndex(t){var e=0;if(t)for(;t=t.previousElementSibling;)e++;return e},getTagElms(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var s=\".\"+[...this.settings.classNames.tag.split(\" \"),...e].join(\".\");return[].slice.call(this.DOM.scope.querySelectorAll(s))},getLastTag(){var t=this.DOM.scope.querySelectorAll(`${this.settings.classNames.tagSelector}:not(.${this.settings.classNames.tagHide}):not([readonly])`);return t[t.length-1]},isTagDuplicate(t,e,i){var a=0;if(\"select\"==this.settings.mode)return!1;for(let n of this.value){s(this.trim(\"\"+t),n.value,e)&&i!=n.__tagId&&a++}return a},getTagIndexByValue(t){var e=[];return this.getTagElms().forEach(((i,a)=>{s(this.trim(i.textContent),t,this.settings.dropdown.caseSensitive)&&e.push(a)})),e},getTagElmByValue(t){var e=this.getTagIndexByValue(t)[0];return this.getTagElms()[e]},flashTag(t){t&&(t.classList.add(this.settings.classNames.tagFlash),setTimeout((()=>{t.classList.remove(this.settings.classNames.tagFlash)}),100))},isTagBlacklisted(t){return t=this.trim(t.toLowerCase()),this.settings.blacklist.filter((e=>(\"\"+e).toLowerCase()==t)).length},isTagWhitelisted(t){return!!this.getWhitelistItem(t)},getWhitelistItem(t,e,i){e=e||\"value\";var a,n=this.settings;return(i=i||n.whitelist).some((i=>{var o=\"string\"==typeof i?i:i[e]||i.value;if(s(o,t,n.dropdown.caseSensitive,n.trim))return a=\"string\"==typeof i?{value:i}:i,!0})),a||\"value\"!=e||\"value\"==n.tagTextProp||(a=this.getWhitelistItem(t,n.tagTextProp,i)),a},validateTag(t){var e=this.settings,i=\"value\"in t?\"value\":e.tagTextProp,s=this.trim(t[i]+\"\");return(t[i]+\"\").trim()?e.pattern&&e.pattern instanceof RegExp&&!e.pattern.test(s)?this.TEXTS.pattern:!e.duplicates&&this.isTagDuplicate(s,e.dropdown.caseSensitive,t.__tagId)?this.TEXTS.duplicate:this.isTagBlacklisted(s)||e.enforceWhitelist&&!this.isTagWhitelisted(s)?this.TEXTS.notAllowed:!e.validate||e.validate(t):this.TEXTS.empty},getInvalidTagAttrs(t,e){return{\"aria-invalid\":!0,class:`${t.class||\"\"} ${this.settings.classNames.tagNotAllowed}`.trim(),title:e}},hasMaxTags(){return this.value.length>=this.settings.maxTags&&this.TEXTS.exceed},setReadonly(t,e){var i=this.settings;document.activeElement.blur(),i[e||\"readonly\"]=t,this.DOM.scope[(t?\"set\":\"remove\")+\"Attribute\"](e||\"readonly\",!0),this.setContentEditable(!t)},setContentEditable(t){this.settings.userInput&&(this.DOM.input.contentEditable=t,this.DOM.input.tabIndex=t?0:-1)},setDisabled(t){this.setReadonly(t,\"disabled\")},normalizeTags(t){var e=this.settings,i=e.whitelist,s=e.delimiters,a=e.mode,n=e.tagTextProp,o=[],r=!!i&&i[0]instanceof Object,l=Array.isArray(t),d=l&&t[0].value,h=t=>(t+\"\").split(s).filter((t=>t)).map((t=>({[n]:this.trim(t),value:this.trim(t)})));if(\"number\"==typeof t&&(t=t.toString()),\"string\"==typeof t){if(!t.trim())return[];t=h(t)}else l&&(t=[].concat(...t.map((t=>null!=t.value?t:h(t)))));return r&&!d&&(t.forEach((t=>{var e=o.map((t=>t.value)),i=this.dropdown.filterListItems.call(this,t[n],{exact:!0});this.settings.duplicates||(i=i.filter((t=>!e.includes(t.value))));var s=i.length>1?this.getWhitelistItem(t[n],n,i):i[0];s&&s instanceof Object?o.push(s):\"mix\"!=a&&(null==t.value&&(t.value=t[n]),o.push(t))})),o.length&&(t=o)),t},parseMixTags(t){var e=this.settings,i=e.mixTagsInterpolator,s=e.duplicates,a=e.transformTag,n=e.enforceWhitelist,o=e.maxTags,r=e.tagTextProp,l=[];return t=t.split(i[0]).map(((t,e)=>{var d,h,g,p=t.split(i[1]),c=p[0],u=l.length==o;try{if(c==+c)throw Error;h=JSON.parse(c)}catch(t){h=this.normalizeTags(c)[0]||{value:c}}if(a.call(this,h),u||!(p.length>1)||n&&!this.isTagWhitelisted(h.value)||!s&&this.isTagDuplicate(h.value)){if(t)return e?i[0]+t:t}else h[d=h[r]?r:\"value\"]=this.trim(h[d]),g=this.createTagElem(h),l.push(h),g.classList.add(this.settings.classNames.tagNoAnimation),p[0]=g.outerHTML,this.value.push(h);return p.join(\"\")})).join(\"\"),this.DOM.input.innerHTML=t,this.DOM.input.appendChild(document.createTextNode(\"\")),this.DOM.input.normalize(),this.getTagElms().forEach(((t,e)=>T(t,l[e]))),this.update({withoutChangeEvent:!0}),t},replaceTextWithNode(t,e){if(this.state.tag||e){e=e||this.state.tag.prefix+this.state.tag.value;var i,s,a=this.state.selection||window.getSelection(),n=a.anchorNode,o=this.state.tag.delimiters?this.state.tag.delimiters.length:0;return n.splitText(a.anchorOffset-o),-1==(i=n.nodeValue.lastIndexOf(e))?!0:(s=n.splitText(i),t&&n.parentNode.replaceChild(t,s),!0)}},selectTag(t,e){var i=this.settings;if(!i.enforceWhitelist||this.isTagWhitelisted(e.value)){this.input.set.call(this,e[i.tagTextProp]||e.value,!0),this.state.actions.selectOption&&setTimeout((()=>this.setRangeAtStartEnd(!1,this.DOM.input)));var s=this.getLastTag();return s?this.replaceTag(s,e):this.appendTag(t),this.value[0]=e,this.update(),this.trigger(\"add\",{tag:t,data:e}),[t]}},addEmptyTag(t){var e=g({value:\"\"},t||{}),i=this.createTagElem(e);T(i,e),this.appendTag(i),this.editTag(i,{skipValidation:!0})},addTags(t,e,i){var s=[],a=this.settings,n=[],o=document.createDocumentFragment();if(i=i||a.skipInvalid,!t||0==t.length)return s;switch(t=this.normalizeTags(t),a.mode){case\"mix\":return this.addMixTags(t);case\"select\":e=!1,this.removeAllTags()}return this.DOM.input.removeAttribute(\"style\"),t.forEach((t=>{var e,r={},l=Object.assign({},t,{value:t.value+\"\"});if(t=Object.assign({},l),a.transformTag.call(this,t),t.__isValid=this.hasMaxTags()||this.validateTag(t),!0!==t.__isValid){if(i)return;if(g(r,this.getInvalidTagAttrs(t,t.__isValid),{__preInvalidData:l}),t.__isValid==this.TEXTS.duplicate&&this.flashTag(this.getTagElmByValue(t.value)),!a.createInvalidTags)return void n.push(t.value)}if(\"readonly\"in t&&(t.readonly?r[\"aria-readonly\"]=!0:delete t.readonly),e=this.createTagElem(t,r),s.push(e),\"select\"==a.mode)return this.selectTag(e,t);o.appendChild(e),t.__isValid&&!0===t.__isValid?(this.value.push(t),this.trigger(\"add\",{tag:e,index:this.value.length-1,data:t})):(this.trigger(\"invalid\",{data:t,index:this.value.length,tag:e,message:t.__isValid}),a.keepInvalidTags||setTimeout((()=>this.removeTags(e,!0)),1e3)),this.dropdown.position()})),this.appendTag(o),this.update(),t.length&&e&&(this.input.set.call(this,a.createInvalidTags?\"\":n.join(a._delimiters)),this.setRangeAtStartEnd(!1,this.DOM.input)),a.dropdown.enabled&&this.dropdown.refilter(),s},addMixTags(t){if((t=this.normalizeTags(t))[0].prefix||this.state.tag)return this.prefixedTextToTag(t[0]);var e=document.createDocumentFragment();return t.forEach((t=>{var i=this.createTagElem(t);e.appendChild(i)})),this.appendMixTags(e),e},appendMixTags(t){var e=!!this.state.selection;e?this.injectAtCaret(t):(this.DOM.input.focus(),(e=this.setStateSelection()).range.setStart(this.DOM.input,e.range.endOffset),e.range.setEnd(this.DOM.input,e.range.endOffset),this.DOM.input.appendChild(t),this.updateValueByDOMTags(),this.update())},prefixedTextToTag(t){var e,i=this.settings,s=this.state.tag.delimiters;if(i.transformTag.call(this,t),t.prefix=t.prefix||this.state.tag?this.state.tag.prefix:(i.pattern.source||i.pattern)[0],e=this.createTagElem(t),this.replaceTextWithNode(e)||this.DOM.input.appendChild(e),setTimeout((()=>e.classList.add(this.settings.classNames.tagNoAnimation)),300),this.value.push(t),this.update(),!s){var a=this.insertAfterTag(e)||e;setTimeout(this.placeCaretAfterNode,0,a)}return this.state.tag=null,this.trigger(\"add\",g({},{tag:e},{data:t})),e},appendTag(t){var e=this.DOM,i=e.input;e.scope.insertBefore(t,i)},createTagElem(t,i){t.__tagId=m();var s,a=g({},t,e({value:d(t.value+\"\")},i));return function(t){for(var e,i=document.createNodeIterator(t,NodeFilter.SHOW_TEXT,null,!1);e=i.nextNode();)e.textContent.trim()||e.parentNode.removeChild(e)}(s=this.parseTemplate(\"tag\",[a,this])),T(s,t),s},reCheckInvalidTags(){var t=this.settings;this.getTagElms(t.classNames.tagNotAllowed).forEach(((e,i)=>{var s=T(e),a=this.hasMaxTags(),n=this.validateTag(s),o=!0===n&&!a;if(\"select\"==t.mode&&this.toggleScopeValidation(n),o)return s=s.__preInvalidData?s.__preInvalidData:{value:s.value},this.replaceTag(e,s);e.title=a||n}))},removeTags(t,e,i){var s,a=this.settings;if(t=t&&t instanceof HTMLElement?[t]:t instanceof Array?t:t?[t]:[this.getLastTag()],s=t.reduce(((t,e)=>{e&&\"string\"==typeof e&&(e=this.getTagElmByValue(e));var i=T(e);return e&&i&&!i.readonly&&t.push({node:e,idx:this.getTagIdx(i),data:T(e,{__removed:!0})}),t}),[]),i=\"number\"==typeof i?i:this.CSSVars.tagHideTransition,\"select\"==a.mode&&(i=0,this.input.set.call(this)),1==s.length&&\"select\"!=a.mode&&s[0].node.classList.contains(a.classNames.tagNotAllowed)&&(e=!0),s.length)return a.hooks.beforeRemoveTag(s,{tagify:this}).then((()=>{function t(t){t.node.parentNode&&(t.node.parentNode.removeChild(t.node),e?a.keepInvalidTags&&this.trigger(\"remove\",{tag:t.node,index:t.idx}):(this.trigger(\"remove\",{tag:t.node,index:t.idx,data:t.data}),this.dropdown.refilter(),this.dropdown.position(),this.DOM.input.normalize(),a.keepInvalidTags&&this.reCheckInvalidTags()))}i&&i>10&&1==s.length?function(e){e.node.style.width=parseFloat(window.getComputedStyle(e.node).width)+\"px\",document.body.clientTop,e.node.classList.add(a.classNames.tagHide),setTimeout(t.bind(this),i,e)}.call(this,s[0]):s.forEach(t.bind(this)),e||(this.removeTagsFromValue(s.map((t=>t.node))),this.update(),\"select\"==a.mode&&this.setContentEditable(!0))})).catch((t=>{}))},removeTagsFromDOM(){[].slice.call(this.getTagElms()).forEach((t=>t.parentNode.removeChild(t)))},removeTagsFromValue(t){(t=Array.isArray(t)?t:[t]).forEach((t=>{var e=T(t),i=this.getTagIdx(e);i>-1&&this.value.splice(i,1)}))},removeAllTags(t){t=t||{},this.value=[],\"mix\"==this.settings.mode?this.DOM.input.innerHTML=\"\":this.removeTagsFromDOM(),this.dropdown.refilter(),this.dropdown.position(),this.state.dropdown.visible&&setTimeout((()=>{this.DOM.input.focus()})),\"select\"==this.settings.mode&&(this.input.set.call(this),this.setContentEditable(!0)),this.update(t)},postUpdate(){this.state.blockChangeEvent=!1;var t=this.settings,e=t.classNames,i=\"mix\"==t.mode?t.mixMode.integrated?this.DOM.input.textContent:this.DOM.originalInput.value.trim():this.value.length+this.input.raw.call(this).length;this.toggleClass(e.hasMaxTags,this.value.length>=t.maxTags),this.toggleClass(e.hasNoTags,!this.value.length),this.toggleClass(e.empty,!i),\"select\"==t.mode&&this.toggleScopeValidation(this.value?.[0]?.__isValid)},setOriginalInputValue(t){var e=this.DOM.originalInput;this.settings.mixMode.integrated||(e.value=t,e.tagifyValue=e.value,this.setPersistedData(t,\"value\"))},update(t){clearTimeout(this.debouncedUpdateTimeout),this.debouncedUpdateTimeout=setTimeout(function(){var e=this.getInputValue();this.setOriginalInputValue(e),this.settings.onChangeAfterBlur&&(t||{}).withoutChangeEvent||this.state.blockChangeEvent||this.triggerChangeEvent();this.postUpdate()}.bind(this),100)},getInputValue(){var t=this.getCleanValue();return\"mix\"==this.settings.mode?this.getMixedTagsAsString(t):t.length?this.settings.originalInputValueFormat?this.settings.originalInputValueFormat(t):JSON.stringify(t):\"\"},getCleanValue(t){return a(t||this.value,this.dataProps)},getMixedTagsAsString(){var t=\"\",e=this,i=this.settings,s=i.originalInputValueFormat||JSON.stringify,a=i.mixTagsInterpolator;return function i(o){o.childNodes.forEach((o=>{if(1==o.nodeType){const r=T(o);if(\"BR\"==o.tagName&&(t+=\"\\r\\n\"),r&&v.call(e,o)){if(r.__removed)return;t+=a[0]+s(n(r,e.dataProps))+a[1]}else o.getAttribute(\"style\")||[\"B\",\"I\",\"U\"].includes(o.tagName)?t+=o.textContent:\"DIV\"!=o.tagName&&\"P\"!=o.tagName||(t+=\"\\r\\n\",i(o))}else t+=o.textContent}))}(this.DOM.input),t}},N.prototype.removeTag=N.prototype.removeTags,N}));\n","// TODO: Tagify and rollup using vite with .js?\r\nimport { onManageActiveEffect, prepareActiveEffectCategories } from \"../helpers/effects.mjs\";\r\nimport { onManageRule } from \"../rules/rules.mjs\";\r\nimport { options } from \"../rules/rule-field.mjs\";\r\nimport Tagify from \"@yaireo/tagify\";\r\n\r\n/**\r\n * Extend the basic ItemSheet with some very simple modifications\r\n * @extends {ItemSheet}\r\n */\r\nexport class AbbrewItemSheet extends ItemSheet {\r\n\r\n  /** @override */\r\n  static get defaultOptions() {\r\n    return mergeObject(super.defaultOptions, {\r\n      classes: [\"abbrew\", \"sheet\", \"item\"],\r\n      width: 520,\r\n      height: 480,\r\n      tabs: [{ navSelector: \".sheet-tabs\", contentSelector: \".sheet-body\", initial: \"description\" }]\r\n    });\r\n  }\r\n\r\n  /** @override */\r\n  get template() {\r\n    const path = \"systems/abbrew/templates/item\";\r\n    // Return a single sheet for all item types.\r\n    // return `${path}/item-sheet.html`;\r\n\r\n    // Alternatively, you could use the following return statement to do a\r\n    // unique item sheet by type, like `weapon-sheet.html`.\r\n    return `${path}/item-${this.item.type}-sheet.hbs`;\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n\r\n  /** @override */\r\n  getData() {\r\n    // Retrieve base data structure.\r\n    const context = super.getData();\r\n\r\n    // Use a safe clone of the item data for further operations.\r\n    const itemData = context.item;\r\n\r\n    // Retrieve the roll data for TinyMCE editors.\r\n    context.rollData = {};\r\n    let actor = this.object?.parent ?? null;\r\n    if (actor) {\r\n      context.rollData = actor.getRollData();\r\n    }\r\n\r\n    // Prepare active effects\r\n    context.effects = prepareActiveEffectCategories(this.item.effects);\r\n\r\n    // Add the actor's data to context.data for easier access, as well as flags.\r\n    context.system = itemData.system;\r\n    context.flags = itemData.flags;\r\n\r\n    return context;\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n\r\n  /** @override */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n\r\n    // Everything below here is only needed if the sheet is editable\r\n    if (!this.isEditable) {\r\n      return;\r\n    }\r\n\r\n    // TODO:\r\n    // 1. Probably just want these split out anyway\r\n    const requirements = html[0].querySelector('input[name=\"system.weapon.requirements\"]');\r\n    if (requirements) {\r\n      var taggedRequirements = new Tagify(requirements, {});\r\n    }\r\n\r\n    // Active Effect management\r\n    html.find(\".effect-control\").click(ev => onManageActiveEffect(ev, this.item));\r\n\r\n    // Rules management\r\n    html.find(\".rule-control\").click(async ev => await onManageRule(ev, this.item));\r\n\r\n    // Roll handlers, click handlers, etc. would go here.\r\n  }\r\n\r\n  async _updateObject(event, formData) {\r\n    if ((event.handleObj && event.handleObj.type == 'change') || (event.type && event.type == 'change')) {\r\n\r\n      if (event.currentTarget) {\r\n        await this.manualUpdate(event, formData);\r\n      }\r\n      else {\r\n        super._updateObject(event, formData);\r\n      }\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  async manualUpdate(event, formData) {\r\n    const target = event.currentTarget;\r\n    if (target.classList.contains(\"rule-editor\")) {\r\n      const dataset = target.dataset;\r\n      const ruleId = dataset.ruleId;\r\n      const field = dataset.field;\r\n      const updateData = formData[target.name];\r\n      let rules = foundry.utils.deepClone(this.item.system.rules);\r\n      const index = rules.findIndex(r => r.id == ruleId);\r\n      rules[index][field] = updateData;\r\n      if (field == \"type\") {\r\n        rules[index].content = options[updateData].template();\r\n      }\r\n      return await this.item.update({\r\n        \"system.rules\": rules\r\n      });\r\n    } else {\r\n      super._updateObject(event, formData);\r\n    }\r\n  }\r\n\r\n  close(options = {}) {\r\n    console.log('closing sheet');\r\n    this.getData();\r\n    super.close(options);\r\n  }\r\n}\r\n","import { AbbrewItemSheet } from \"./item-sheet.mjs\";\r\n\r\nexport class AbbrewItemAnatomySheet extends AbbrewItemSheet {\r\n    /** @override */\r\n    activateListeners(html) {\r\n        super.activateListeners(html);\r\n        const getInput = (name) => html.querySelector(`input[name=\"${name}\"]`);\r\n    }\r\n\r\n    /** @override */\r\n    get template() {\r\n        const path = \"systems/abbrew/templates/item\";\r\n        // Return a single sheet for all item types.\r\n        // return `${path}/item-sheet.html`;\r\n\r\n        // Alternatively, you could use the following return statement to do a\r\n        // unique item sheet by type, like `weapon-sheet.html`.\r\n        return `${path}/item-anatomy-sheet.hbs`;\r\n    }\r\n\r\n}","/**\r\n * Define a set of template paths to pre-load\r\n * Pre-loaded templates are compiled and cached for fast access when rendering\r\n * @return {Promise}\r\n */\r\nexport const preloadHandlebarsTemplates = async function () {\r\n  return loadTemplates([\r\n\r\n    // Actor partials.\r\n    \"systems/abbrew/templates/actor/parts/actor-features.hbs\",\r\n    \"systems/abbrew/templates/actor/parts/actor-items.hbs\",\r\n    \"systems/abbrew/templates/actor/parts/actor-anatomy.hbs\",\r\n    \"systems/abbrew/templates/actor/parts/actor-resources.hbs\",\r\n    \"systems/abbrew/templates/actor/parts/actor-spells.hbs\",\r\n    \"systems/abbrew/templates/actor/parts/actor-effects.hbs\",\r\n    \"systems/abbrew/templates/actor/parts/actor-attacks.hbs\",\r\n    \"systems/abbrew/templates/actor/parts/actor-defences.hbs\",\r\n    \"systems/abbrew/templates/actor/parts/actor-armour.hbs\",\r\n    \"systems/abbrew/templates/actor/parts/actor-form.hbs\",\r\n    \"systems/abbrew/templates/actor/parts/actor-conditions.hbs\",\r\n    \"systems/abbrew/templates/parts/active-effects.hbs\",\r\n    \"systems/abbrew/templates/chat/damage-roll.hbs\",\r\n    \"systems/abbrew/templates/parts/item-rules.hbs\"\r\n  ]);\r\n};\r\n","export default class AbbrewRoll extends Roll {\r\n    constructor(formula, data, options) {\r\n        super(formula, data, options);\r\n        if (!this.options.configured) {\r\n            this._configureModifiers();\r\n        }\r\n    }\r\n\r\n    static async fromRoll(roll) {\r\n        const newRoll = new this(roll.formula, roll.data, roll.options);\r\n        await newRoll.evaluate({async: true});\r\n        return newRoll;\r\n    }\r\n\r\n    get validD10Roll() {\r\n        return (this.terms[0].rolls[0].terms[0] instanceof Die) && (this.terms[0].rolls[0].terms[0].faces === 10);\r\n    }\r\n\r\n    static EVALUATION_TEMPLATE = \"systems/abbrew/templates/chat/roll-dialog.hbs\";\r\n\r\n    static CHAT_TEMPLATE = \"systems/abbrew/templates/chat/damage-roll.hbs\";\r\n\r\n    async render(flavor, template, isPrivate) {\r\n        template = this.CHAT_TEMPLATE;\r\n\r\n        return super.render(flavor, template, isPrivate);\r\n    }\r\n\r\n    /** @inheritdoc */\r\n    async toMessage(messageData = {}, options = {}) {\r\n\r\n        // return early for invalid roll formula\r\n        if (!this.validD10Roll) {\r\n            return;\r\n        }\r\n\r\n        // Evaluate the roll now so we have the results available to determine whether reliable talent came into play\r\n        if (!this._evaluated) await this.evaluate({ async: true });\r\n\r\n        // Add appropriate advantage mode message flavor and dnd5e roll flags\r\n        // messageData.flavor = messageData.flavor || this.options.flavor;\r\n        // if (this.hasAdvantage) messageData.flavor += ` (${game.i18n.localize(\"DND5E.Advantage\")})`;\r\n        // else if (this.hasDisadvantage) messageData.flavor += ` (${game.i18n.localize(\"DND5E.Disadvantage\")})`;\r\n\r\n        // Add reliable talent to the d20-term flavor text if it applied\r\n        // if (this.validD20Roll && this.options.reliableTalent) {\r\n        //     const d20 = this.dice[0];\r\n        //     const isRT = d20.results.every(r => !r.active || (r.result < 10));\r\n        //     const label = `(${game.i18n.localize(\"DND5E.FlagsReliableTalent\")})`;\r\n        //     if (isRT) d20.options.flavor = d20.options.flavor ? `${d20.options.flavor} (${label})` : label;\r\n        // }\r\n\r\n        // Record the preferred rollMode\r\n        options.rollMode = options.rollMode ?? this.options.rollMode;\r\n        // messageData.flags = { data: { foo: \"bar\", baz: \"fuck\" } };\r\n        return super.toMessage(messageData, options);\r\n    }\r\n\r\n    async configureDialog({ title, template } = {}, options = {}) {\r\n\r\n        // Render the Dialog inner HTML\r\n        const content = await renderTemplate(template ?? this.constructor.EVALUATION_TEMPLATE, {\r\n            formula: `d10!`\r\n        });\r\n\r\n        let defaultButton = \"normal\";\r\n        // switch ( defaultAction ) {\r\n        //   case D20Roll.ADV_MODE.ADVANTAGE: defaultButton = \"advantage\"; break;\r\n        //   case D20Roll.ADV_MODE.DISADVANTAGE: defaultButton = \"disadvantage\"; break;\r\n        // }\r\n\r\n        // Create the Dialog window and await submission of the form\r\n        return new Promise(resolve => {\r\n            new Dialog({\r\n                title,\r\n                content,\r\n                buttons: {\r\n                    advantage: {\r\n                        label: \"1\"/* game.i18n.localize(\"DND5E.Advantage\") */,\r\n                        callback: html => resolve(this._onDialogSubmit(html/* , D20Roll.ADV_MODE.ADVANTAGE */))\r\n                    },\r\n                    normal: {\r\n                        label: \"2\"/* game.i18n.localize(\"DND5E.Normal\") */,\r\n                        callback: html => resolve(this._onDialogSubmit(html/* , D20Roll.ADV_MODE.NORMAL */))\r\n                    },\r\n                    disadvantage: {\r\n                        label: \"3\"/* game.i18n.localize(\"DND5E.Disadvantage\") */,\r\n                        callback: html => resolve(this._onDialogSubmit(html/* , D20Roll.ADV_MODE.DISADVANTAGE */))\r\n                    }\r\n                },\r\n                default: defaultButton,\r\n                close: () => resolve(null)\r\n            }, options).render(true);\r\n        });\r\n    }\r\n\r\n    // async RollAbbrew(element, dataset, actor) {\r\n\r\n    //   // Handle item rolls.\r\n    //   if (dataset.rollType) {\r\n    //     if (dataset.rollType == 'item') {\r\n    //       const itemId = element.closest('.item').dataset.itemId;\r\n    //       const item = actor.items.get(itemId);\r\n    //       if (item) {\r\n    //         return await ChatAbbrew(actor, item);\r\n    //         //   let label = item.name;\r\n    //         //   let roll = new Roll(\"d10! + \" + item.system.formula, actor.getRollData());\r\n    //         //   roll.toMessage({\r\n    //         //     speaker: ChatMessage.getSpeaker({ actor: actor }),\r\n    //         //     flavor: label,\r\n    //         //     rollMode: game.settings.get('core', 'rollMode'),\r\n    //         //   });\r\n    //         //   Hooks.callAll('abbrew.ability', label);\r\n    //         //   return roll;\r\n    //       }\r\n    //     }\r\n    //   }\r\n\r\n    //   // Handle rolls that supply the formula directly.\r\n    //   if (dataset.ability) {\r\n    //     let label = dataset.label ? `[ability] ${dataset.label}` : '';\r\n    //     let roll = new Roll(\"d10 + \" + dataset.ability, actor.getRollData());\r\n    //     roll.toMessage({\r\n    //       speaker: ChatMessage.getSpeaker({ actor: actor }),\r\n    //       flavor: label,\r\n    //       rollMode: game.settings.get('core', 'rollMode'),\r\n    //     });\r\n    //     Hooks.callAll('abbrew.ability', label);\r\n    //     return roll;\r\n    //   }\r\n    // }\r\n\r\n    _onDialogSubmit(html, advantageMode) {\r\n        const form = html[0].querySelector(\"form\");\r\n\r\n        // // Append a situational bonus term\r\n        // if (form.bonus.value) {\r\n        //   const bonus = new Roll(form.bonus.value, this.data);\r\n        //   if (!(bonus.terms[0] instanceof OperatorTerm)) this.terms.push(new OperatorTerm({ operator: \"+\" }));\r\n        //   this.terms = this.terms.concat(bonus.terms);\r\n        // }\r\n\r\n        if (form.weakOrStrong.value) {\r\n            const weakOrStrong = form.weakOrStrong.value;\r\n            if (weakOrStrong < 0) {\r\n                this.options.weak = true;\r\n                this.options.weakValue = Math.abs(weakOrStrong)\r\n            }\r\n            else if (weakOrStrong > 0) {\r\n                this.options.strong = true;\r\n                this.options.strongValue = Math.abs(weakOrStrong)\r\n            }\r\n        }\r\n\r\n        // // Customize the modifier\r\n        // if (form.ability?.value) {\r\n        //   const abl = this.data.statistics[form.ability.value];\r\n        //   this.terms = this.terms.flatMap(t => {\r\n        //     if (t.term === \"@mod\") return new NumericTerm({ number: abl.mod });\r\n        //     if (t.term === \"@abilityCheckBonus\") {\r\n        //       const bonus = abl.bonuses?.check;\r\n        //       if (bonus) return new Roll(bonus, this.data).terms;\r\n        //       return new NumericTerm({ number: 0 });\r\n        //     }\r\n        //     return t;\r\n        //   });\r\n        //   this.options.flavor += ` (${CONFIG.DND5E.statistics[form.ability.value]})`;\r\n        // }\r\n\r\n        // Apply advantage or disadvantage\r\n        // this.options.advantageMode = advantageMode;\r\n        // this.options.rollMode = form.rollMode.value;\r\n        this._configureModifiers();\r\n        return this;\r\n\r\n        // let roll = new Roll(\"d10\", {});\r\n        // roll.toMessage({\r\n        //     speaker: ChatMessage.getSpeaker({ actor: this.actor }),\r\n        //     flavor: \"label\",\r\n        //     rollMode: game.settings.get('core', 'rollMode'),\r\n        // });\r\n        // return roll;\r\n    }\r\n\r\n    _configureModifiers() {\r\n        const d10 = this.terms[0].rolls[0];\r\n\r\n        if (this.options.weak) {\r\n            d10.terms[4].number += this.options.weakValue;\r\n        }\r\n\r\n        if (this.options.strong) {\r\n            d10.terms[0].number += this.options.strongValue;\r\n        }\r\n\r\n        // d10.number = 3;\r\n\r\n        this._formula = this.constructor.getFormula(this.terms);\r\n\r\n        this.options.configured = true;\r\n    }\r\n}","export async function handleTurnStart(combat, updateData, updateOptions) {\r\n    if (updateData.round < combat.round || (updateData.round == combat.round && updateData.turn < combat.turn)) {\r\n        return;\r\n    }\r\n    let nextActor = combat.current.combatantId ? combat.nextCombatant.actor : combat.turns[0].actor;\r\n    await turnStart(nextActor);\r\n}\r\n\r\nasync function turnStart(actor) {\r\n    ChatMessage.create({ content: `${actor.name} starts their turn`, speaker: ChatMessage.getSpeaker({ actor: actor }) });\r\n\r\n    if (actor.system.canBleed) {\r\n        let activeWounds = actor.system.wounds.active;\r\n        console.log(activeWounds);\r\n\r\n        let currentBlood = actor.system.blood.value;\r\n        console.log(currentBlood);\r\n\r\n        let gushingWounds = 0;\r\n        if (activeWounds === 0) {\r\n            await actor.update({ \"system.conditions.gushingWounds\": 0 });\r\n        }\r\n\r\n        if (actor.system.conditions.gushingWounds > 0) {\r\n            gushingWounds = actor.system.conditions.gushingWounds * 5;\r\n        }\r\n\r\n        let bleedPrevention = actor.system.conditions.bleedPrevention;\r\n        if (bleedPrevention > 0) {\r\n            let healingWounds = actor.system.wounds.healing + bleedPrevention;\r\n            await actor.update({ \"system.wounds.healing\": healingWounds });\r\n        }\r\n\r\n        let newBlood = currentBlood - (activeWounds + gushingWounds - bleedPrevention);\r\n        console.log(newBlood);\r\n\r\n        await actor.update({ \"system.blood.value\": newBlood });\r\n\r\n        if (newBlood <= actor.system.blood.nausea) {\r\n            await actor.update({ \"system.conditions.nausea\": 1 });\r\n        } else {\r\n            await actor.update({ \"system.conditions.nausea\": 0 });\r\n        }\r\n\r\n        if (newBlood <= actor.system.blood.unconscious) {\r\n            await actor.update({ \"system.conditions.unconscious\": 1 });\r\n        } else {\r\n            await actor.update({ \"system.conditions.unconscious\": 0 });\r\n        }\r\n    }\r\n\r\n    let armour = actor.system.armour;\r\n    let newArmour = armour.value;\r\n    console.log('Armour: ', armour);\r\n\r\n    if (armour.value < armour.max) {\r\n        getOut: if (actor.effects.find(e => e.label === \"Regenerating\")) {\r\n            console.log('Check for regain Armour');\r\n            // TODO: Replace with Exposed\r\n            if (actor.effects.find(e => e.label === \"Weakened\")) {\r\n                console.log('Exposed so no armour regained');\r\n                break getOut;\r\n            }\r\n\r\n            let armourMultiplier = 1;\r\n            // TODO: Was to be from sundered. just reduce max for that.\r\n            if (actor.effects.find(e => e.label === \"Cursed\")) {\r\n                armourMultiplier = 0.5;\r\n            }\r\n\r\n            console.log('Regain Armour');\r\n            let missingArmour = armour.max - armour.value;\r\n            console.log('Missing Armour: ', missingArmour);\r\n\r\n            newArmour = armour.value + Math.max(Math.floor((missingArmour * armourMultiplier) / 2), 1);\r\n            console.log('newArmour', newArmour);\r\n\r\n        }\r\n    } else {\r\n        newArmour = armour.max;\r\n    }\r\n\r\n    await actor.update({ \"system.armour.value\": newArmour });\r\n}","// Import document classes.\r\nimport { AbbrewActor } from \"./documents/actor.mjs\";\r\nimport { AbbrewItem } from \"./documents/item.mjs\";\r\n// Import sheet classes.\r\nimport { AbbrewActorSheet } from \"./sheets/actor-sheet.mjs\";\r\nimport { AbbrewItemSheet } from \"./sheets/item-sheet.mjs\";\r\nimport { AbbrewItemAnatomySheet } from \"./sheets/item-anatomy-sheet.mjs\";\r\n// Import helper/utility classes and constants.\r\nimport { preloadHandlebarsTemplates } from \"./helpers/templates.mjs\";\r\nimport { ABBREW } from \"./helpers/config.mjs\";\r\nimport AbbrewRoll from \"./helpers/abbrew-roll.mjs\";\r\nimport { handleTurnStart } from \"./helpers/turn-start.mjs\";\r\nimport { ChoiceSetPrompt } from \"./rules/choice-set-prompt.mjs\";\r\n\r\n/* -------------------------------------------- */\r\n/*  Init Hook                                   */\r\n/* -------------------------------------------- */\r\n\r\nHooks.once('init', async function () {\r\n\r\n  Handlebars.registerHelper('json', function (context) {\r\n    return JSON.stringify(context);\r\n  });\r\n\r\n  // Add utility classes to the global game object so that they're more easily\r\n  // accessible in global contexts.\r\n  game.abbrew = {\r\n    AbbrewActor,\r\n    AbbrewItem,\r\n    rollItemMacro\r\n  };\r\n\r\n  // Add custom constants for configuration.\r\n  CONFIG.ABBREW = ABBREW;\r\n\r\n  /**\r\n   * Set an initiative formula for the system\r\n   * @type {String}\r\n   */\r\n  CONFIG.Combat.initiative = {\r\n    formula: \"1d10 + @statistics.dexterity.mod + @statistics.agility.mod + @statistics.wits.mod\",\r\n    decimals: 2\r\n  };\r\n\r\n  // Record Configuration Values\r\n  CONFIG.Dice.AbbrewRoll = AbbrewRoll;\r\n  CONFIG.Dice.rolls.push(AbbrewRoll);\r\n\r\n  // Define custom Document classes\r\n  CONFIG.Actor.documentClass = AbbrewActor;\r\n  CONFIG.Item.documentClass = AbbrewItem;\r\n\r\n  // Register sheet application classes\r\n  Actors.unregisterSheet(\"core\", ActorSheet);\r\n  Actors.registerSheet(\"abbrew\", AbbrewActorSheet, { makeDefault: true });\r\n  Items.unregisterSheet(\"core\", ItemSheet);\r\n  // Items.registerSheet(\"abbrew\", AbbrewItemSheet, { makeDefault: true });\r\n  const sheetEntries = [\r\n    [\"anatomy\", AbbrewItemAnatomySheet],\r\n    [\"item\", AbbrewItemSheet],\r\n    [\"feature\", AbbrewItemSheet],\r\n    [\"spell\", AbbrewItemSheet],\r\n    [\"resource\", AbbrewItemSheet],\r\n    [\"attack\", AbbrewItemSheet],\r\n    [\"defence\", AbbrewItemSheet]\r\n  ]\r\n  for (const [type, Sheet] of sheetEntries) {\r\n    Items.registerSheet(\"abbrew\", Sheet, {\r\n      types: [type],\r\n      label: game.i18n.localize(ABBREW.SheetLabel, { type: type }),\r\n      makeDefault: true,\r\n    });\r\n  }\r\n\r\n  // Preload Handlebars templates.\r\n  return preloadHandlebarsTemplates();\r\n});\r\n\r\n\r\nHooks.on(\"pauseGame\", async function (paused) {\r\n  const actor = game.actors.get(\"rLEUu5Vg7QCj59dE\");\r\n  console.log('paused');\r\n  const items = actor.items;\r\n  const choices = items.map(i => ({ id: i._id, name: i.name }));\r\n  const data = { content: { promptTitle: \"Hello\", choices }, buttons: {} };\r\n  const returned = await new ChoiceSetPrompt(data).resolveSelection();\r\n  console.log(returned);\r\n  // const template = \"systems/abbrew/templates/rules/choice-set-prompt.hbs\";\r\n  // const html = await renderTemplate(template, data);\r\n  // let d = new Dialog({\r\n  //   content: html,\r\n  //   buttons: {},\r\n  //   render: html => console.log(\"Register interactivity in the rendered dialog\"),\r\n  //   close: html => console.log(\"This always is logged no matter which option is chosen\")\r\n  //  });\r\n  //  d.render(true);   \r\n});\r\n\r\n/* -------------------------------------------- */\r\n/*  Handlebars Helpers                          */\r\n/* -------------------------------------------- */\r\n\r\n// If you need to add Handlebars helpers, here are a few useful examples:\r\nHandlebars.registerHelper('concat', function () {\r\n  var outStr = '';\r\n  for (var arg in arguments) {\r\n    if (typeof arguments[arg] != 'object') {\r\n      outStr += arguments[arg];\r\n    }\r\n  }\r\n  return outStr;\r\n});\r\n\r\nHandlebars.registerHelper('toLowerCase', function (str) {\r\n  return str.toLowerCase();\r\n});\r\n\r\nHandlebars.registerHelper(\"isNumber\", function (value) {\r\n  return typeof value === \"number\";\r\n});\r\n\r\n/* -------------------------------------------- */\r\n/*  Ready Hook                                  */\r\n/* -------------------------------------------- */\r\n\r\nHooks.once(\"ready\", async function () {\r\n  // Wait to register hotbar drop hook on ready so that modules could register earlier if they want to\r\n  Hooks.on(\"hotbarDrop\", (bar, data, slot) => createItemMacro(data, slot));\r\n});\r\n\r\n/* -------------------------------------------- */\r\n/*  Hotbar Macros                               */\r\n/* -------------------------------------------- */\r\n\r\n/**\r\n * Create a Macro from an Item drop.\r\n * Get an existing item macro if one exists, otherwise create a new one.\r\n * @param {Object} data     The dropped data\r\n * @param {number} slot     The hotbar slot to use\r\n * @returns {Promise}\r\n */\r\nasync function createItemMacro(data, slot) {\r\n  // First, determine if this is a valid owned item.\r\n  if (data.type !== \"Item\") return;\r\n  if (!data.uuid.includes('Actor.') && !data.uuid.includes('Token.')) {\r\n    return ui.notifications.warn(\"You can only create macro buttons for owned Items\");\r\n  }\r\n  // If it is, retrieve it based on the uuid.\r\n  const item = await Item.fromDropData(data);\r\n\r\n  // Create the macro command using the uuid.\r\n  const command = `game.abbrew.rollItemMacro(\"${data.uuid}\");`;\r\n  let macro = game.macros.find(m => (m.name === item.name) && (m.command === command));\r\n  if (!macro) {\r\n    macro = await Macro.create({\r\n      name: item.name,\r\n      type: \"script\",\r\n      img: item.img,\r\n      command: command,\r\n      flags: { \"abbrew.itemMacro\": true }\r\n    });\r\n  }\r\n  game.user.assignHotbarMacro(macro, slot);\r\n  return false;\r\n}\r\n\r\n/**\r\n * Create a Macro from an Item drop.\r\n * Get an existing item macro if one exists, otherwise create a new one.\r\n * @param {string} itemUuid\r\n */\r\nfunction rollItemMacro(itemUuid) {\r\n  // Reconstruct the drop data so that we can load the item.\r\n  const dropData = {\r\n    type: 'Item',\r\n    uuid: itemUuid\r\n  };\r\n  // Load the item from the uuid.\r\n  Item.fromDropData(dropData).then(item => {\r\n    // Determine if the item loaded and if it's an owned item.\r\n    if (!item || !item.parent) {\r\n      const itemName = item?.name ?? itemUuid;\r\n      return ui.notifications.warn(`Could not find item ${itemName}. You may need to delete and recreate this macro.`);\r\n    }\r\n\r\n    // Trigger the item roll\r\n    item.roll();\r\n  });\r\n}\r\n\r\nHooks.on(\"renderChatLog\", (app, html, data) => AbbrewItem.chatListeners(html));\r\n\r\nHooks.on(\"abbrew.ability\", function (ability) {\r\n  console.log(\"Hooked on \" + ability);\r\n});\r\n\r\nHooks.once(\"dragRuler.ready\", (SpeedProvider) => {\r\n  class AbbrewSpeedProvider extends SpeedProvider {\r\n    get colors() {\r\n      return [\r\n        { id: \"walk\", default: 0x00FF00, name: \"abbrew.speeds.walk\" },\r\n        { id: \"dash\", default: 0xFFFF00, name: \"abbrew.speeds.dash\" },\r\n        { id: \"run\", default: 0xFF8000, name: \"abbrew.speeds.run\" }\r\n      ]\r\n    }\r\n\r\n    getRanges(token) {\r\n      const baseSpeed = token.actor.system.movement.base\r\n\r\n      // A character can always walk it's base speed and dash twice it's base speed\r\n      const ranges = [\r\n        { range: baseSpeed, color: \"walk\" },\r\n        { range: baseSpeed * 2, color: \"dash\" },\r\n        { range: baseSpeed * 3, color: \"run\" }\r\n      ]\r\n\r\n      return ranges\r\n    }\r\n  }\r\n\r\n  dragRuler.registerSystem(\"abbrew\", AbbrewSpeedProvider)\r\n})\r\n\r\n// Combat Start Hooks\r\n\r\nHooks.on(\"combatStart\", async (combat, updateData, updateOptions) => {\r\n  await handleTurnStart(combat, updateData, updateOptions);\r\n});\r\n\r\nHooks.on(\"combatRound\", async (combat, updateData, updateOptions) => {\r\n  await handleTurnStart(combat, updateData, updateOptions);\r\n})\r\n\r\nHooks.on(\"combatTurn\", async (combat, updateData, updateOptions) => {\r\n  await handleTurnStart(combat, updateData, updateOptions);\r\n})\r\n\r\n// Update Hooks\r\n\r\nHooks.on(\"updateActor\", (value) => {\r\n  console.log('ActorUpdated');\r\n})\r\n\r\nHooks.on(\"updateToken\", (value) => {\r\n  console.log('TokenUpdated');\r\n})"],"names":["d10Roll","parts","data","title","flavour","dialogOptions","messageData","options","chatMessage","rollMode","flavor","dice","weakness","formula","defaultRollMode","roll","onDamageAccept","AbbrewAttackProfile","id","abilityModifier","damageBase","isWeapon","weapon","isMagic","magic","__publicField","useAttack","attack","attackProfile","actor","rollData","getRollData","rollConfig","getCriticalThreshold","getAmplification","getWeakness","weaponThreshold","damageType","globalThreshold","damageTypeThreshold","calculatedThreshold","event","messageId","message","token","AbbrewRule","label","type","source","valid","rule","actorData","candidate","ABBREW","AbbrewActiveEffect","changes","targetElement","targetElementType","currentValue","targetType","ruleValue","delta","newValue","elementChanges","sourceValue","raw","ChoiceSetPrompt","$html","element","firstChoice","resolve","force","_a","AbbrewChoiceSet","target","choices","choice","parentItemId","i","parentItem","ruleContent","parsedContent","AbbrewRuleField","content","RuleSource","uuid","onManageRule","item","a","ruleId","rules","r","prepareRules","validRules","sourceTargets","parsedRule","typedRule","equipState","applyRule","writeToPath","path","value","pathWrite","keyed","AbbrewActor","systemData","formData","userId","changed","user","flatChanges","flatChangesArray","key","overrideKeys","c","keys","prop","parent","obj","embeddedName","documents","result","r1","r2","ruleChange","override","documentClass","updates","pack","tags","armourPoints","defences","k","v","attacks","w","results","wp","index","profileParts","attackType","requirements","equip","ability","base","limbs","naturalBonuses","naturalValue","b","initialValue","fullArmourMax","accumulator","defencesArray","sum","damageRolls","attackData","damage","damageRoll","damagePenetrate","currentArmour","newArmour","untypedCritical","damageTypeDefence","criticalExplosions","penetrate","armourAdjustment","fullDamage","damageThroughArmour","availableArmour","damageToArmour","currentBlood","maxBlood","diceResults","maximiseDifference","vulnerable","negate","criticalThreshold","activeWounds","pain","_","AbbrewItem","speaker","config","templateData","html","chatData","card","htmlOptions","props","p","button","action","storedData","err","context","actorId","targets","t","ChatAbbrew","dataset","onManageActiveEffect","owner","li","effect","prepareActiveEffectCategories","effects","categories","e","AbbrewActorSheet","anatomy","resources","abilities","gear","features","spells","ev","handler","dataSet","weaponId","armourId","header","itemData","itemId","ap","module","this","s","n","o","l","d","h","g","u","m","f","T","y","x","O","D","M","I","_b","N","AbbrewItemSheet","Tagify","field","updateData","AbbrewItemAnatomySheet","preloadHandlebarsTemplates","AbbrewRoll","newRoll","template","isPrivate","defaultButton","advantageMode","form","weakOrStrong","d10","handleTurnStart","combat","updateOptions","nextActor","turnStart","gushingWounds","bleedPrevention","healingWounds","newBlood","armour","getOut","armourMultiplier","missingArmour","rollItemMacro","sheetEntries","Sheet","paused","returned","outStr","arg","str","bar","slot","createItemMacro","command","macro","itemUuid","dropData","itemName","app","SpeedProvider","AbbrewSpeedProvider","baseSpeed"],"mappings":"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","x_google_ignoreList":[16]}