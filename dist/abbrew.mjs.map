{"version":3,"file":"abbrew.mjs","sources":["../module/helpers/dice.mjs","../module/documents/attackprofile.mjs","../module/rules/rules-data/abbrew-rule.mjs","../module/helpers/config.mjs","../module/rules/rules-data/active-effect.mjs","../module/rules/choice-set-prompt.mjs","../module/rules/rules-data/choice-set.mjs","../module/rules/rule-field.mjs","../module/rules/rule-source.mjs","../module/rules/rules.mjs","../module/helpers/write-to-path.mjs","../module/documents/actor.mjs","../module/documents/item.mjs","../module/helpers/chat.mjs","../module/helpers/effects.mjs","../module/sheets/actor-sheet.mjs","../node_modules/@yaireo/tagify/dist/tagify.min.js","../module/sheets/item-sheet.mjs","../module/sheets/item-anatomy-sheet.mjs","../module/helpers/templates.mjs","../module/helpers/abbrew-roll.mjs","../module/helpers/turn-start.mjs","../module/sheets/item-form-sheet.mjs","../module/abbrew.mjs"],"sourcesContent":["export async function d10Roll({\r\n    parts = [], data = {}, title,\r\n    flavour, dialogOptions, messageData = {}, options = {},\r\n    chatMessage = true, rollMode, flavor\r\n}) {\r\n\r\n    // TODO: Set up concept page, maybe under conditions?\r\n    // TODO: Negate should be an int value so as not to be too strong.\r\n    let dice = 1 + data.amplification;\r\n    let weakness = 0 + data.weakness\r\n\r\n    dice = '' + dice;\r\n    weakness = '' + weakness;\r\n\r\n    const fullParts = ['{' + dice + 'd10x>=' + data.criticalThreshold, ...parts];\r\n\r\n    const formula = fullParts.join('+') + ' -' + weakness + 'd10, 0}kh';\r\n\r\n    const defaultRollMode = rollMode || game.settings.get(\"core\", \"rollMode\");\r\n\r\n    const rollOptions = foundry.utils.mergeObject(options, {\r\n        flavor: flavor || title,\r\n        defaultRollMode,\r\n        rollMode\r\n    });\r\n\r\n    const roll = new CONFIG.Dice.AbbrewRoll(formula, data);\r\n\r\n    const configured = await roll.configureDialog({ title: \"Additional Modifiers\" });\r\n\r\n    await roll.evaluate({ async: true });\r\n\r\n    messageData = {};\r\n    messageData.flags = { data: data };\r\n\r\n    await roll.toMessage(messageData);\r\n}","import { d10Roll } from \"../helpers/dice.mjs\";\r\n\r\n// Hooks.on('init', /*async*/ () => {\r\n//   $(document).on('click', '.damage-application button', /*await*/ onDamageAccept);\r\n// });\r\n\r\nexport class AbbrewAttackProfile {\r\n  id = \"\";\r\n  abilityModifier = \"\";\r\n  damageBase = 0;\r\n  isWeapon = false;\r\n  weapon = {};\r\n  isMagic = false;\r\n  magic = {};\r\n\r\n  constructor(id, abilityModifier, damageBase, isWeapon, weapon, isMagic, magic) {\r\n    this.id = id;\r\n    this.abilityModifier = abilityModifier;\r\n    this.damageBase = damageBase;\r\n    this.isWeapon = isWeapon;\r\n    this.weapon = weapon;\r\n    this.isMagic = isMagic;\r\n    this.magic = magic;\r\n  }\r\n}\r\n\r\nexport async function useAttack(attack, attackProfile, actor) {\r\n\r\n  let title = `${attack.name} - ${game.i18n.localize(\"ABBREW.AttackRoll\")}`;\r\n\r\n  const rollData = getRollData(actor, attack, attackProfile);\r\n\r\n  // HERE: Look at skill rolls in 5e\r\n  // TODO: FUCKER WAS COMING FROM HERE\r\n  rollData.mod = 10;\r\n\r\n  // Compose roll options\r\n  const rollConfig = {\r\n    parts: [attackProfile.abilityModifier, '@attackProfile.damageBase'],\r\n    data: rollData,\r\n    title,\r\n    flavour: title,\r\n    dialogOptions: {\r\n      width: 400,\r\n      top: null,\r\n      left: window.innerWidth - 710\r\n    },\r\n    messageData: {\r\n      \"flags.abbrew.roll\": { type: \"attack\", attack: attack.id, attackProfile: attackProfile.id },\r\n      speaker: ChatMessage.getSpeaker({ actor: actor })\r\n    },\r\n    options: {\r\n      \"damageType\": attackProfile.damageType\r\n    }\r\n  };\r\n\r\n  const roll = await d10Roll(rollConfig);\r\n\r\n  return roll;\r\n}\r\n\r\nfunction getRollData(actor, attack, attackProfile) {\r\n  // If present, return the actor's roll data.\r\n  if (!actor) return null;\r\n  const rollData = actor.getRollData();\r\n  // Grab the item's system data as well.\r\n  rollData.attack = foundry.utils.deepClone(attack);\r\n  rollData.attackProfile = foundry.utils.deepClone(attackProfile);\r\n  rollData.criticalThreshold = getCriticalThreshold(actor, attackProfile);\r\n  rollData.amplification = getAmplification(actor, attackProfile);\r\n  rollData.weakness = getWeakness(actor, attackProfile);\r\n\r\n  return rollData;\r\n}\r\n\r\nfunction getCriticalThreshold(actor, attackProfile) {\r\n  const weaponThreshold = attackProfile.weapon.criticalThreshold;\r\n  const damageType = attackProfile.weapon.damageType;\r\n  const globalThreshold = actor.system.concepts['attack'].criticalThreshold;\r\n  let damageTypeThreshold = 10;\r\n  if (actor.system.concepts[damageType]) {\r\n    damageTypeThreshold = actor.system.concepts[damageType].criticalThreshold;\r\n  }\r\n\r\n  const calculatedThreshold = Math.min(weaponThreshold, globalThreshold, damageTypeThreshold)\r\n\r\n  // ABBREW: Minimum critical threshold is 5.\r\n  return Math.max(calculatedThreshold, 5);\r\n}\r\n\r\nfunction getAmplification(actor, attackProfile) {\r\n  const damageType = attackProfile.weapon.damageType;\r\n  return actor.system.concepts[damageType] ? actor.system.concepts[damageType].amplification : 0;\r\n}\r\n\r\nfunction getWeakness(actor, attackProfile) {\r\n  const damageType = attackProfile.weapon.damageType;\r\n  return actor.system.concepts[damageType] ? actor.system.concepts[damageType].weakness : 0;\r\n}\r\n\r\nasync function oold() {\r\n  let options = {};\r\n\r\n  // Ensure the options object is ready\r\n  options = foundry.utils.mergeObject({\r\n    configureDialog: true,\r\n    createMessage: true,\r\n    // \"flags.abbrew.use\": { type: this.type, itemId: this.id, itemUuid: this.uuid }\r\n  }, options);\r\n\r\n  const card = await displayCard(options, attack, attackProfile, actor);\r\n\r\n  return card;\r\n}\r\n\r\nasync function displayCard(options = {}, attack, attackProfile, actor) {\r\n\r\n  // Render the chat card template\r\n  const token = actor.token;\r\n  const templateData = {\r\n    actor: actor,\r\n    tokenId: token?.uuid || null,\r\n    item: this,\r\n    data: { attack, attackProfile },\r\n    labels: \"\",\r\n    hasAttack: true,\r\n    isHealing: false,\r\n    hasDamage: true,\r\n    isVersatile: false,\r\n    isSpell: false,\r\n    hasSave: false,\r\n    hasAreaTarget: false,\r\n    isTool: false,\r\n    hasAbilityCheck: false\r\n  };\r\n\r\n  // Handle passed data / don't look for item\r\n  const html = await renderTemplate(\"systems/abbrew/templates/chat/attack-card.hbs\", templateData);\r\n\r\n  // Create the ChatMessage data object\r\n  const chatData = {\r\n    user: game.user.id,\r\n    type: CONST.CHAT_MESSAGE_TYPES.OTHER,\r\n    content: html,\r\n    flavor: attack.name,\r\n    speaker: ChatMessage.getSpeaker({ actor: actor, token }),\r\n    flags: { \"core.canPopout\": true }\r\n  };\r\n\r\n  // If the Item was destroyed in the process of displaying its card - embed the item data in the chat message\r\n  //   if ( (this.type === \"consumable\") && !this.actor.items.has(this.id) ) {\r\n  //     chatData.flags[\"abbrew.itemData\"] = templateData.item.toObject();\r\n  //   }\r\n\r\n  // Merge in the flags from options\r\n  chatData.flags = foundry.utils.mergeObject(chatData.flags, options.flags);\r\n\r\n  /**\r\n   * A hook event that fires before an item chat card is created.\r\n   * @function abbrew.preDisplayCard\r\n   * @memberof hookEvents\r\n   * @param {Item5e} item             Item for which the chat card is being displayed.\r\n   * @param {object} chatData         Data used to create the chat message.\r\n   * @param {ItemUseOptions} options  Options which configure the display of the item chat card.\r\n   */\r\n  Hooks.callAll(\"abbrew.preDisplayCard\", this, chatData, options);\r\n\r\n  // Apply the roll mode to adjust message visibility\r\n  // ChatMessage.applyRollMode(chatData, options.rollMode ?? game.settings.get(\"core\", \"rollMode\"));\r\n\r\n  // const options = { createMessage: true };\r\n\r\n  // Create the Chat Message or return its data\r\n  const card = (options.createMessage !== false) ? await ChatMessage.create(chatData) : chatData;\r\n\r\n  /**\r\n   * A hook event that fires after an item chat card is created.\r\n   * @function abbrew.displayCard\r\n   * @memberof hookEvents\r\n   * @param {Item5e} item              Item for which the chat card is being displayed.\r\n   * @param {ChatMessage|object} card  The created ChatMessage instance or ChatMessageData depending on whether\r\n   *                                   options.createMessage was set to `true`.\r\n   */\r\n  Hooks.callAll(\"abbrew.displayCard\", this, card);\r\n\r\n  return card;\r\n}\r\n\r\nexport async function onAttackCardAction(event) {\r\n  event.preventDefault();\r\n\r\n  // Extract card data\r\n  const button = event.currentTarget;\r\n  // Disable Button\r\n  button.disabled = true;\r\n  const card = button.closest(\".chat-card\");\r\n  const messageId = card.closest(\".message\").dataset.messageId;\r\n  const message = game.messages.get(messageId);\r\n  const action = button.dataset.action;\r\n\r\n  // Recover the actor for the chat card\r\n  const actor = await _getChatCardActor(card);\r\n  if (!actor) return;\r\n\r\n  // Validate permission to proceed with the roll\r\n  const isTargetted = action === \"contest\";\r\n  if (!(isTargetted || game.user.isGM || actor.isOwner)) {\r\n    return;\r\n  }\r\n\r\n  // Get the Item from stored flag data or by the item ID on the Actor\r\n  const storedData = message.getFlag(\"abbrew\", \"itemData\");\r\n  const item = storedData ? new this(storedData, { parent: actor }) : actor.attacks.get(card.dataset.itemId);\r\n  if (!item) {\r\n    const err = game.i18n.format(\"ABBREW.ActionWarningNoItem\", { item: card.dataset.itemId, name: actor.name });\r\n    return ui.notifications.error(err);\r\n  }\r\n\r\n  // TODO: Pull this up to the first dialog, we should pop the strong etc. one on\r\n  // clicking the sheet, not here. Give option to accept the damage only\r\n  await item.rollAttack({ event });\r\n\r\n  // Re-enable the button\r\n  button.disabled = false;\r\n}\r\n\r\n/**\r\n* Get the Actor which is the author of a chat card\r\n* @param {HTMLElement} card    The chat card being used\r\n* @returns {Actor|null}        The Actor document or null\r\n* @private\r\n*/\r\nasync function _getChatCardActor(card) {\r\n\r\n  // Case 1 - a synthetic actor from a Token\r\n  if (card.dataset.tokenId) {\r\n    const token = await fromUuid(card.dataset.tokenId);\r\n    if (!token) return null;\r\n    return token.actor;\r\n  }\r\n\r\n  // Case 2 - use Actor ID directory\r\n  const actorId = card.dataset.actorId;\r\n  return game.actors.get(actorId) || null;\r\n}","export class AbbrewRule {\r\n    id;\r\n    label;\r\n    type;\r\n    priority;\r\n    predicate;\r\n    // The property to modify e.g. system.statistics.strength.value\r\n    target;\r\n    source;\r\n    valid;\r\n\r\n    get _type() {\r\n        return this.type;\r\n    }\r\n\r\n    constructor(id, label, type, source, valid) {\r\n        this.type = type;\r\n        this.priority = 100;\r\n        this.id = id;\r\n        this.label = label;\r\n        this.valid = valid;\r\n        this.source = source;\r\n        this.predicate = \"\";\r\n        this.target = \"\";\r\n    }\r\n\r\n    template() { return JSON.stringify(this); };\r\n\r\n    static applyRule(rule, actorData) { return {}; }\r\n\r\n    static validate(candidate) {\r\n        return candidate.hasOwnProperty('type') && candidate.hasOwnProperty('priority') && candidate.hasOwnProperty('predicate') && candidate.hasOwnProperty('target');\r\n    }\r\n}\r\n\r\n","export const ABBREW = {};\r\n\r\n/**\r\n * The set of Ability Scores used within the sytem.\r\n * @type {Object}\r\n */\r\nABBREW.statistics = {\r\n  \"strength\": \"ABBREW.StatisticStrength\",\r\n  \"dexterity\": \"ABBREW.StatisticDexterity\",\r\n  \"constitution\": \"ABBREW.StatisticConstitution\",\r\n  \"agility\": \"ABBREW.StatisticAgility\",\r\n  \"intelligence\": \"ABBREW.StatisticIntelligence\",\r\n  \"will\": \"ABBREW.StatisticWill\",\r\n  \"wits\": \"ABBREW.StatisticWits\",\r\n  \"visualisation\": \"ABBREW.StatisticVisualisation\"\r\n};\r\n\r\nABBREW.StatisticAbbreviations = {\r\n  \"str\": \"ABBREW.StatisticStrengthAbbreviation\",\r\n  \"dex\": \"ABBREW.StatisticDexterityAbbreviation\",\r\n  \"con\": \"ABBREW.StatisticConstitutionAbbreviation\",\r\n  \"agi\": \"ABBREW.StatisticAgilityAbbreviation\",\r\n  \"int\": \"ABBREW.StatisticIntelligenceAbbreviation\",\r\n  \"wll\": \"ABBREW.StatisticWillAbbreviation\",\r\n  \"wts\": \"ABBREW.StatisticWitsAbbreviation\",\r\n  \"wis\": \"ABBREW.StatisticVisualisationAbbreviation\"\r\n};\r\n\r\nABBREW.ActionTypes = {\r\n  \"Damage\": \"damage\"\r\n};\r\n\r\nABBREW.Reach = {\r\n  \"natural\": \"ABBREW.ReachNatural\",\r\n  \"short\": \"ABBREW.ReachShort\",\r\n  \"standard\": \"ABBREW.ReachStandard\",\r\n  \"long\": \"ABBREW.ReachLong\"\r\n}\r\n\r\nABBREW.DamageTypes = {\r\n  \"physical\": \"ABBREW.physical\",\r\n  \"crushing\": \"ABBREW.crushing\",\r\n  \"slashing\": \"ABBREW.slashing\",\r\n  \"piercing\": \"ABBREW.piercing\"\r\n};\r\n\r\nABBREW.DamageProjection = {\r\n  \"arc\": \"ABBREW.Arc\",\r\n  \"thrust\": \"ABBREW.Thrust\"\r\n}\r\n\r\nABBREW.UI = {\r\n  \"RuleElements\": {\r\n    \"Prompt\": {\r\n      \"NoValidOptions\": \"ABBREW.NoValidOptions\",\r\n      \"NoSelectionMade\": \"ABBREW.NoSelectionMade\"\r\n    }\r\n  }\r\n}\r\n\r\nABBREW.RuleTypes = {\r\n  \"ActiveEffect\": \"ABBREW.ActiveEffect\",\r\n  \"ChoiceSet\": \"ABBREW.ChoiceSet\"\r\n}","import { AbbrewRule } from \"./abbrew-rule.mjs\";\r\nimport { ABBREW } from \"../../helpers/config.mjs\";\r\n\r\nexport class AbbrewActiveEffect extends AbbrewRule {\r\n\r\n    operator;\r\n    value;\r\n    requireEquippedItem;\r\n\r\n    static validOperators =\r\n        [\r\n            \"override\",\r\n            \"add\",\r\n            \"minus\",\r\n            \"multiply\",\r\n            \"divide\",\r\n            \"upgrade\",\r\n            \"downgrade\"\r\n        ]\r\n\r\n    constructor(id, label, candidate, source, valid) {\r\n        super(id, label, ABBREW.RuleTypes.ActiveEffect, source, valid);\r\n        if (candidate && typeof candidate == \"object\") {\r\n            candidate && Object.assign(this, candidate);\r\n            return;\r\n        }\r\n        this.operator = \"\";\r\n        this.value = \"\";\r\n        this.requireEquippedItem = false;\r\n    }\r\n\r\n    static validate(candidate) {\r\n        return super.validate(candidate) && candidate.hasOwnProperty('operator') && candidate.hasOwnProperty('value') && this.validOperators.includes(candidate.operator) && !!candidate.value;\r\n    }\r\n\r\n    static getRuleValue(rule, ruleValue, actorData) {\r\n        if (ruleValue[0] == '$') {\r\n            ruleValue = getProperty(actorData.items.get(rule.source.item), ruleValue.substring(1, ruleValue.length));\r\n            return this.getRuleValue(rule, ruleValue, actorData);\r\n        } else if (ruleValue[0] == 'Â£') {\r\n            ruleValue = getProperty(actorData, ruleValue.substring(1, ruleValue.length));\r\n            return this.getRuleValue(rule, ruleValue, actorData);\r\n        } else {\r\n            return ruleValue;\r\n        }\r\n    }\r\n\r\n    static applyRule(rule, actorData) {\r\n        let changes = {};\r\n        let targetElement = rule.targetElement ? actorData.items.get(rule.targetElement) : actorData;\r\n        let targetElementType = rule.targetElement ? \"Item\" : \"Actor\";\r\n        let currentValue = getProperty(targetElement, rule.target)\r\n        if (!currentValue && currentValue != 0) {\r\n            return changes;\r\n        }\r\n\r\n        let targetType = getType(currentValue);\r\n        let ruleValue = this.getRuleValue(rule, rule.value, actorData);\r\n\r\n        let delta = this._castDelta(ruleValue, targetType);\r\n\r\n        let newValue = getProperty(targetElement, rule.target)\r\n        switch (rule.operator) {\r\n            case \"override\":\r\n                newValue = delta;\r\n                break;\r\n            case \"add\":\r\n                newValue = newValue += delta;\r\n                break;\r\n            case \"minus\":\r\n                newValue = newValue -= delta;\r\n                break;\r\n            case \"multiply\":\r\n                newValue = newValue * delta;\r\n                break;\r\n            case \"divide\":\r\n                const divisor = delta !== 0 ? delta : 1;\r\n                newValue = newValue / divisor;\r\n                break;\r\n            case \"upgrade\":\r\n                newValue = newValue < delta ? delta : newValue;\r\n                break;\r\n            case \"downgrade\":\r\n                newValue = newValue > delta ? delta : newValue;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n\r\n        if (currentValue != newValue) {\r\n            const elementChanges = { [rule.target]: newValue, rules: [rule.id] };\r\n            let sourceValue = currentValue;\r\n            if (Object.keys(actorData.ruleOverrides).includes(rule.target)) {\r\n                sourceValue = actorData.ruleOverrides[rule.target].sourceValue;\r\n            }\r\n            changes = { target: rule.target, value: newValue, sourceValue, targetElementType, targetElement: rule.targetElement };\r\n            mergeObject(targetElement, elementChanges);\r\n        }\r\n\r\n        return changes;\r\n    }\r\n\r\n    static _castDelta(raw, type) {\r\n        let delta;\r\n        switch (type) {\r\n            case \"boolean\":\r\n                delta = Boolean(this._parseOrString(raw));\r\n                break;\r\n            case \"number\":\r\n                delta = Number.fromString(raw);\r\n                if (Number.isNaN(delta)) delta = 0;\r\n                break;\r\n            case \"string\":\r\n                delta = String(raw);\r\n                break;\r\n            default:\r\n                delta = this._parseOrString(raw);\r\n        }\r\n        return delta;\r\n    }\r\n\r\n    static _parseOrString(raw) {\r\n        try {\r\n            return JSON.parse(raw);\r\n        } catch (err) {\r\n            return raw;\r\n        }\r\n    }\r\n}","export class ChoiceSetPrompt extends Dialog {\r\n    selection;\r\n    choices;\r\n\r\n    constructor(data = { promptTitle, choices }, options = {}) {\r\n        options.buttons = {};\r\n        data.buttons = {};\r\n        super(data, options);\r\n        this.choices = data.content.choices;\r\n    }\r\n\r\n\r\n    /** @override */\r\n    get template() {\r\n        return \"systems/abbrew/templates/rules/choice-set-prompt.hbs\";\r\n    }\r\n\r\n    /** @override */\r\n    activateListeners($html) {\r\n        const html = $html[0];\r\n\r\n        html.querySelectorAll(\"a[data-choice], button[type=button]\").forEach((element) => {\r\n            element.addEventListener(\"click\", (event) => {\r\n                console.log('clicked');\r\n                // Get the actual selection\r\n                this.selection = event.currentTarget.dataset.id;\r\n                this.close();\r\n            });\r\n        });\r\n    }\r\n\r\n    getData() {\r\n        console.log(\"getData\", this);\r\n        // no super to Application\r\n        const data = super.getData();\r\n\r\n        data.header = this.data.header;\r\n        data.footer = this.data.footer;\r\n\r\n        data.choices = data.content.choices;\r\n        data.promptTitle = data.content.promptTitle;\r\n\r\n        console.log(data);\r\n\r\n        return data;\r\n    }\r\n\r\n    /** Return early if there is only one choice */\r\n    async resolveSelection() {\r\n        // Exit early if there are no valid choices\r\n        if (this.choices.length === 0) {\r\n            await this.close({ force: true });\r\n            return null;\r\n        }\r\n\r\n        const firstChoice = this.choices.at(0);\r\n        if (firstChoice && this.choices.length === 1) {\r\n            return (this.selection = firstChoice[0]);\r\n        }\r\n\r\n        this.render(true);\r\n        return new Promise((resolve) => {\r\n            this.resolve = resolve;\r\n        });\r\n    }\r\n\r\n    /** @override */\r\n    /** Close the dialog, applying the effect with configured target or warning the user that something went wrong. */\r\n    async close({ force = false } = {}) {\r\n        this.element.find(\"button, select\").css({ pointerEvents: \"none\" });\r\n        if (!this.selection) {\r\n            if (force) {\r\n                ui.notifications.warn(\r\n                    game.i18n.format(\"ABBREW.UI.RuleElements.Prompt.NoValidOptions\", {\r\n                        actor: this.actor.name,\r\n                        item: this.item.name,\r\n                    })\r\n                );\r\n            } else if (!this.allowNoSelection) {\r\n                ui.notifications.warn(\r\n                    game.i18n.format(\"ABBREW.UI.RuleElements.Prompt.NoSelectionMade\")\r\n                );\r\n            }\r\n        }\r\n\r\n        this.resolve?.(this.selection);\r\n        await super.close({ force });\r\n    }\r\n}","import { AbbrewRule } from \"./abbrew-rule.mjs\";\r\nimport { ABBREW } from \"../../helpers/config.mjs\";\r\nimport { ChoiceSetPrompt } from \"../choice-set-prompt.mjs\";\r\n\r\nexport class AbbrewChoiceSet extends AbbrewRule {\r\n\r\n    options;\r\n    choice;\r\n\r\n    set target(target) {\r\n        this.target = target;\r\n    }\r\n\r\n    constructor(id, label, candidate, source, valid) {\r\n        super(id, label, ABBREW.RuleTypes.ChoiceSet, source, valid);\r\n        if (candidate && typeof candidate == \"object\") {\r\n            candidate && Object.assign(this, candidate);\r\n            return;\r\n        }\r\n        this.options = [\"weapon\", \"armour\", \"consumable\", \"anatomy\"];\r\n        this.choice = \"\";\r\n    }\r\n\r\n    static validate(candidate) {\r\n        return super.validate(candidate) && candidate.hasOwnProperty('options');\r\n    }\r\n\r\n    static async applyRule(rule, actorData) {\r\n        return {};\r\n    }\r\n\r\n    static async getChoice(rule, actorData) {\r\n        if (rule.choice) {\r\n            return rule.choice;\r\n        }\r\n\r\n        let choices = [];\r\n\r\n        if (rule.options.includes(\"weapon\")) {\r\n            choices = mergeObject(choices, this.getItemWeapons(actorData));\r\n        }\r\n\r\n        if (rule.options.includes(\"armour\")) {\r\n            choices = mergeObject(choices, this.getItemArmour(actorData));\r\n        }\r\n\r\n        if (rule.options.includes(\"consumable\")) {\r\n            choices = mergeObject(choices, this.getItemConsumable(actorData));\r\n        }\r\n\r\n        if (rule.options.includes(\"anatomy\")) {\r\n            choices = mergeObject(choices, this.getItemAnatomy(actorData));\r\n        }\r\n\r\n        const data = { content: { promptTitle: \"Hello\", choices }, buttons: {} };\r\n        const choice = await new ChoiceSetPrompt(data).resolveSelection();\r\n\r\n        let parentItemId = rule.source.item;\r\n        if (!rule.source.actor) {\r\n            parentItemId = actorData.items.map(i => i.system.rules).flat(1).filter(i => i.id == rule.id)[0].source.item;\r\n        }\r\n        const parentItem = actorData.items.get(parentItemId);\r\n        // const duplicateItem = deepClone(parentItem);\r\n        for (let i = 0; i < parentItem.system.rules.length; i++) {\r\n            parentItem.system.rules[i].targetElement = choice;\r\n            if (parentItem.system.rules[i].id == rule.id) {\r\n                parentItem.system.rules[i].choice = choice;\r\n                const ruleContent = parentItem.system.rules[i].content;\r\n                let parsedContent = JSON.parse(ruleContent);\r\n                parsedContent.choice = choice;\r\n                parentItem.system.rules[i].content = JSON.stringify(parsedContent);\r\n            }\r\n        }\r\n        parentItem.update({ system: { rules: parentItem.system.rules } });\r\n        return choice;\r\n    }\r\n\r\n    static getItemWeapons(actorData) {\r\n        return actorData.itemTypes.item.filter(i => i.system.isWeapon).map(i => ({ id: i._id, name: i.name }));\r\n    }\r\n\r\n    static getItemArmour(actorData) {\r\n        return actorData.itemTypes.item.filter(i => i.system.isArmour).map(i => ({ id: i._id, name: i.name }));\r\n    }\r\n\r\n    static getItemConsumable(actorData) {\r\n        return actorData.itemTypes.item.filter(i => i.system.isConsumable).map(i => ({ id: i._id, name: i.name }));\r\n    }\r\n\r\n    static getItemAnatomy(actorData) {\r\n        return actorData.itemTypes.anatomy.map(i => ({ id: i._id, name: i.name }));\r\n    }\r\n}","import { AbbrewActiveEffect } from \"./rules-data/active-effect.mjs\";\r\nimport { AbbrewChoiceSet } from \"./rules-data/choice-set.mjs\";\r\n\r\nexport class AbbrewRuleField {\r\n    id;\r\n    type;\r\n    active;\r\n    label;\r\n    content;\r\n    source;\r\n    options;\r\n    targetElement;\r\n\r\n    constructor({ id, type, label, content, source }) {\r\n        this.id = id;\r\n        this.type = type;\r\n        this.active = true;\r\n        this.label = label;\r\n        this.content = content;\r\n        this.source = source;\r\n        this.options = options;\r\n        this.targetElement = \"\";\r\n    }\r\n}\r\n\r\nexport const options = [\r\n    new AbbrewActiveEffect(),\r\n    new AbbrewChoiceSet()\r\n]\r\n\r\n","export class RuleSource {\r\n    actor;\r\n    item;\r\n    uuid;\r\n\r\n    constructor(uuid) {\r\n        this.uuid = uuid;\r\n        this.actor = \"\";\r\n        this.item = \"\";\r\n        const parts = uuid.split('.');\r\n        for (let i = 0; i < parts.length; i++) {\r\n            if (parts[i] == \"Actor\") {\r\n                this.actor = parts[i + 1]\r\n            }\r\n            if (parts[i] == \"Item\") {\r\n                this.item = parts[i + 1];\r\n            }\r\n        }\r\n    }\r\n}","import { AbbrewRuleField, options } from \"./rule-field.mjs\";\r\nimport { AbbrewActiveEffect } from \"./rules-data/active-effect.mjs\";\r\nimport { AbbrewChoiceSet } from \"./rules-data/choice-set.mjs\";\r\nimport { ABBREW } from \"../helpers/config.mjs\";\r\nimport { AbbrewActor } from \"../documents/actor.mjs\";\r\nimport { AbbrewRule } from \"./rules-data/abbrew-rule.mjs\";\r\nimport { RuleSource } from \"./rule-source.mjs\";\r\n\r\n/**\r\n * Manage Rule instances through the Item Sheet via rule control buttons.\r\n * @param {MouseEvent} event      The left-click event on the rule control\r\n * @param {Item} item      The owning document which manages this rule\r\n */\r\nexport async function onManageRule(event, item) {\r\n    event.preventDefault();\r\n    const a = event.currentTarget;\r\n    const li = a.closest(\"li\");\r\n    const ruleId = li.dataset.ruleId;\r\n    let rules = foundry.utils.deepClone(item.system.rules);\r\n    switch (a.dataset.action) {\r\n        case \"create\":\r\n            const id = uuid();\r\n            rules = [new AbbrewRuleField({ id, type: 0, label: \"New Rule\", content: options[0].template(), source: new RuleSource(item.uuid) }),\r\n            ...rules,];\r\n            break;\r\n        case \"delete\":\r\n            rules = rules.filter(r => r.id != ruleId);\r\n            break;\r\n    }\r\n\r\n    return await item.update({\r\n        \"system.rules\": rules\r\n    });\r\n}\r\n\r\n/**\r\n * Provide UUID for rule instances\r\n * @returns UUID\r\n */\r\nfunction uuid() {\r\n    return Date.now().toString(36) + Math.random().toString(36).substr(2);\r\n}\r\n\r\n/**\r\n * Prepare rules for the given actor from their items.\r\n * @param {AbbrewActor} actor \r\n */\r\nexport async function prepareRules(actor) {\r\n    const rules = actor.items._source.map(i => i.system.rules).flat(1);\r\n    const validRules = [];\r\n    const sourceTargets = [];\r\n    for (let i = 0; i < rules.length; i++) {\r\n        const rule = rules[i];\r\n        if (!rule.active) {\r\n            continue;\r\n        }\r\n        if (sourceTargets[rule.source.uuid]) {\r\n            rule.targetElement = sourceTargets[rule.source.uuid];\r\n        }\r\n        const parsedRule = JSON.parse(rule.content);\r\n        let typedRule = {};\r\n        let valid = false;\r\n        switch (parsedRule.type) {\r\n            case ABBREW.RuleTypes.ActiveEffect:\r\n                console.log('Active Effect');\r\n                valid = AbbrewActiveEffect.validate(parsedRule);\r\n                typedRule = new AbbrewActiveEffect(rule.id, rule.label, parsedRule, rule.source, valid);\r\n                typedRule.targetElement = rule.targetElement;                \r\n                if(!actor.items.get(typedRule.source.item)) {\r\n                    break;\r\n                }\r\n                const equipState = actor.items.get(typedRule.source.item).system.equipState;\r\n                if ((typedRule.requireEquippedItem && (equipState.worn || equipState.wielded)) || (!typedRule.requireEquippedItem)) {\r\n                    validRules.push(typedRule);\r\n                }\r\n                break;\r\n            case ABBREW.RuleTypes.ChoiceSet:\r\n                console.log('Choice Set');\r\n                valid = AbbrewChoiceSet.validate(parsedRule);\r\n                typedRule = new AbbrewChoiceSet(rule.id, rule.label, parsedRule, rule.source, valid);\r\n                const choice = await AbbrewChoiceSet.getChoice(typedRule, actor);\r\n                sourceTargets[rule.source.uuid] = choice;\r\n                typedRule.targetElement = choice;\r\n                typedRule.choice = choice;\r\n                validRules.push(typedRule);\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    await actor.update({ \"system.rules\": validRules });\r\n}\r\n\r\n/**\r\n * Apply a rule to a given actor.\r\n * @param {AbbrewRule} rule \r\n * @param {AbbrewActor} actorData \r\n * @returns changes element.\r\n */\r\nexport function applyRule(rule, actorData) {\r\n    let changes = {};\r\n    switch (rule.type) {\r\n        case ABBREW.RuleTypes.ActiveEffect:\r\n            changes = AbbrewActiveEffect.applyRule(rule, actorData);\r\n            break;\r\n        case ABBREW.RuleTypes.ChoiceSet:\r\n            changes = AbbrewChoiceSet.applyRule(rule, actorData);\r\n            break;\r\n        default:\r\n            break;\r\n    }\r\n\r\n    return changes;\r\n}\r\n","export function writeToPath(element, path, value) {    \r\n    let pathWrite = [];\r\n    pathWrite[path] = value;\r\n    let keyed = expandObject(pathWrite);\r\n    element.update(keyed);\r\n}","import { AbbrewAttackProfile } from \"./attackprofile.mjs\";\r\nimport { prepareRules, applyRule } from \"../rules/rules.mjs\";\r\nimport { writeToPath } from \"../helpers/write-to-path.mjs\";\r\nimport { ChoiceSetPrompt } from \"../rules/choice-set-prompt.mjs\";\r\n\r\n/**\r\n * Extend the base Actor document by defining a custom roll data structure which is ideal for the Simple system.\r\n * @extends {Actor}\r\n */\r\nexport class AbbrewActor extends Actor {\r\n  ruleOverrides;\r\n\r\n  /** @override */\r\n  prepareData() {\r\n    // Prepare data for the actor. Calling the super version of this executes\r\n    // the following, in order: data reset (to clear active effects),\r\n    // prepareBaseData(), prepareEmbeddedDocuments() (including active effects),\r\n    // prepareDerivedData().\r\n    super.prepareData();\r\n  }\r\n\r\n  /** @override */\r\n  prepareBaseData() {\r\n    // Data modifications in this step occur before processing embedded\r\n    // documents or derived data.\r\n    // console.log('is it before?');\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   * Augment the basic actor data with additional dynamic data. Typically,\r\n   * you'll want to handle most of your calculated/derived data in this step.\r\n   * Data calculated in this step should generally not exist in template.json\r\n   * (such as ability modifiers rather than ability scores) and should be\r\n   * available both inside and outside of character sheets (such as if an actor\r\n   * is queried and has a roll executed directly from it).\r\n   */\r\n  prepareDerivedData() {\r\n    const actorData = this;\r\n    const systemData = actorData.system;\r\n    const flags = actorData.flags.abbrew || {};\r\n\r\n    // Make separate methods for each Actor type (character, npc, etc.) to keep\r\n    // things organized.\r\n    this._prepareCharacterData(actorData);\r\n    this._prepareNpcData(actorData);\r\n  }\r\n\r\n  /**\r\n   * Prepare Character type specific data\r\n   */\r\n  _prepareCharacterData(actorData) {\r\n    if (actorData.type !== 'character') return;\r\n\r\n    // Make modifications to data here. For example:\r\n    const systemData = actorData.system;\r\n    // super.applyActiveEffects()\r\n    // Prepare\r\n    // TODO: Allow for rules to specify when to be run? We won't have access to e.g. modifiers\r\n    this._processRules(this);\r\n    this._prepareAbilityModifiers(systemData);\r\n    this._prepareAnatomy(systemData);\r\n    this._prepareMovement(systemData);\r\n    this._prepareDefences(systemData);\r\n    this._prepareArmour(systemData);\r\n    this._preparePower(systemData);\r\n    this._prepareActions(systemData);\r\n    this._prepareFeatures(systemData);\r\n  }\r\n\r\n  async _updateObject(event, formData) {\r\n    console.log('here');\r\n    // call super with revert to rawActor merged with actual changes?\r\n    await super._updateObject(event, formData);\r\n  }\r\n\r\n  _onUpdate(data, options, userId) {\r\n    super._onUpdate(data, options, userId);\r\n\r\n  }\r\n\r\n  async _preUpdate(changed, options, user) {\r\n\r\n    if (this.ruleOverrides) {\r\n      let flatChanges = flattenObject(changed, 1);\r\n      let flatChangesArray = Object.keys(flatChanges).map((key) => [key, flatChanges[key]]);\r\n      const overrideKeys = Object.keys(this.ruleOverrides);\r\n      flatChangesArray.forEach(c => {\r\n        if (overrideKeys.includes(c[0]) && this.ruleOverrides[c[0]].overrideValue == c[1]) {\r\n          const path = c[0];\r\n          let keys = path.split('.');\r\n          let prop = keys.pop();\r\n          let parent = keys.reduce((obj, key) => obj[key], changed);\r\n          delete parent[prop];\r\n        }\r\n      })\r\n    }\r\n\r\n    super._preUpdate(changed, options, user);\r\n  }\r\n\r\n\r\n  _onUpdateEmbeddedDocuments(embeddedName, documents, result, options, userId) {\r\n    console.log(`Update Object: ${embeddedName}`);\r\n    super._onUpdateEmbeddedDocuments(embeddedName, documents, result, options, userId);\r\n  }\r\n\r\n  _processRules(actorData) {\r\n    this.prepareItems(this);\r\n    this.resetItems(this);\r\n    prepareRules(this);\r\n    if (actorData.system.rules.length == 0) {\r\n      this.ruleOverrides = [];\r\n      return;\r\n    }\r\n\r\n    let changes = [];\r\n    this.ruleOverrides = [];\r\n    actorData.ruleOverrides = [];\r\n    actorData.system.rules\r\n      .filter(\r\n        r => r.valid\r\n      ).sort((r1, r2) => r2.priority - r1.priority)\r\n      .forEach(r => {\r\n        const ruleChange = applyRule(r, actorData);\r\n        if (Object.keys(ruleChange).length == 0) {\r\n          return;\r\n        }\r\n        changes[ruleChange.target] = {\r\n          overrideValue: ruleChange.value,\r\n          sourceValue: ruleChange.sourceValue,\r\n          targetType: ruleChange.targetType,\r\n          targetElement: ruleChange.targetElement\r\n        };\r\n        actorData.ruleOverrides[ruleChange.target] = changes[ruleChange.target];\r\n      });\r\n\r\n    this.ruleOverrides = changes;\r\n  }\r\n\r\n  /**\r\n   * Reset item overridden fields to pre-rule values.\r\n   * @param {AbbrewActor} actorData    \r\n   */\r\n  prepareItems(actorData) {\r\n    actorData.items.filter(i => i.system.rules.length > 0).forEach(i => {\r\n      i.system.rules.forEach(r => {\r\n        if (r.source.actor && r.source.item) {\r\n          return;\r\n        }\r\n        r.source.actor = this.id;\r\n        r.source.item = i.id;\r\n        r.source.uuid = `Actor.${this.id}.Item.${i.id}`;\r\n      });\r\n      const item = actorData.items.get(i.id);\r\n      writeToPath(item, 'system.rules', i.system.rules)\r\n    });\r\n  }\r\n\r\n  resetItems(actorData) {\r\n    if (!actorData.ruleOverrides) {\r\n      return;\r\n    }\r\n    for (const [key, override] of Object.entries(actorData.ruleOverrides)) {\r\n      if (override.targetType == \"Item\") {\r\n        const item = actorData.items.get(override.targetElement);\r\n        const path = key;\r\n        let keys = path.split('.');\r\n        let itemValue = keys.reduce((obj, key) => obj[key], item);\r\n        if (itemValue == override.overrideValue) {\r\n          writeToPath(item, path, override.sourceValue);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  createEmbeddedDocuments(data, context) {\r\n    console.log('createEmbeddedDocuments');\r\n    super.createEmbeddedDocuments(data, context);\r\n  }\r\n\r\n  async _onCreateEmbeddedDocuments(embeddedName, ...args) {\r\n    console.log('_onCreateEmbeddedDocuments');\r\n    args[0].forEach(\r\n      data => {\r\n        data.system.rules.forEach(\r\n          rule =>\r\n            rule.source = {\r\n              actor: this.id,\r\n              item: data._id,\r\n              uuid: \"Actor.\" + this.id + \".Item.\" + data._id\r\n            }\r\n        );\r\n        this.items.get(data._id).update({ 'system.rules': data.system.rules });\r\n      }\r\n    )\r\n    await super._onCreateEmbeddedDocuments(embeddedName, ...args);\r\n  }\r\n\r\n  _onDeleteEmbeddedDocuments(embeddedName, ...args) {\r\n    console.log('delete item');\r\n    const armourEquipped = this.itemTypes.item.filter(i => i.system.isArmour && i.system.armour.equippedTo === args[1][0]);\r\n    if (armourEquipped.length > 0) {\r\n      armourEquipped.forEach(i => i.update(\r\n        {\r\n          system: {\r\n            equipState: {\r\n              worn: false\r\n            },\r\n            armour: {\r\n              equippedTo: \"\"\r\n            }\r\n          }\r\n        }\r\n      ))\r\n    }\r\n    super._onDeleteEmbeddedDocuments(embeddedName, ...args);\r\n  }\r\n\r\n  async _updateDocuments(documentClass, { updates, options, pack }, user) {\r\n    console.log('update-documents');\r\n    super._updateDocuments(documentClass, { updates, options, pack }, user);\r\n  }\r\n\r\n  _prepareAnatomy(systemData) {\r\n    this.itemTypes.anatomy.forEach(\r\n      a => {\r\n        const tags = a.system.tags.replace(' ', '').split(',');\r\n        a.system.tagsArray = tags;\r\n        const armourPoints = a.system.armourPoints.replace(' ', '').split(',');\r\n        a.system.armourPointsArray = armourPoints;\r\n      }\r\n    );\r\n    systemData.anatomy = this.itemTypes.anatomy;\r\n  }\r\n\r\n  _prepareDefences(systemData) {\r\n    const defences = Object.fromEntries(Object.entries(this.itemTypes.defence).map(([k, v]) => [v.name, v.system]));\r\n    systemData.defences = { ...systemData.defences, ...defences };\r\n  }\r\n\r\n  _prepareFeatures(systemData) {\r\n    const weapons = this._getWeapons();\r\n    const attacks = weapons.map(w => this._prepareWeaponAttack(w, systemData));\r\n    systemData.attacks = attacks.flat();\r\n  }\r\n\r\n  _getWeapons() {\r\n    return this._getItemWeapons().map(i => ({ \"name\": i.name, \"img\": i.img, \"weaponId\": i._id, \"weight\": i.system.weight, \"concepts\": i.system.concepts, \"material\": i.system.material, \"equipState\": i.system.equipState, ...i.system.weapon }));\r\n  }\r\n\r\n  _getItemWeapons() {\r\n    return this.itemTypes.item.filter(i => i.system.isWeapon);\r\n  }\r\n\r\n  _prepareWeaponAttack(weapon) {\r\n    const results = weapon.weaponProfiles.split(',').map((wp, index) => {\r\n      const profileParts = wp.split('-');\r\n      const damageType = profileParts[0].replace(' ', '');\r\n      const attackType = profileParts[1];\r\n      // TODO: Handle Penalty here, check requirements are met.\r\n      const requirements = { strength: { value: 5 } }; // JSON.parse(weapon.requirements);\r\n      let damageBase = 0;\r\n      switch (profileParts[1]) {\r\n        case \"arc\":\r\n          damageBase = + weapon.material.structure + (requirements.strength.value * (1 + weapon.minimumEffectiveReach)) + (weapon.material.tier * 5);\r\n          break;\r\n        case \"thrust\":\r\n          damageBase = + weapon.material.structure + (weapon.material.tier * 5);\r\n          weapon.penetration = weapon.material.tier * 5;\r\n          break;\r\n        default:\r\n          return;\r\n      }\r\n\r\n      return new AbbrewAttackProfile(\r\n        index,\r\n        \"@system.statistics.strength.mod\",\r\n        damageBase,\r\n        true,\r\n        {\r\n          requirements: weapon.requirements,\r\n          reach: weapon.reach,\r\n          minimumEffectiveReach: weapon.minimumEffectiveReach,\r\n          focused: weapon.focused,\r\n          penetration: weapon.penetration,\r\n          traits: weapon.traits,\r\n          handsSupplied: weapon.handsSupplied,\r\n          handsRequired: weapon.handsRequired,\r\n          traitsArray: weapon.traitsArray,\r\n          criticalThreshold: weapon.criticalThreshold,\r\n          damageType: damageType,\r\n          attackType: attackType\r\n        },\r\n        false,\r\n        {}\r\n      );\r\n    });\r\n\r\n    return {\r\n      id: weapon.weaponId,\r\n      name: weapon.name,\r\n      image: weapon.img || \"icons/svg/sword.svg\",\r\n      isWeapon: true,\r\n      isEquipped: weapon.equipState.wielded,\r\n      profiles: results\r\n    }\r\n  };\r\n\r\n  async equipWeapon(id, equip) {\r\n    const updates = [];\r\n    updates.push({ _id: id, system: { equipState: { wielded: equip } } });\r\n    await this.updateEmbeddedDocuments(\"Item\", updates);\r\n  };\r\n\r\n  async equipArmour(id, equip) {\r\n    const updates = [];\r\n\r\n    const armourPiece = this.items.get(id);\r\n    const skillCost = this.getSkillCost(armourPiece);\r\n\r\n    let equipTo = \"\";\r\n    if (equip && this.validSkillCost(skillCost)) {\r\n      equipTo = await this.checkArmourForm(armourPiece);\r\n    }\r\n\r\n    if (equip && !equipTo) {\r\n      return;\r\n    }\r\n\r\n    updates.push({ _id: id, system: { equipState: { worn: equip }, armour: { equippedTo: equipTo } } });\r\n    await this.updateEmbeddedDocuments(\"Item\", updates);\r\n  }\r\n\r\n  async checkArmourForm(armourPiece) {\r\n    if (+armourPiece.system.armour.size != this.system.size) {\r\n      return false;\r\n    }\r\n    const formParts = this.itemTypes.anatomy.filter(a => JSON.parse(a.system.tags).map(t => t.value).includes(JSON.parse(armourPiece.system.armour.form)[0].value));\r\n    const anatomyParts = formParts.filter(a => JSON.parse(a.system.tags).map(t => t.value).includes(JSON.parse(armourPiece.system.armour.anatomy)[0].value));\r\n    if (anatomyParts.length == 0) {\r\n      return false;\r\n    }\r\n    const candidateAnatomyIds = anatomyParts.map(a => a.id);\r\n    const conflictingPieceCandidates = this.itemTypes.item.filter(i => i.system.isArmour).filter(a => a.system.equipState.worn && candidateAnatomyIds.includes(a.system.armour.equippedTo));\r\n    const conflictingPieces = conflictingPieceCandidates.filter(a =>\r\n      ((a.system.armour.layers.base.covers || a.system.armour.layers.base.blocks) && (armourPiece.system.armour.layers.base.covers || armourPiece.system.armour.layers.base.blocks)) ||\r\n      ((a.system.armour.layers.mid.covers || a.system.armour.layers.mid.blocks) && (armourPiece.system.armour.layers.mid.covers || armourPiece.system.armour.layers.mid.blocks)) ||\r\n      ((a.system.armour.layers.outer.covers || a.system.armour.layers.outer.blocks) && (armourPiece.system.armour.layers.outer.covers || armourPiece.system.armour.layers.outer.blocks))\r\n    );\r\n    const conflictAnatomyIds = conflictingPieces.map(a => a.system.armour.equippedTo);\r\n    const choices = candidateAnatomyIds.filter(i => !conflictAnatomyIds.includes(i)).map(i => this.items.get(i)).map(i => ({ id: i._id, name: i.name }));\r\n\r\n    if (choices.length == 0) {\r\n      return \"\";\r\n    }\r\n    if (choices.length > 1) {\r\n      const data = { content: { promptTitle: \"Equip Where?\", choices }, buttons: {} };\r\n      const choice = await new ChoiceSetPrompt(data).resolveSelection();\r\n      return choice;\r\n    }\r\n    return choices[0].id;\r\n  }\r\n\r\n  getSkillCost(armourPiece) {\r\n    const mid = armourPiece.system.armour.layers.mid.covers ? 1 : 0;\r\n    const outer = armourPiece.system.armour.layers.outer.covers ? 2 : 0;\r\n    return mid + outer;\r\n  }\r\n\r\n  validSkillCost(skillCost) {\r\n    const usedSkill = this.itemTypes.item.filter(i => i.system.isArmour && i.system.equipState.worn).map(i => this.getSkillCost(i)).reduce((a, b) => a + b, 0);\r\n    return usedSkill + skillCost <= this.system.armour.skill;\r\n  }\r\n\r\n  _prepareAbilityModifiers(systemData) {\r\n    // Loop through ability scores, and add their modifiers to our sheet output.\r\n    for (let [key, ability] of Object.entries(systemData.statistics)) {\r\n      // Calculate the modifier using abbrew rules.\r\n      ability.mod = Math.floor(ability.value / 2);\r\n    }\r\n  }\r\n\r\n  _prepareMovement(systemData) {\r\n    const base = systemData.statistics.agility.mod;\r\n    const limbs = systemData.anatomy.filter(a => JSON.parse(a.system.tags).map(t => t.value).includes('Agility')).length;\r\n    systemData.movement.base = base * limbs;\r\n  }\r\n\r\n  _prepareArmour(systemData) {\r\n    systemData.armours = this.itemTypes.item.filter(a => a.system.isArmour);\r\n  }\r\n\r\n  _preparePower(systemData) {\r\n    const result = this._sumValues(systemData);\r\n    systemData.attributes.power.value = result;\r\n  }\r\n\r\n  _prepareActions(systemData) {\r\n    const actions = 3;\r\n    systemData.actions = { current: actions, maximum: actions };\r\n  }\r\n\r\n  // TODO: Generalise or change\r\n  _sumValues(systemData) {\r\n    return Object.values(systemData.statistics).reduce(function (sum, ability) {\r\n      return sum += ability.value;\r\n    }, 0);\r\n  }\r\n\r\n  /**\r\n   * Prepare NPC type specific data.\r\n   */\r\n  _prepareNpcData(actorData) {\r\n    if (actorData.type !== 'npc') return;\r\n\r\n    // Make modifications to data here. For example:\r\n    const systemData = actorData.system;\r\n    systemData.xp = (systemData.cr * systemData.cr) * 100;\r\n  }\r\n\r\n  /**\r\n   * Override getRollData() that's supplied to rolls.\r\n   */\r\n  getRollData() {\r\n    const data = super.getRollData();\r\n\r\n    // Prepare character roll data.\r\n    this._getCharacterRollData(data);\r\n    this._getNpcRollData(data);\r\n\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * Prepare character roll data.\r\n   */\r\n  _getCharacterRollData(data) {\r\n    if (this.type !== 'character') return;\r\n\r\n    // Copy the ability scores to the top level, so that rolls can use\r\n    // formulas like `@str.mod + 4`.\r\n    if (data.statistics) {\r\n      for (let [k, v] of Object.entries(data.statistics)) {\r\n        data[k] = foundry.utils.deepClone(v);\r\n      }\r\n    }\r\n\r\n    // Add level for easier access, or fall back to 0.\r\n    if (data.attributes.level) {\r\n      data.lvl = data.attributes.level.value ?? 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Prepare NPC roll data.\r\n   */\r\n  _getNpcRollData(data) {\r\n    if (this.type !== 'npc') return;\r\n\r\n    // Process additional NPC data here.\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n  /*  Chat Message Helpers                        */\r\n  /* -------------------------------------------- */\r\n\r\n  /**\r\n   * Apply listeners to chat messages.\r\n   * @param {HTML} html  Rendered chat message.\r\n   */\r\n  static chatListeners(html) {\r\n    html.on('click', '.damage-application button', this.onDamageAccept.bind(this));\r\n  }\r\n\r\n  /* async */static onDamageAccept(event) {\r\n    console.log(event);\r\n    // Extract card data\r\n    const button = event.currentTarget;\r\n    const card = button.closest(\".chat-message\");\r\n    const messageId = card.closest(\".message\").dataset.messageId;\r\n    const message = game.messages.get(messageId);\r\n    const tokens = canvas.tokens.controlled.filter((token) => token.actor);\r\n    /* await */ tokens[0].actor.acceptDamage(message.rolls, message.flags.data);\r\n  }\r\n\r\n\r\n  toRadians(angle) {\r\n    return angle * (Math.PI / 180);\r\n  }\r\n\r\n  dot(a, b) {\r\n    return a.map((x, i) => a[i] * b[i]).reduce((m, n) => m + n);\r\n  }\r\n\r\n  normalize(vector) {\r\n    var length = Math.sqrt(vector.x * vector.x + vector.y * vector.y); //calculating length\r\n    vector.x = vector.x / length; //assigning new value to x (dividing x by length of the vector)\r\n    vector.y = vector.y / length; //assigning new value to y\r\n    return vector;\r\n  };\r\n\r\n  convertFoundryAngle(angle) {\r\n    const angleDiff = angle - 270;\r\n    return angleDiff > 0 ? 360 - angleDiff : Math.abs(angleDiff);\r\n  }\r\n\r\n  getTokenAngle(token) {\r\n    return this.toRadians(this.convertFoundryAngle(token.document.rotation));\r\n  }\r\n\r\n  getTokenNormal(token) {\r\n    return this.getTokenRotationAdjusted(token, 90);\r\n  }\r\n\r\n  getTokenRotationAdjusted(token, rotation) {\r\n    const tokenAngle = token.document.rotation;\r\n    const tokenModifiedAngleCandidate = tokenAngle + rotation;\r\n    const tokenModifiedAngle = tokenModifiedAngleCandidate >= 360 ? 360 - tokenModifiedAngleCandidate : tokenModifiedAngleCandidate;\r\n    return this.toRadians(this.convertFoundryAngle(tokenModifiedAngle));\r\n  }\r\n\r\n  getTokenVectorFacing(token) {\r\n    const tokenAngle = this.getTokenAngle(token);\r\n    return this.getVectorFromAngle(tokenAngle);\r\n  }\r\n\r\n  getTokenVectorNormal(token) {\r\n    const tokenRightFaceAngle = this.getTokenNormal(token);\r\n    return this.getVectorFromAngle(tokenRightFaceAngle);\r\n  }\r\n\r\n  getTokenVectorAdjusted(token, rotation) {\r\n    const tokenAdjustedAngle = this.getTokenRotationAdjusted(token, rotation);\r\n    return this.getVectorFromAngle(tokenAdjustedAngle);\r\n  }\r\n\r\n  getVectorFromAngle(angle) {\r\n    const vector = { x: Math.cos(angle), y: Math.sin(angle) };\r\n    const normalisedVector = this.normalize(vector);\r\n    return Object.values(normalisedVector);\r\n  }\r\n\r\n  getVectorToFace(token, targetToken) {\r\n    const vectorToFace = { x: targetToken.center.x - token.center.x, y: token.center.y - targetToken.center.y };\r\n    const normalisedVector = this.normalize(vectorToFace);\r\n    return Object.values(normalisedVector);\r\n  }\r\n\r\n  getVectorToFacePoint(token, point) {\r\n    const vectorToFace = { x: point[0] - token.center.x, y: token.center.y - point[1] };\r\n    const normalisedVector = this.normalize(vectorToFace);\r\n    return Object.values(normalisedVector);\r\n  }\r\n\r\n  dot(vectorA, vectorB) {\r\n    return vectorA.map((x, i) => vectorA[i] * vectorB[i]).reduce((m, n) => m + n);\r\n  }\r\n\r\n  boundedAddition = function (i, j, min, max) {\r\n    if (isNaN(min)) min = -Infinity;\r\n    if (isNaN(max)) max = Infinity;\r\n    var res = i + j;\r\n    return res < min ? min : res > max ? max : res;\r\n  };\r\n\r\n  getQuadrant(tokenOtherVector, tokenSecondOtherVector, vectorToFace) {\r\n    const bound = 0.7\r\n    const minBound = - bound;\r\n    const maxBound = bound;\r\n    const otherMeasure = this.dot(tokenOtherVector, vectorToFace);\r\n    const secondOtherMeasure = this.dot(tokenSecondOtherVector, vectorToFace);\r\n    const roundedOtherMeasure = Math.round(otherMeasure * 100000) / 100000;\r\n    const diag1 = roundedOtherMeasure < minBound ? { front: 1, right: 1 } : roundedOtherMeasure > maxBound ? { front: -1, right: -1 } : { front: 0, right: 0 };\r\n    const roundedSecond = Math.round(secondOtherMeasure * 100000) / 100000;\r\n    const diag2 = roundedSecond < minBound ? { front: -1, right: 1 } : roundedSecond > maxBound ? { front: 1, right: -1 } : { front: 0, right: 0 };\r\n\r\n    const result = { front: this.boundedAddition(diag1.front, diag2.front, -1, 1), right: this.boundedAddition(diag1.right, diag2.right, -1, 1) };\r\n    return result;\r\n  }\r\n\r\n  getDistanceBetweenTokens(token, targetToken) {\r\n    const grid = canvas.grid;\r\n    const ttRect = targetToken.bounds;\r\n    const atRect = token.bounds;\r\n    const ttPos = { x: targetToken.center.x, y: targetToken.center.y };\r\n    const atPos = { x: token.center.x, y: token.center.y };\r\n    if (ttRect.width > grid.size) {\r\n      if (ttRect.right < atRect.left) {\r\n        ttPos.x = ttRect.right - grid.size / 2;\r\n      } else if (ttRect.left > atRect.right) {\r\n        ttPos.x = ttRect.left + grid.size / 2;\r\n      } else {\r\n        ttPos.x = atPos.x;\r\n      }\r\n    }\r\n    if (ttRect.height > grid.size) {\r\n      if (ttRect.bottom < atRect.top) {\r\n        ttPos.y = ttRect.bottom - grid.size / 2;\r\n      } else if (ttRect.top > atRect.bottom) {\r\n        ttPos.y = ttRect.top + grid.size / 2;\r\n      } else {\r\n        ttPos.y = atPos.y;\r\n      }\r\n    }\r\n    if (atRect.width > grid.size) {\r\n      if (atRect.right < ttRect.left) {\r\n        atPos.x = atRect.right - grid.size / 2;\r\n      } else if (atRect.left > ttRect.right) {\r\n        atPos.x = atRect.left + grid.size / 2;\r\n      } else {\r\n        atPos.x = ttPos.x;\r\n      }\r\n    }\r\n    if (atRect.height > grid.size) {\r\n      if (atRect.bottom < ttRect.top) {\r\n        atPos.y = atRect.bottom - grid.size / 2;\r\n      } else if (atRect.top > ttRect.bottom) {\r\n        atPos.y = atRect.top + grid.size / 2;\r\n      } else {\r\n        atPos.y = ttPos.y;\r\n      }\r\n    }\r\n    return grid.measureDistance(ttPos, atPos, { gridSpaces: true });\r\n  };\r\n\r\n  getUnobservedPenalty() {\r\n    const placeables = game.canvas.tokens.placeables;\r\n    const token = placeables.filter(p => p.document.actorId == this.id && p.controlled)[0];\r\n    const nonAllyTokens = placeables.filter(p => p.document.disposition != token.document.disposition);\r\n\r\n    // Grid Size = 100px x 100px\r\n    // Magnitude for Size 1 = ~141\r\n    // tokens should be NxN in scale, height == width\r\n    const tokenDiagonalMagnitude = 70 * token.document.height;\r\n    const tokenRearRightPoint = [(token.center.x + this.getTokenVectorAdjusted(token, 135)[0] * tokenDiagonalMagnitude), (token.center.y - this.getTokenVectorAdjusted(token, 135)[1] * tokenDiagonalMagnitude)];\r\n    const tokenFrontLeftPoint = [(token.center.x + this.getTokenVectorAdjusted(token, 315)[0] * tokenDiagonalMagnitude), (token.center.y - this.getTokenVectorAdjusted(token, 315)[1] * tokenDiagonalMagnitude)];\r\n\r\n    const tokenFrontRightVector = this.getTokenVectorAdjusted(token, 45);\r\n    const tokenRearRightVector = this.getTokenVectorAdjusted(token, 135);\r\n\r\n    const penalties = nonAllyTokens.map(enemyToken => {\r\n\r\n      const vectorToFace = this.getVectorToFace(enemyToken, token);\r\n      const enemyTokenVector = this.getTokenVectorFacing(enemyToken);\r\n\r\n      const distance = this.getDistanceBetweenTokens(enemyToken, token);\r\n      const enemyReaches = enemyToken.actor.itemTypes.item.filter(i => i.system.isWeapon && i.system.equipState.wielded).map(i => i.system.weapon.reach);\r\n      const enemyReach = Math.max(...enemyReaches);\r\n      const threateningReach = Math.floor(enemyToken.actor.system.size * (1 + enemyReach));\r\n\r\n      if (threateningReach < distance) {\r\n        // console.log('threatenedDistance ' + threateningReach + ' was not enough to reach target at distance ' + distance);\r\n        return 0;\r\n      }\r\n\r\n      if (this.dot(vectorToFace, enemyTokenVector) > 0.7) {\r\n        const vectorToFaceRearRight = this.getVectorToFacePoint(enemyToken, tokenRearRightPoint);\r\n        const vectorToFaceFrontLeft = this.getVectorToFacePoint(enemyToken, tokenFrontLeftPoint);\r\n\r\n        const rearRightResult = this.getQuadrant(tokenFrontRightVector, tokenRearRightVector, vectorToFaceRearRight);\r\n        const frontLeftResult = this.getQuadrant(tokenFrontRightVector, tokenRearRightVector, vectorToFaceFrontLeft);\r\n        const result = { front: this.boundedAddition(rearRightResult.front, frontLeftResult.front, -1, 1), right: this.boundedAddition(rearRightResult.right, frontLeftResult.right, -1, 1) };\r\n        const frontRear = result.front > 0 ? 'Front' : result.front < 0 ? 'Rear' : 'Mid';\r\n        const rightLeft = result.right > 0 ? 'Right' : result.right < 0 ? 'Left' : 'Mid';\r\n        console.log('diagonals: ' + frontRear + ' ' + rightLeft);\r\n        const penalty = token.actor.system.conditions[\"observationPenalty\" + frontRear + rightLeft];\r\n        return penalty;\r\n      }\r\n\r\n      return 0;\r\n    });\r\n\r\n    const totalPenalty = penalties.map(p => p < 0 ? 0 : p).reduce((a, b) => a + b);\r\n    return totalPenalty;\r\n  }\r\n\r\n  // Directly Down is 0, Left is 90, Up 180, Right 270\r\n  /* async */ acceptDamage(damageRolls, attackData) {\r\n    let actor = this;\r\n    let systemData = this.system;\r\n    let damage = damageRolls[0]._total;\r\n    let damageRoll = damageRolls[0];\r\n    let damagePenetrate = attackData.attackProfile.weapon.penetration;\r\n    // const modRoll = damageRolls[0];\r\n    // modRoll.terms[0].rolls[0].terms[0].results[0] = {active: true, result: 1};\r\n    // const newRoll = await CONFIG.Dice.AbbrewRoll.fromRoll(modRoll);\r\n    const unobservedPenalty = this.getUnobservedPenalty();\r\n\r\n    let currentArmour = systemData.armour.value;\r\n    let newArmour = currentArmour;\r\n\r\n    const damageType = attackData.attackProfile.weapon.damageType;\r\n\r\n    if (!systemData.defences[damageType]) {\r\n      const untypedCritical = this.getCriticalExplosions(damageRoll, 0, 0)\r\n      this.handleDamage(systemData, damage, \"untyped\", untypedCritical);\r\n    }\r\n\r\n    const damageTypeDefence = systemData.defences[damageType];\r\n\r\n    if (damageTypeDefence.absorb) {\r\n      this.absorbDamage(actor, systemData, damage);\r\n      return;\r\n    }\r\n    if (damageTypeDefence.immune) {\r\n      return;\r\n    }\r\n\r\n    if (damageTypeDefence.deflect && damageTypeDefence.conduct) {\r\n      // NOOP\r\n    }\r\n    else if (damageTypeDefence.deflect) {\r\n      damage = this.deflectDamage(damageRoll);\r\n    }\r\n    else if (damageTypeDefence.conduct) {\r\n      damage = this.conductDamage(damageRoll);\r\n    }\r\n\r\n    // TODO: Handle Resistance\r\n    // TODO: Handle Amplification\r\n\r\n    let criticalExplosions = this.getCriticalExplosions(damageRoll, damageTypeDefence.vulnerable, damageTypeDefence.negate);\r\n\r\n    if (systemData.armour.defencesArray.includes(damageType)) {\r\n      const penetrate = damageTypeDefence.penetrate + damagePenetrate + unobservedPenalty;\r\n\r\n      const adjustedBlock = Math.max(0, damageTypeDefence.block - penetrate);\r\n      const adjustedPenetration = Math.max(0, penetrate - damageTypeDefence.block)\r\n\r\n      const fullDamage = damage;\r\n      let adjustedArmour = currentArmour + adjustedBlock - adjustedPenetration;\r\n      adjustedArmour = adjustedArmour < 0 ? 0 : adjustedArmour;\r\n      const damageThroughArmour = adjustedArmour - damage;\r\n      if (damageThroughArmour < 0) {\r\n        damage = Math.min(Math.abs(damageThroughArmour), fullDamage);\r\n      } else {\r\n        damage = 0;\r\n      }\r\n\r\n      const damageThroughBlock = adjustedBlock - fullDamage;\r\n      const adjustedDamageThroughBlock = damageThroughBlock > 0 ? 0 : damageThroughBlock;\r\n      newArmour = Math.max(0, currentArmour - Math.abs(adjustedDamageThroughBlock));\r\n    }\r\n\r\n    let updates = {};\r\n    if (damage > 0) {\r\n      updates = this.handleDamage(systemData, damage, damageType, criticalExplosions, attackData.attackProfile);\r\n    }\r\n\r\n    updates[\"system.armour.value\"] = newArmour;\r\n\r\n    actor.update(updates);\r\n  }\r\n\r\n  absorbDamage(actor, systemData, damage) {\r\n    let currentBlood = systemData.blood.value;\r\n    currentBlood = Math.min(currentBlood + damage, systemData.blood.fullMax);\r\n    const maxBlood = Math.max(currentBlood, systemData.blood.max);\r\n    actor.update({ \"system.blood.value\": currentBlood, \"system.blood.max\": maxBlood });\r\n  }\r\n\r\n  deflectDamage(damageRoll) {\r\n    const diceResults = damageRoll.terms[0].rolls[0].terms[0].results.reduce((a, b) => a + b.result, 0);\r\n    return damageRoll.total - diceResults;\r\n  }\r\n\r\n  conductDamage(damageRoll) {\r\n    const diceResults = damageRoll.terms[0].rolls[0].terms[0].results.reduce((a, b) => a + b.result, 0);\r\n    const totalDice = damageRoll.terms[0].rolls[0].terms[0].results.length;\r\n    const maximiseDifference = (totalDice * 10) - diceResults;\r\n    return damageRoll.total + maximiseDifference;\r\n  }\r\n\r\n  getCriticalExplosions(damageRoll, vulnerable, negate) {\r\n    const criticalThreshold = +damageRoll.terms[0].rolls[0].terms[0].modifiers[0].split('=')[1];\r\n    const criticalChecks = damageRoll.terms[0].rolls[0].terms[0].results.filter(r => r.result >= criticalThreshold).length;\r\n    return criticalChecks - negate + vulnerable;\r\n  }\r\n\r\n  handleDamage(systemData, damage, damageType, criticalExplosions, attackProfile) {\r\n\r\n    if (damageType === \"heat\") {\r\n      return this.handleHeat(systemData, damage, criticalExplosions, attackProfile);\r\n    }\r\n\r\n    if ([\"crushing\", \"slashing\", \"piercing\", \"untyped\"].includes(damageType)) {\r\n      return this.handlePhysical(systemData, damage, criticalExplosions, attackProfile);\r\n    }\r\n  }\r\n\r\n  handleHeat(systemData, damage, criticalExplosions, attackProfile) {\r\n    const healingWounds = systemData.wounds.healing += damage;\r\n    const thermalState = systemData.state += attackProfile.thermalChange;\r\n    // TODO: (Can we add) We can! add conditions automatically? would be good to add burned here...\r\n    const updates = { \"system.wounds.healing\": damage };\r\n    if (criticalExplosions) {\r\n      let currentBlood = systemData.blood.value -= damage;\r\n      let maxBlood = systemData.blood.max -= damage;\r\n      updates[\"system.blood.current\"] = currentBlood;\r\n      updates[\"system.blood.max\"] = maxBlood;\r\n    }\r\n    return updates;\r\n  }\r\n\r\n  handlePhysical(systemData, damage, criticalExplosions, attackProfile) {\r\n    const updates = {};\r\n\r\n    if (systemData.canBleed) {\r\n      let activeWounds = systemData.wounds.active += damage;\r\n      updates[\"system.wounds.active\"] = activeWounds;\r\n    }\r\n\r\n    if (systemData.suffersPain) {\r\n      const pain = systemData.pain += damage;\r\n      updates[\"system.pain\"] = pain;\r\n    }\r\n\r\n    if (criticalExplosions) {\r\n      switch (attackProfile.weapon.damageType) {\r\n        case \"crushing\":\r\n          this.handleCrushingCritical(updates, damage, criticalExplosions);\r\n          break;\r\n        case \"slashing\":\r\n          this.handleSlashingCritical(updates, damage, criticalExplosions);\r\n          break;\r\n        case \"piercing\":\r\n          this.handlePiercingCritical(updates, damage, criticalExplosions);\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    }\r\n\r\n    return updates;\r\n  }\r\n\r\n  handleCrushingCritical(updates, damage, _) {\r\n    updates[\"system.conditions.sundered\"] = damage;\r\n  }\r\n\r\n  handleSlashingCritical(updates, damage, _) {\r\n    updates[\"system.wounds.active\"] += damage;\r\n  }\r\n\r\n  handlePiercingCritical(updates, _, criticalExplosions) {\r\n    updates[\"system.conditions.gushingWounds\"] = criticalExplosions;\r\n  }\r\n}","import { d10Roll } from \"../helpers/dice.mjs\";\r\n\r\n/**\r\n * Extend the basic Item with some very simple modifications.\r\n * @extends {Item}\r\n */\r\nexport class AbbrewItem extends Item {\r\n  /**\r\n   * Augment the basic Item data model with additional dynamic data.\r\n   */\r\n  prepareData() {\r\n    // As with the actor class, items are documents that can have their data\r\n    // preparation methods overridden (such as prepareBaseData()).\r\n    super.prepareData();\r\n    if (this.system.isArmour) {\r\n      // TODO: JSON.parse giving errors for new items with no tagified data\r\n      this.system.armour.value = (+this.system.material.tier + +this.system.material.structure + this.armourTypeBonus[JSON.parse(this.system.armour.type).map(t => t.value)[0]]) * JSON.parse(this.system.armour.armourPoints).length;\r\n    }\r\n  }\r\n\r\n  armourTypeBonus = {\r\n    Plate: 5,\r\n    Chain: 3,\r\n    Hide: 2,\r\n    Cloth: 1,\r\n    Accessory: 0\r\n  }\r\n\r\n  /**\r\n   * Prepare a data object which is passed to any Roll formulas which are created related to this Item\r\n   * @private\r\n   */\r\n  getRollData() {\r\n    // If present, return the actor's roll data.\r\n    if (!this.actor) return null;\r\n    const rollData = this.actor.getRollData();\r\n    // Grab the item's system data as well.\r\n    rollData.item = foundry.utils.deepClone(this.system);\r\n\r\n    return rollData;\r\n  }\r\n\r\n  /**\r\n   * Handle clickable rolls.\r\n   * @param {Event} event   The originating click event\r\n   * @private\r\n   */\r\n  async roll() {\r\n    const item = this;\r\n\r\n    // Initialize chat data.\r\n    const speaker = ChatMessage.getSpeaker({ actor: this.actor });\r\n    const rollMode = game.settings.get('core', 'rollMode');\r\n    const label = `[${item.type}] ${item.name}`;\r\n\r\n    // If there's no roll data, send a chat message.\r\n    if (!this.system.formula) {\r\n      ChatMessage.create({\r\n        speaker: speaker,\r\n        rollMode: rollMode,\r\n        flavor: label,\r\n        content: item.system.description ?? ''\r\n      });\r\n    }\r\n    // Otherwise, create a roll and send a chat message from it.\r\n    else {\r\n      // Retrieve roll data.\r\n      const rollData = this.getRollData();\r\n\r\n      // Invoke the roll and submit it to chat.\r\n      const roll = new Roll(rollData.item.formula, rollData);\r\n      // If you need to store the value first, uncomment the next line.\r\n      // let result = await roll.roll({async: true});\r\n      roll.toMessage({\r\n        speaker: speaker,\r\n        rollMode: rollMode,\r\n        flavor: label,\r\n      });\r\n      return roll;\r\n    }\r\n  }\r\n\r\n  async use(config = {}, options = {}) {\r\n    let item = this;\r\n    const is = item.system;\r\n    const as = item.actor.system;\r\n\r\n    // Ensure the options object is ready\r\n    options = foundry.utils.mergeObject({\r\n      configureDialog: true,\r\n      createMessage: true,\r\n      \"flags.abbrew.use\": { type: this.type, itemId: this.id, itemUuid: this.uuid }\r\n    }, options);\r\n\r\n    const card = await this.displayCard(options);\r\n\r\n    return card;\r\n  }\r\n\r\n  async displayCard(options = {}) {\r\n\r\n    // Render the chat card template\r\n    const token = this.actor.token;\r\n    const templateData = {\r\n      actor: this.actor,\r\n      tokenId: token?.uuid || null,\r\n      item: this,\r\n      data: await this.getChatData(),\r\n      labels: this.labels,\r\n      hasAttack: this.hasAttack,\r\n      isHealing: this.isHealing,\r\n      hasDamage: this.hasDamage,\r\n      isVersatile: this.isVersatile,\r\n      isSpell: this.type === \"spell\",\r\n      hasSave: this.hasSave,\r\n      hasAreaTarget: this.hasAreaTarget,\r\n      isTool: this.type === \"tool\",\r\n      hasAbilityCheck: this.hasAbilityCheck\r\n    };\r\n\r\n    const html = await renderTemplate(\"systems/abbrew/templates/chat/item-card.hbs\", templateData);\r\n\r\n    // Create the ChatMessage data object\r\n    const chatData = {\r\n      user: game.user.id,\r\n      type: CONST.CHAT_MESSAGE_TYPES.OTHER,\r\n      content: html,\r\n      flavor: this.name,\r\n      speaker: ChatMessage.getSpeaker({ actor: this.actor, token }),\r\n      flags: { \"core.canPopout\": true }\r\n    };\r\n\r\n    // If the Item was destroyed in the process of displaying its card - embed the item data in the chat message\r\n    //   if ( (this.type === \"consumable\") && !this.actor.items.has(this.id) ) {\r\n    //     chatData.flags[\"abbrew.itemData\"] = templateData.item.toObject();\r\n    //   }\r\n\r\n    // Merge in the flags from options\r\n    chatData.flags = foundry.utils.mergeObject(chatData.flags, options.flags);\r\n\r\n    /**\r\n     * A hook event that fires before an item chat card is created.\r\n     * @function abbrew.preDisplayCard\r\n     * @memberof hookEvents\r\n     * @param {Item5e} item             Item for which the chat card is being displayed.\r\n     * @param {object} chatData         Data used to create the chat message.\r\n     * @param {ItemUseOptions} options  Options which configure the display of the item chat card.\r\n     */\r\n    Hooks.callAll(\"abbrew.preDisplayCard\", this, chatData, options);\r\n\r\n    // Apply the roll mode to adjust message visibility\r\n    // ChatMessage.applyRollMode(chatData, options.rollMode ?? game.settings.get(\"core\", \"rollMode\"));\r\n\r\n    // const options = { createMessage: true };\r\n\r\n    // Create the Chat Message or return its data\r\n    const card = (options.createMessage !== false) ? await ChatMessage.create(chatData) : chatData;\r\n\r\n    /**\r\n     * A hook event that fires after an item chat card is created.\r\n     * @function abbrew.displayCard\r\n     * @memberof hookEvents\r\n     * @param {Item5e} item              Item for which the chat card is being displayed.\r\n     * @param {ChatMessage|object} card  The created ChatMessage instance or ChatMessageData depending on whether\r\n     *                                   options.createMessage was set to `true`.\r\n     */\r\n    Hooks.callAll(\"abbrew.displayCard\", this, card);\r\n\r\n    return card;\r\n  }\r\n\r\n  async getChatData(htmlOptions = {}) {\r\n    const data = this.toObject().system;\r\n    const labels = this.labels;\r\n\r\n    // Rich text description\r\n    data.description = await TextEditor.enrichHTML(data.description, {\r\n      async: true,\r\n      relativeTo: this,\r\n      links: true,\r\n      rollData: this.getRollData(),\r\n      ...htmlOptions\r\n    });\r\n\r\n    // Item type specific properties\r\n    const props = [];\r\n    // switch ( this.type ) {\r\n    //   case \"consumable\":\r\n    //     this._consumableChatData(data, labels, props); break;\r\n    //   case \"equipment\":\r\n    //     this._equipmentChatData(data, labels, props); break;\r\n    //   case \"feat\":\r\n    //     this._featChatData(data, labels, props); break;\r\n    //   case \"loot\":\r\n    //     this._lootChatData(data, labels, props); break;\r\n    //   case \"spell\":\r\n    //     this._spellChatData(data, labels, props); break;\r\n    //   case \"tool\":\r\n    //     this._toolChatData(data, labels, props); break;\r\n    //   case \"weapon\":\r\n    //     this._weaponChatData(data, labels, props); break;\r\n    // }\r\n\r\n    // // Equipment properties\r\n    // if ( data.hasOwnProperty(\"equipped\") && ![\"loot\", \"tool\"].includes(this.type) ) {\r\n    //   if ( data.attunement === CONFIG.DND5E.attunementTypes.REQUIRED ) {\r\n    //     props.push(CONFIG.DND5E.attunements[CONFIG.DND5E.attunementTypes.REQUIRED]);\r\n    //   }\r\n    //   props.push(\r\n    //     game.i18n.localize(data.equipped ? \"DND5E.Equipped\" : \"DND5E.Unequipped\"),\r\n    //     game.i18n.localize(data.proficient ? \"DND5E.Proficient\" : \"DND5E.NotProficient\")\r\n    //   );\r\n    // }\r\n\r\n    // // Ability activation properties\r\n    // if ( data.hasOwnProperty(\"activation\") ) {\r\n    //   props.push(\r\n    //     labels.activation + (data.activation?.condition ? ` (${data.activation.condition})` : \"\"),\r\n    //     labels.target,\r\n    //     labels.range,\r\n    //     labels.duration\r\n    //   );\r\n    // }\r\n\r\n    // Filter properties and return\r\n    data.properties = props.filter(p => !!p);\r\n    return data;\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n  /*  Chat Message Helpers                        */\r\n  /* -------------------------------------------- */\r\n\r\n  /**\r\n   * Apply listeners to chat messages.\r\n   * @param {HTML} html  Rendered chat message.\r\n   */\r\n  static chatListeners(html) {\r\n    html.on(\"click\", \".card-buttons button\", this._onChatCardAction.bind(this));\r\n    html.on(\"click\", \".item-name\", this._onChatCardToggleContent.bind(this));\r\n  }\r\n\r\n  static async _onChatCardAction(event) {\r\n    event.preventDefault();\r\n\r\n    // Extract card data\r\n    const button = event.currentTarget;\r\n    // Disable Button\r\n    button.disabled = true;\r\n    const card = button.closest(\".chat-card\");\r\n    const messageId = card.closest(\".message\").dataset.messageId;\r\n    const message = game.messages.get(messageId);\r\n    const action = button.dataset.action;\r\n\r\n    // Recover the actor for the chat card\r\n    const actor = await this._getChatCardActor(card);\r\n    if (!actor) return;\r\n\r\n    // Validate permission to proceed with the roll\r\n    const isTargetted = action === \"contest\";\r\n    if (!(isTargetted || game.user.isGM || actor.isOwner)) {\r\n      return;\r\n    }\r\n\r\n    // Get the Item from stored flag data or by the item ID on the Actor\r\n    const storedData = message.getFlag(\"abbrew\", \"itemData\");\r\n    const item = storedData ? new this(storedData, { parent: actor }) : actor.items.get(card.dataset.itemId);\r\n    if (!item) {\r\n      const err = game.i18n.format(\"ABBREW.ActionWarningNoItem\", { item: card.dataset.itemId, name: actor.name });\r\n      return ui.notifications.error(err);\r\n    }\r\n\r\n    await item.rollAttack({ event });\r\n\r\n    // Re-enable the button\r\n    button.disabled = false;\r\n  }\r\n\r\n  async rollAttack(options = {}) {\r\n\r\n    const { rollData, parts } = this.getAttack();\r\n\r\n    let title = `${this.name} - ${game.i18n.localize(\"ABBREW.AttackRoll\")}`;\r\n\r\n    // HERE: Look at skill rolls in 5e\r\n    // TODO: FUCKER WAS COMING FROM HERE\r\n    rollData.mod = 10;\r\n\r\n    // Compose roll options\r\n    const rollConfig = foundry.utils.mergeObject({\r\n      actor: this.actor,\r\n      data: rollData,\r\n      critical: this.getCriticalThreshold(),\r\n      title,\r\n      flavor: title,\r\n      dialogOptions: {\r\n        width: 400,\r\n        top: options.event ? options.event.clientY - 80 : null,\r\n        left: window.innerWidth - 710\r\n      },\r\n      messageData: {\r\n        \"flags.abbrew.roll\": { type: \"attack\", itemId: this.id, itemUuid: this.uuid },\r\n        speaker: ChatMessage.getSpeaker({ actor: this.actor })\r\n      }\r\n    }, options);\r\n    rollConfig.parts = parts.concat(options.parts ?? []);\r\n\r\n    const roll = await d10Roll(rollConfig);\r\n\r\n    return roll;\r\n\r\n  }\r\n\r\n  // TODO: Allow to change\r\n  getCriticalThreshold() {\r\n    return 10;\r\n  }\r\n\r\n  // TODO: Check this is needed\r\n  getAttack() {\r\n    const rollData = this.getRollData();\r\n    const parts = [];\r\n    return { rollData, parts };\r\n  }\r\n\r\n  async update(data = {}, context = {}) {\r\n    console.log('update item');\r\n    super.update(data, context);\r\n  }\r\n\r\n  /**\r\n   * Handle toggling the visibility of chat card content when the name is clicked\r\n   * @param {Event} event   The originating click event\r\n   * @private\r\n   */\r\n  static _onChatCardToggleContent(event) {\r\n    event.preventDefault();\r\n    const header = event.currentTarget;\r\n    const card = header.closest(\".chat-card\");\r\n    const content = card.querySelector(\".card-content\");\r\n    content.style.display = content.style.display === \"none\" ? \"block\" : \"none\";\r\n  }\r\n\r\n  /**\r\n * Get the Actor which is the author of a chat card\r\n * @param {HTMLElement} card    The chat card being used\r\n * @returns {Actor|null}        The Actor document or null\r\n * @private\r\n */\r\n  static async _getChatCardActor(card) {\r\n\r\n    // Case 1 - a synthetic actor from a Token\r\n    if (card.dataset.tokenId) {\r\n      const token = await fromUuid(card.dataset.tokenId);\r\n      if (!token) return null;\r\n      return token.actor;\r\n    }\r\n\r\n    // Case 2 - use Actor ID directory\r\n    const actorId = card.dataset.actorId;\r\n    return game.actors.get(actorId) || null;\r\n  }\r\n\r\n  /**\r\n   * Get the Actor which is the author of a chat card\r\n   * @param {HTMLElement} card    The chat card being used\r\n   * @returns {Actor[]}            An Array of Actor documents, if any\r\n   * @private\r\n   */\r\n  static _getChatCardTargets(card) {\r\n    let targets = canvas.tokens.controlled.filter(t => !!t.actor);\r\n    if (!targets.length && game.user.character) targets = targets.concat(game.user.character.getActiveTokens());\r\n    if (!targets.length) ui.notifications.warn(game.i18n.localize(\"DND5E.ActionWarningNoToken\"));\r\n    return targets;\r\n  }\r\n}\r\n","export async function ChatAbbrew(dataset, element, actor) {\r\n    return;\r\n\r\n    const itemId = element.closest('.item').dataset.itemId;\r\n    const item = actor.items.get(itemId);\r\n\r\n    const templateData = {\r\n        actor,\r\n        item,\r\n        dataset,\r\n        description: item.system.description\r\n    };\r\n\r\n    const html = await renderTemplate(\"systems/abbrew/templates/chat/item-card.hbs\", templateData);\r\n\r\n    // Create the ChatMessage data object\r\n    const chatData = {\r\n        user: game.user.id,\r\n        type: CONST.CHAT_MESSAGE_TYPES.OTHER,\r\n        content: html,\r\n        flavor: item.name,\r\n        speaker: ChatMessage.getSpeaker({ actor, token: actor.token }),\r\n        flags: { \"core.canPopout\": true }\r\n    };\r\n\r\n    // If the Item was destroyed in the process of displaying its card - embed the item data in the chat message\r\n    //   if ( (this.type === \"consumable\") && !this.actor.items.has(this.id) ) {\r\n    //     chatData.flags[\"abbrew.itemData\"] = templateData.item.toObject();\r\n    //   }\r\n\r\n    // Merge in the flags from options\r\n    // chatData.flags = foundry.utils.mergeObject(chatData.flags, options.flags); \r\n\r\n    /**\r\n     * A hook event that fires before an item chat card is created.\r\n     * @function abbrew.preDisplayCard\r\n     * @memberof hookEvents\r\n     * @param {Item5e} item             Item for which the chat card is being displayed.\r\n     * @param {object} chatData         Data used to create the chat message.\r\n     * @param {ItemUseOptions} options  Options which configure the display of the item chat card.\r\n     */\r\n    // Hooks.callAll(\"abbrew.preDisplayCard\", this, chatData, options);\r\n\r\n    // Apply the roll mode to adjust message visibility\r\n    // ChatMessage.applyRollMode(chatData, options.rollMode ?? game.settings.get(\"core\", \"rollMode\"));\r\n\r\n    const options = { createMessage: true };\r\n\r\n    // Create the Chat Message or return its data\r\n    const card = (options.createMessage !== false) ? await ChatMessage.create(chatData) : chatData;\r\n\r\n    /**\r\n     * A hook event that fires after an item chat card is created.\r\n     * @function abbrew.displayCard\r\n     * @memberof hookEvents\r\n     * @param {Item5e} item              Item for which the chat card is being displayed.\r\n     * @param {ChatMessage|object} card  The created ChatMessage instance or ChatMessageData depending on whether\r\n     *                                   options.createMessage was set to `true`.\r\n     */\r\n    Hooks.callAll(\"abbrew.displayCard\", this, card);\r\n\r\n    return card;\r\n}","/**\r\n * Manage Active Effect instances through the Actor Sheet via effect control buttons.\r\n * @param {MouseEvent} event      The left-click event on the effect control\r\n * @param {Actor|Item} owner      The owning document which manages this effect\r\n */\r\n export function onManageActiveEffect(event, owner) {\r\n  event.preventDefault();\r\n  const a = event.currentTarget;\r\n  const li = a.closest(\"li\");\r\n  const effect = li.dataset.effectId ? owner.effects.get(li.dataset.effectId) : null;\r\n  switch ( a.dataset.action ) {\r\n    case \"create\":\r\n      return owner.createEmbeddedDocuments(\"ActiveEffect\", [{\r\n        label: \"New Effect\",\r\n        icon: \"icons/svg/aura.svg\",\r\n        source: owner.uuid,\r\n        \"duration.rounds\": li.dataset.effectType === \"temporary\" ? 1 : undefined,\r\n        disabled: li.dataset.effectType === \"inactive\"\r\n      }]);\r\n    case \"edit\":\r\n      return effect.sheet.render(true);\r\n    case \"delete\":\r\n      return effect.delete();\r\n    case \"toggle\":\r\n      return effect.update({disabled: !effect.disabled});\r\n  }\r\n}\r\n\r\n/**\r\n * Prepare the data structure for Active Effects which are currently applied to an Actor or Item.\r\n * @param {ActiveEffect[]} effects    The array of Active Effect instances to prepare sheet data for\r\n * @return {object}                   Data for rendering\r\n */\r\nexport function prepareActiveEffectCategories(effects) {\r\n\r\n    // Define effect header categories\r\n    const categories = {\r\n      temporary: {\r\n        type: \"temporary\",\r\n        label: \"Temporary Effects\",\r\n        effects: []\r\n      },\r\n      passive: {\r\n        type: \"passive\",\r\n        label: \"Passive Effects\",\r\n        effects: []\r\n      },\r\n      inactive: {\r\n        type: \"inactive\",\r\n        label: \"Inactive Effects\",\r\n        effects: []\r\n      }\r\n    };\r\n\r\n    // Iterate over active effects, classifying them into categories\r\n    for ( let e of effects ) {\r\n      e._getSourceName(); // Trigger a lookup for the source name\r\n      if ( e.disabled ) categories.inactive.effects.push(e);\r\n      else if ( e.isTemporary ) categories.temporary.effects.push(e);\r\n      else categories.passive.effects.push(e);\r\n    }\r\n    return categories;\r\n}","import { useAttack, onAttackCardAction } from \"../documents/attackprofile.mjs\";\r\nimport { ChatAbbrew } from \"../helpers/chat.mjs\";\r\nimport { onManageActiveEffect, prepareActiveEffectCategories } from \"../helpers/effects.mjs\";\r\n\r\n/**\r\n * Extend the basic ActorSheet\r\n * @extends {ActorSheet}\r\n */\r\nexport class AbbrewActorSheet extends ActorSheet {\r\n\r\n  /** @override */\r\n  static get defaultOptions() {\r\n    return mergeObject(super.defaultOptions, {\r\n      classes: [\"abbrew\", \"sheet\", \"actor\"],\r\n      template: \"systems/abbrew/templates/actor/actor-sheet.hbs\",\r\n      width: 600,\r\n      height: 600,\r\n      tabs: [{ navSelector: \".sheet-tabs\", contentSelector: \".sheet-body\", initial: \"features\" }]\r\n    });\r\n  }\r\n\r\n  /** @override */\r\n  get template() {\r\n    return `systems/abbrew/templates/actor/actor-${this.actor.type}-sheet.hbs`;\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n\r\n  /** @override */\r\n  getData() {\r\n    // Retrieve the data structure from the base sheet. You can inspect or log\r\n    // the context variable to see the structure, but some key properties for\r\n    // sheets are the actor object, the data object, whether or not it's\r\n    // editable, the items array, and the effects array.\r\n    const context = super.getData();\r\n\r\n    // Use a safe clone of the actor data for further operations.\r\n    const actorData = this.actor.toObject(false);\r\n\r\n    // Add the actor's data to context.data for easier access, as well as flags.\r\n    context.system = actorData.system;\r\n    context.flags = actorData.flags;\r\n\r\n    // Prepare character data and items.\r\n    if (actorData.type == 'character') {\r\n      this._prepareItems(context);\r\n      this._prepareCharacterData(context);\r\n      this._prepareAttacks(context);\r\n      this._prepareArmours(context);\r\n      context.displayConditions = actorData.system.displayConditions;\r\n    }\r\n\r\n    // Prepare NPC data and items.\r\n    if (actorData.type == 'npc') {\r\n      this._prepareItems(context);\r\n    }\r\n\r\n    // Add roll data for TinyMCE editors.\r\n    context.rollData = context.actor.getRollData();\r\n\r\n    // Prepare active effects\r\n    context.effects = prepareActiveEffectCategories(this.actor.effects);\r\n\r\n    return context;\r\n  }\r\n\r\n  /**\r\n   * Organize and classify Items for Character sheets.\r\n   *\r\n   * @param {Object} actorData The actor to prepare.\r\n   *\r\n   * @return {undefined}\r\n   */\r\n  _prepareCharacterData(context) {\r\n    // Handle ability scores.\r\n    for (let [k, v] of Object.entries(context.system.statistics)) {\r\n      v.label = game.i18n.localize(CONFIG.ABBREW.statistics[k]) ?? k;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Organize and classify Items for Character sheets.\r\n   *\r\n   * @param {Object} actorData The actor to prepare.\r\n   *\r\n   * @return {undefined}\r\n   */\r\n  _prepareItems(context) {\r\n    // Initialize containers.\r\n    const anatomy = [];\r\n    const resources = [];\r\n    const abilities = [];\r\n    const gear = [];\r\n    const features = [];\r\n    const formModifiers = [];\r\n    const spells = {\r\n      0: [],\r\n      1: [],\r\n      2: [],\r\n      3: [],\r\n      4: [],\r\n      5: [],\r\n      6: [],\r\n      7: [],\r\n      8: [],\r\n      9: []\r\n    };\r\n\r\n    // Iterate through items, allocating to containers\r\n    for (let i of context.items) {\r\n      i.img = i.img || DEFAULT_TOKEN;\r\n      // Append to resources.\r\n      if (i.type === 'anatomy') {\r\n        anatomy.push(i);\r\n      }\r\n      else if (i.type === 'form') {\r\n        if (JSON.parse(i.system.tags).filter(t => t.value === 'Base').length > 0) {\r\n          context.baseForm = i;\r\n        } else {\r\n          formModifiers.push(i);\r\n        }\r\n      }\r\n      // Append to resources.\r\n      else if (i.type === 'resource') {\r\n        resources.push(i);\r\n      }\r\n      // Append to gear.\r\n      else if (i.type === 'item') {\r\n        gear.push(i);\r\n      }\r\n      // Append to features.\r\n      else if (i.type === 'feature') {\r\n        features.push(i);\r\n      }\r\n      // Append to Abilities\r\n      else if (i.type === 'ability') {\r\n        abilities.push(i);\r\n      }\r\n      // Append to spells.\r\n      else if (i.type === 'spell') {\r\n        if (i.system.spellLevel != undefined) {\r\n          spells[i.system.spellLevel].push(i);\r\n        }\r\n      }\r\n    }\r\n\r\n    // Assign and return\r\n    // ABDOC: name here in context used in hbs to pull values\r\n    context.resource = resources;\r\n    context.gear = gear;\r\n    context.features = features;\r\n    context.spells = spells;\r\n    context.anatomy = anatomy;\r\n    context.formModifiers = formModifiers;\r\n    context.ability = abilities;\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n\r\n  _prepareAttacks(context) {\r\n    context.attacks = context.system.attacks;\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n\r\n  _prepareArmours(context) {\r\n    context.armours = context.system.armours;\r\n  }\r\n\r\n\r\n  /* -------------------------------------------- */\r\n\r\n  /** @override */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n\r\n    // Render the item sheet for viewing/editing prior to the editable check.\r\n    html.find('.item-edit').click(ev => {\r\n      const li = $(ev.currentTarget).parents(\".item\");\r\n      const item = this.actor.items.get(li.data(\"itemId\"));\r\n      item.sheet.render(true);\r\n    });\r\n\r\n    // -------------------------------------------------------------\r\n    // Everything below here is only needed if the sheet is editable\r\n    if (!this.isEditable) return;\r\n\r\n    // Render Compendium\r\n    html.find(\".open-compendium\").on(\"click\", (event) => {\r\n      if (event.currentTarget.dataset.compendium) {\r\n          const compendium = game.packs.get(event.currentTarget.dataset.compendium);\r\n          if (compendium) {\r\n              compendium.render(true);\r\n          }\r\n      }\r\n  });\r\n\r\n    // Show/Hide Conditions\r\n    html.find('.conditions-header').click(async ev => {\r\n      const context = super.getData();\r\n      await this.actor.update({ \"system.displayConditions\": !this.actor.system.displayConditions });\r\n    });\r\n\r\n    // Add Inventory Item\r\n    html.find('.item-create').click(this._onItemCreate.bind(this));\r\n\r\n    // Delete Inventory Item\r\n    html.find('.item-delete').click(ev => {\r\n      const li = $(ev.currentTarget).parents(\".item\");\r\n      const item = this.actor.items.get(li.data(\"itemId\"));\r\n      item.delete();\r\n      li.slideUp(200, () => this.render(false));\r\n    });\r\n\r\n    // Active Effect management\r\n    html.find(\".effect-control\").click(ev => onManageActiveEffect(ev, this.actor));\r\n\r\n    // Rollable abilities.\r\n    html.find('.rollable .item-image').click(this._onItemUse.bind(this));\r\n\r\n    // attacks\r\n    html.find('.equip-weapon').click(this._equipWeapon.bind(this));\r\n    html.find('.rollable.attack').click(this._onAttackUse.bind(this));\r\n\r\n    // armour\r\n    html.find('.equip-armour').click(this._equipArmour.bind(this));\r\n\r\n    // Drag events for macros.\r\n    if (this.actor.isOwner) {\r\n      let handler = ev => this._onDragStart(ev);\r\n      html.find('li.item').each((i, li) => {\r\n        if (li.classList.contains(\"inventory-header\")) return;\r\n        li.setAttribute(\"draggable\", true);\r\n        li.addEventListener(\"dragstart\", handler, false);\r\n      });\r\n    }\r\n  }\r\n\r\n  async _equipWeapon(event) {\r\n    event.preventDefault();\r\n    const dataSet = event.target.dataset\r\n    const weaponId = dataSet.weaponid;\r\n    const equip = dataSet.equip === \"true\";\r\n    await this.actor.equipWeapon(weaponId, equip)\r\n  }\r\n\r\n  async _equipArmour(event) {\r\n    event.preventDefault();\r\n    const dataSet = event.target.dataset\r\n    const armourId = dataSet.armourid;\r\n    const equip = dataSet.equip === \"true\";\r\n    await this.actor.equipArmour(armourId, equip)\r\n  }\r\n\r\n  /**\r\n   * Handle creating a new Owned Item for the actor using initial data defined in the HTML dataset\r\n   * @param {Event} event   The originating click event\r\n   * @private\r\n   */\r\n  async _onItemCreate(event) {\r\n    event.preventDefault();\r\n    const header = event.currentTarget;\r\n    const type = header.dataset.type;\r\n\r\n    // Check to make sure the newly created class doesn't take player over level cap\r\n    if (type === \"ability\" && (this.actor.system.IP.current + 1 > this.actor.system.IP.total)) {\r\n      const err = game.i18n.format(\"ABBREW.InspirationPointsExceededWarn\", { max: this.actor.system.IP.total });\r\n      return ui.notifications.error(err);\r\n    }\r\n\r\n    const itemData = {\r\n      name: game.i18n.format(\"ABBREW.ItemNew\", { type: game.i18n.localize(`ITEM.Type${type.capitalize()}`) }),\r\n      type: type,\r\n      system: { ...header.dataset.type }\r\n    };\r\n    delete itemData.system.type;\r\n\r\n    return this.actor.createEmbeddedDocuments(\"Item\", [itemData]);\r\n  }\r\n\r\n  /**\r\n   * Handle clickable rolls.\r\n   * @param {Event} event   The originating click event\r\n   * @private\r\n   */\r\n  async _onItemUse(event) {\r\n    event.preventDefault();\r\n    const element = event.currentTarget;\r\n    const dataset = element.dataset;\r\n    const actor = this.actor;\r\n    ChatAbbrew(dataset, element, actor);\r\n    const itemId = event.currentTarget.closest(\".item\").dataset.itemId;\r\n    const item = this.actor.items.get(itemId);\r\n    // await this.displayCard(dataset, element, actor)\r\n    return item.use({}, { event });\r\n  }\r\n\r\n  async _onAttackUse(event) {\r\n    event.preventDefault();\r\n    console.log(event);\r\n    const data = event.target.dataset;\r\n    const attack = this.actor.system.attacks.filter(a => a.id === data.attack)[0];\r\n    const attackProfile = attack.profiles.flat().filter(ap => ap.id === + data.attackprofile)[0];\r\n    useAttack(attack, attackProfile, this.actor);\r\n  }\r\n}\r\n","/**\n * Tagify (v 4.17.8) - tags input component\n * By undefined\n * https://github.com/yairEO/tagify\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n * \r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n * \r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n * THE SOFTWARE.\r\n * \r\n * THE SOFTWARE IS NOT PERMISSIBLE TO BE SOLD.\n */\n\n!function(t,e){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=e():\"function\"==typeof define&&define.amd?define(e):(t=\"undefined\"!=typeof globalThis?globalThis:t||self).Tagify=e()}(this,(function(){\"use strict\";function t(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function e(e){for(var s=1;s<arguments.length;s++){var a=null!=arguments[s]?arguments[s]:{};s%2?t(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):t(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(t,e,i){return(e=function(t){var e=function(t,e){if(\"object\"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||\"default\");if(\"object\"!=typeof s)return s;throw new TypeError(\"@@toPrimitive must return a primitive value.\")}return(\"string\"===e?String:Number)(t)}(t,\"string\");return\"symbol\"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const s=(t,e,i,s)=>(t=\"\"+t,e=\"\"+e,s&&(t=t.trim(),e=e.trim()),i?t==e:t.toLowerCase()==e.toLowerCase()),a=(t,e)=>t&&Array.isArray(t)&&t.map((t=>n(t,e)));function n(t,e){var i,s={};for(i in t)e.indexOf(i)<0&&(s[i]=t[i]);return s}function o(t){var e=document.createElement(\"div\");return t.replace(/\\&#?[0-9a-z]+;/gi,(function(t){return e.innerHTML=t,e.innerText}))}function r(t){return(new DOMParser).parseFromString(t.trim(),\"text/html\").body.firstElementChild}function l(t,e){for(e=e||\"previous\";t=t[e+\"Sibling\"];)if(3==t.nodeType)return t}function d(t){return\"string\"==typeof t?t.replace(/&/g,\"&amp;\").replace(/</g,\"&lt;\").replace(/>/g,\"&gt;\").replace(/\"/g,\"&quot;\").replace(/`|'/g,\"&#039;\"):t}function h(t){var e=Object.prototype.toString.call(t).split(\" \")[1].slice(0,-1);return t===Object(t)&&\"Array\"!=e&&\"Function\"!=e&&\"RegExp\"!=e&&\"HTMLUnknownElement\"!=e}function g(t,e,i){function s(t,e){for(var i in e)if(e.hasOwnProperty(i)){if(h(e[i])){h(t[i])?s(t[i],e[i]):t[i]=Object.assign({},e[i]);continue}if(Array.isArray(e[i])){t[i]=Object.assign([],e[i]);continue}t[i]=e[i]}}return t instanceof Object||(t={}),s(t,e),i&&s(t,i),t}function p(){const t=[],e={};for(let i of arguments)for(let s of i)h(s)?e[s.value]||(t.push(s),e[s.value]=1):t.includes(s)||t.push(s);return t}function c(t){return String.prototype.normalize?\"string\"==typeof t?t.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g,\"\"):void 0:t}var u=()=>/(?=.*chrome)(?=.*android)/i.test(navigator.userAgent);function m(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)))}function v(t){return t&&t.classList&&t.classList.contains(this.settings.classNames.tag)}function f(t,e){var i=window.getSelection();return e=e||i.getRangeAt(0),\"string\"==typeof t&&(t=document.createTextNode(t)),e&&(e.deleteContents(),e.insertNode(t)),t}function T(t,e,i){return t?(e&&(t.__tagifyTagData=i?e:g({},t.__tagifyTagData||{},e)),t.__tagifyTagData):(console.warn(\"tag element doesn't exist\",t,e),e)}var w={delimiters:\",\",pattern:null,tagTextProp:\"value\",maxTags:1/0,callbacks:{},addTagOnBlur:!0,onChangeAfterBlur:!0,duplicates:!1,whitelist:[],blacklist:[],enforceWhitelist:!1,userInput:!0,keepInvalidTags:!1,createInvalidTags:!0,mixTagsAllowedAfter:/,|\\.|\\:|\\s/,mixTagsInterpolator:[\"[[\",\"]]\"],backspace:!0,skipInvalid:!1,pasteAsTags:!0,editTags:{clicks:2,keepInvalid:!0},transformTag:()=>{},trim:!0,a11y:{focusableTags:!1},mixMode:{insertAfterTag:\"Â \"},autoComplete:{enabled:!0,rightKey:!1},classNames:{namespace:\"tagify\",mixMode:\"tagify--mix\",selectMode:\"tagify--select\",input:\"tagify__input\",focus:\"tagify--focus\",tagNoAnimation:\"tagify--noAnim\",tagInvalid:\"tagify--invalid\",tagNotAllowed:\"tagify--notAllowed\",scopeLoading:\"tagify--loading\",hasMaxTags:\"tagify--hasMaxTags\",hasNoTags:\"tagify--noTags\",empty:\"tagify--empty\",inputInvalid:\"tagify__input--invalid\",dropdown:\"tagify__dropdown\",dropdownWrapper:\"tagify__dropdown__wrapper\",dropdownHeader:\"tagify__dropdown__header\",dropdownFooter:\"tagify__dropdown__footer\",dropdownItem:\"tagify__dropdown__item\",dropdownItemActive:\"tagify__dropdown__item--active\",dropdownItemHidden:\"tagify__dropdown__item--hidden\",dropdownInital:\"tagify__dropdown--initial\",tag:\"tagify__tag\",tagText:\"tagify__tag-text\",tagX:\"tagify__tag__removeBtn\",tagLoading:\"tagify__tag--loading\",tagEditing:\"tagify__tag--editable\",tagFlash:\"tagify__tag--flash\",tagHide:\"tagify__tag--hide\"},dropdown:{classname:\"\",enabled:2,maxItems:10,searchKeys:[\"value\",\"searchBy\"],fuzzySearch:!0,caseSensitive:!1,accentedSearch:!0,includeSelectedTags:!1,highlightFirst:!1,closeOnSelect:!0,clearOnSelect:!0,position:\"all\",appendTarget:null},hooks:{beforeRemoveTag:()=>Promise.resolve(),beforePaste:()=>Promise.resolve(),suggestionClick:()=>Promise.resolve()}};function b(){this.dropdown={};for(let t in this._dropdown)this.dropdown[t]=\"function\"==typeof this._dropdown[t]?this._dropdown[t].bind(this):this._dropdown[t];this.dropdown.refs()}var y={refs(){this.DOM.dropdown=this.parseTemplate(\"dropdown\",[this.settings]),this.DOM.dropdown.content=this.DOM.dropdown.querySelector(\"[data-selector='tagify-suggestions-wrapper']\")},getHeaderRef(){return this.DOM.dropdown.querySelector(\"[data-selector='tagify-suggestions-header']\")},getFooterRef(){return this.DOM.dropdown.querySelector(\"[data-selector='tagify-suggestions-footer']\")},getAllSuggestionsRefs(){return[...this.DOM.dropdown.content.querySelectorAll(this.settings.classNames.dropdownItemSelector)]},show(t){var e,i,a,n=this.settings,o=\"mix\"==n.mode&&!n.enforceWhitelist,r=!n.whitelist||!n.whitelist.length,l=\"manual\"==n.dropdown.position;if(t=void 0===t?this.state.inputText:t,!(r&&!o&&!n.templates.dropdownItemNoMatch||!1===n.dropdown.enable||this.state.isLoading||this.settings.readonly)){if(clearTimeout(this.dropdownHide__bindEventsTimeout),this.suggestedListItems=this.dropdown.filterListItems(t),t&&!this.suggestedListItems.length&&(this.trigger(\"dropdown:noMatch\",t),n.templates.dropdownItemNoMatch&&(a=n.templates.dropdownItemNoMatch.call(this,{value:t}))),!a){if(this.suggestedListItems.length)t&&o&&!this.state.editing.scope&&!s(this.suggestedListItems[0].value,t)&&this.suggestedListItems.unshift({value:t});else{if(!t||!o||this.state.editing.scope)return this.input.autocomplete.suggest.call(this),void this.dropdown.hide();this.suggestedListItems=[{value:t}]}i=\"\"+(h(e=this.suggestedListItems[0])?e.value:e),n.autoComplete&&i&&0==i.indexOf(t)&&this.input.autocomplete.suggest.call(this,e)}this.dropdown.fill(a),n.dropdown.highlightFirst&&this.dropdown.highlightOption(this.DOM.dropdown.content.querySelector(n.classNames.dropdownItemSelector)),this.state.dropdown.visible||setTimeout(this.dropdown.events.binding.bind(this)),this.state.dropdown.visible=t||!0,this.state.dropdown.query=t,this.setStateSelection(),l||setTimeout((()=>{this.dropdown.position(),this.dropdown.render()})),setTimeout((()=>{this.trigger(\"dropdown:show\",this.DOM.dropdown)}))}},hide(t){var e=this.DOM,i=e.scope,s=e.dropdown,a=\"manual\"==this.settings.dropdown.position&&!t;if(s&&document.body.contains(s)&&!a)return window.removeEventListener(\"resize\",this.dropdown.position),this.dropdown.events.binding.call(this,!1),i.setAttribute(\"aria-expanded\",!1),s.parentNode.removeChild(s),setTimeout((()=>{this.state.dropdown.visible=!1}),100),this.state.dropdown.query=this.state.ddItemData=this.state.ddItemElm=this.state.selection=null,this.state.tag&&this.state.tag.value.length&&(this.state.flaggedTags[this.state.tag.baseOffset]=this.state.tag),this.trigger(\"dropdown:hide\",s),this},toggle(t){this.dropdown[this.state.dropdown.visible&&!t?\"hide\":\"show\"]()},render(){var t,e,i,s=(t=this.DOM.dropdown,(i=t.cloneNode(!0)).style.cssText=\"position:fixed; top:-9999px; opacity:0\",document.body.appendChild(i),e=i.clientHeight,i.parentNode.removeChild(i),e),a=this.settings;return\"number\"==typeof a.dropdown.enabled&&a.dropdown.enabled>=0?(this.DOM.scope.setAttribute(\"aria-expanded\",!0),document.body.contains(this.DOM.dropdown)||(this.DOM.dropdown.classList.add(a.classNames.dropdownInital),this.dropdown.position(s),a.dropdown.appendTarget.appendChild(this.DOM.dropdown),setTimeout((()=>this.DOM.dropdown.classList.remove(a.classNames.dropdownInital)))),this):this},fill(t){t=\"string\"==typeof t?t:this.dropdown.createListHTML(t||this.suggestedListItems);var e,i=this.settings.templates.dropdownContent.call(this,t);this.DOM.dropdown.content.innerHTML=(e=i)?e.replace(/\\>[\\r\\n ]+\\</g,\"><\").replace(/(<.*?>)|\\s+/g,((t,e)=>e||\" \")):\"\"},fillHeaderFooter(){var t=this.dropdown.filterListItems(this.state.dropdown.query),e=this.parseTemplate(\"dropdownHeader\",[t]),i=this.parseTemplate(\"dropdownFooter\",[t]),s=this.dropdown.getHeaderRef(),a=this.dropdown.getFooterRef();e&&s?.parentNode.replaceChild(e,s),i&&a?.parentNode.replaceChild(i,a)},refilter(t){t=t||this.state.dropdown.query||\"\",this.suggestedListItems=this.dropdown.filterListItems(t),this.dropdown.fill(),this.suggestedListItems.length||this.dropdown.hide(),this.trigger(\"dropdown:updated\",this.DOM.dropdown)},position(t){var e=this.settings.dropdown;if(\"manual\"!=e.position){var i,s,a,n,o,r,l=this.DOM.dropdown,d=e.placeAbove,h=e.appendTarget===document.body,g=h?window.pageYOffset:e.appendTarget.scrollTop,p=document.fullscreenElement||document.webkitFullscreenElement||document.documentElement,c=p.clientHeight,u=Math.max(p.clientWidth||0,window.innerWidth||0)>480?e.position:\"all\",m=this.DOM[\"input\"==u?\"input\":\"scope\"];if(t=t||l.clientHeight,this.state.dropdown.visible){if(\"text\"==u?(a=(i=function(){const t=document.getSelection();if(t.rangeCount){const e=t.getRangeAt(0),i=e.startContainer,s=e.startOffset;let a,n;if(s>0)return n=document.createRange(),n.setStart(i,s-1),n.setEnd(i,s),a=n.getBoundingClientRect(),{left:a.right,top:a.top,bottom:a.bottom};if(i.getBoundingClientRect)return i.getBoundingClientRect()}return{left:-9999,top:-9999}}()).bottom,s=i.top,n=i.left,o=\"auto\"):(r=function(t){for(var e=0,i=0;t&&t!=p;)e+=t.offsetLeft||0,i+=t.offsetTop||0,t=t.parentNode;return{left:e,top:i}}(e.appendTarget),s=(i=m.getBoundingClientRect()).top-r.top,a=i.bottom-1-r.top,n=i.left-r.left,o=i.width+\"px\"),!h){let t=function(){for(var t=0,i=e.appendTarget.parentNode;i;)t+=i.scrollTop||0,i=i.parentNode;return t}();s+=t,a+=t}s=Math.floor(s),a=Math.ceil(a),d=void 0===d?c-i.bottom<t:d,l.style.cssText=\"left:\"+(n+window.pageXOffset)+\"px; width:\"+o+\";\"+(d?\"top: \"+(s+g)+\"px\":\"top: \"+(a+g)+\"px\"),l.setAttribute(\"placement\",d?\"top\":\"bottom\"),l.setAttribute(\"position\",u)}}},events:{binding(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];var e=this.dropdown.events.callbacks,i=this.listeners.dropdown=this.listeners.dropdown||{position:this.dropdown.position.bind(this,null),onKeyDown:e.onKeyDown.bind(this),onMouseOver:e.onMouseOver.bind(this),onMouseLeave:e.onMouseLeave.bind(this),onClick:e.onClick.bind(this),onScroll:e.onScroll.bind(this)},s=t?\"addEventListener\":\"removeEventListener\";\"manual\"!=this.settings.dropdown.position&&(document[s](\"scroll\",i.position,!0),window[s](\"resize\",i.position),window[s](\"keydown\",i.onKeyDown)),this.DOM.dropdown[s](\"mouseover\",i.onMouseOver),this.DOM.dropdown[s](\"mouseleave\",i.onMouseLeave),this.DOM.dropdown[s](\"mousedown\",i.onClick),this.DOM.dropdown.content[s](\"scroll\",i.onScroll)},callbacks:{onKeyDown(t){if(this.state.hasFocus&&!this.state.composing){var e=this.DOM.dropdown.querySelector(this.settings.classNames.dropdownItemActiveSelector),i=this.dropdown.getSuggestionDataByNode(e);switch(t.key){case\"ArrowDown\":case\"ArrowUp\":case\"Down\":case\"Up\":t.preventDefault();var s=this.dropdown.getAllSuggestionsRefs(),a=\"ArrowUp\"==t.key||\"Up\"==t.key;e&&(e=this.dropdown.getNextOrPrevOption(e,!a)),e&&e.matches(this.settings.classNames.dropdownItemSelector)||(e=s[a?s.length-1:0]),this.dropdown.highlightOption(e,!0);break;case\"Escape\":case\"Esc\":this.dropdown.hide();break;case\"ArrowRight\":if(this.state.actions.ArrowLeft)return;case\"Tab\":if(\"mix\"!=this.settings.mode&&e&&!this.settings.autoComplete.rightKey&&!this.state.editing){t.preventDefault();var n=this.dropdown.getMappedValue(i);return this.input.autocomplete.set.call(this,n),!1}return!0;case\"Enter\":t.preventDefault(),this.settings.hooks.suggestionClick(t,{tagify:this,tagData:i,suggestionElm:e}).then((()=>{if(e)return this.dropdown.selectOption(e),e=this.dropdown.getNextOrPrevOption(e,!a),void this.dropdown.highlightOption(e);this.dropdown.hide(),\"mix\"!=this.settings.mode&&this.addTags(this.state.inputText.trim(),!0)})).catch((t=>t));break;case\"Backspace\":{if(\"mix\"==this.settings.mode||this.state.editing.scope)return;const t=this.input.raw.call(this);\"\"!=t&&8203!=t.charCodeAt(0)||(!0===this.settings.backspace?this.removeTags():\"edit\"==this.settings.backspace&&setTimeout(this.editTag.bind(this),0))}}}},onMouseOver(t){var e=t.target.closest(this.settings.classNames.dropdownItemSelector);e&&this.dropdown.highlightOption(e)},onMouseLeave(t){this.dropdown.highlightOption()},onClick(t){if(0==t.button&&t.target!=this.DOM.dropdown&&t.target!=this.DOM.dropdown.content){var e=t.target.closest(this.settings.classNames.dropdownItemSelector),i=this.dropdown.getSuggestionDataByNode(e);this.state.actions.selectOption=!0,setTimeout((()=>this.state.actions.selectOption=!1),50),this.settings.hooks.suggestionClick(t,{tagify:this,tagData:i,suggestionElm:e}).then((()=>{e?this.dropdown.selectOption(e,t):this.dropdown.hide()})).catch((t=>console.warn(t)))}},onScroll(t){var e=t.target,i=e.scrollTop/(e.scrollHeight-e.parentNode.clientHeight)*100;this.trigger(\"dropdown:scroll\",{percentage:Math.round(i)})}}},getSuggestionDataByNode(t){var e=t&&t.getAttribute(\"value\");return this.suggestedListItems.find((t=>t.value==e))||null},getNextOrPrevOption(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var i=this.dropdown.getAllSuggestionsRefs(),s=i.findIndex((e=>e===t));return e?i[s+1]:i[s-1]},highlightOption(t,e){var i,s=this.settings.classNames.dropdownItemActive;if(this.state.ddItemElm&&(this.state.ddItemElm.classList.remove(s),this.state.ddItemElm.removeAttribute(\"aria-selected\")),!t)return this.state.ddItemData=null,this.state.ddItemElm=null,void this.input.autocomplete.suggest.call(this);i=this.dropdown.getSuggestionDataByNode(t),this.state.ddItemData=i,this.state.ddItemElm=t,t.classList.add(s),t.setAttribute(\"aria-selected\",!0),e&&(t.parentNode.scrollTop=t.clientHeight+t.offsetTop-t.parentNode.clientHeight),this.settings.autoComplete&&(this.input.autocomplete.suggest.call(this,i),this.dropdown.position())},selectOption(t,e){var i=this.settings.dropdown,s=i.clearOnSelect,a=i.closeOnSelect;if(!t)return this.addTags(this.state.inputText,!0),void(a&&this.dropdown.hide());e=e||{};var n=t.getAttribute(\"value\"),o=\"noMatch\"==n,r=this.suggestedListItems.find((t=>(t.value??t)==n));this.trigger(\"dropdown:select\",{data:r,elm:t,event:e}),n&&(r||o)?(this.state.editing?this.onEditTagDone(null,g({__isValid:!0},this.normalizeTags([r])[0])):this[\"mix\"==this.settings.mode?\"addMixTags\":\"addTags\"]([r||this.input.raw.call(this)],s),this.DOM.input.parentNode&&(setTimeout((()=>{this.DOM.input.focus(),this.toggleFocusClass(!0)})),a&&setTimeout(this.dropdown.hide.bind(this)),t.addEventListener(\"transitionend\",(()=>{this.dropdown.fillHeaderFooter(),setTimeout((()=>t.remove()),100)}),{once:!0}),t.classList.add(this.settings.classNames.dropdownItemHidden))):a&&setTimeout(this.dropdown.hide.bind(this))},selectAll(t){this.suggestedListItems.length=0,this.dropdown.hide(),this.dropdown.filterListItems(\"\");var e=this.dropdown.filterListItems(\"\");return t||(e=this.state.dropdown.suggestions),this.addTags(e,!0),this},filterListItems(t,e){var i,s,a,n,o,r=this.settings,l=r.dropdown,d=(e=e||{},[]),g=[],p=r.whitelist,u=l.maxItems>=0?l.maxItems:1/0,m=l.searchKeys,v=0;if(!(t=\"select\"==r.mode&&this.value.length&&this.value[0][r.tagTextProp]==t?\"\":t)||!m.length)return d=l.includeSelectedTags?p:p.filter((t=>!this.isTagDuplicate(h(t)?t.value:t))),this.state.dropdown.suggestions=d,d.slice(0,u);function f(t,e){return e.toLowerCase().split(\" \").every((e=>t.includes(e.toLowerCase())))}for(o=l.caseSensitive?\"\"+t:(\"\"+t).toLowerCase();v<p.length;v++){let t,r;i=p[v]instanceof Object?p[v]:{value:p[v]};let u=!Object.keys(i).some((t=>m.includes(t)))?[\"value\"]:m;l.fuzzySearch&&!e.exact?(a=u.reduce(((t,e)=>t+\" \"+(i[e]||\"\")),\"\").toLowerCase().trim(),l.accentedSearch&&(a=c(a),o=c(o)),t=0==a.indexOf(o),r=a===o,s=f(a,o)):(t=!0,s=u.some((t=>{var s=\"\"+(i[t]||\"\");return l.accentedSearch&&(s=c(s),o=c(o)),l.caseSensitive||(s=s.toLowerCase()),r=s===o,e.exact?s===o:0==s.indexOf(o)}))),n=!l.includeSelectedTags&&this.isTagDuplicate(h(i)?i.value:i),s&&!n&&(r&&t?g.push(i):\"startsWith\"==l.sortby&&t?d.unshift(i):d.push(i))}return this.state.dropdown.suggestions=g.concat(d),\"function\"==typeof l.sortby?l.sortby(g.concat(d),o):g.concat(d).slice(0,u)},getMappedValue(t){var e=this.settings.dropdown.mapValueTo;return e?\"function\"==typeof e?e(t):t[e]||t.value:t.value},createListHTML(t){return g([],t).map(((t,i)=>{\"string\"!=typeof t&&\"number\"!=typeof t||(t={value:t});var s=this.dropdown.getMappedValue(t);return s=\"string\"==typeof s?d(s):s,this.settings.templates.dropdownItem.apply(this,[e(e({},t),{},{mappedValue:s}),this])})).join(\"\")}};const x=\"@yaireo/tagify/\";var O,D={empty:\"empty\",exceed:\"number of tags exceeded\",pattern:\"pattern mismatch\",duplicate:\"already exists\",notAllowed:\"not allowed\"},M={wrapper:(t,e)=>`<tags class=\"${e.classNames.namespace} ${e.mode?`${e.classNames[e.mode+\"Mode\"]}`:\"\"} ${t.className}\"\\n                    ${e.readonly?\"readonly\":\"\"}\\n                    ${e.disabled?\"disabled\":\"\"}\\n                    ${e.required?\"required\":\"\"}\\n                    ${\"select\"===e.mode?\"spellcheck='false'\":\"\"}\\n                    tabIndex=\"-1\">\\n            <span ${!e.readonly&&e.userInput?\"contenteditable\":\"\"} tabIndex=\"0\" data-placeholder=\"${e.placeholder||\"&#8203;\"}\" aria-placeholder=\"${e.placeholder||\"\"}\"\\n                class=\"${e.classNames.input}\"\\n                role=\"textbox\"\\n                aria-autocomplete=\"both\"\\n                aria-multiline=\"${\"mix\"==e.mode}\"></span>\\n                &#8203;\\n        </tags>`,tag(t,e){let i=e.settings;return`<tag title=\"${t.title||t.value}\"\\n                    contenteditable='false'\\n                    spellcheck='false'\\n                    tabIndex=\"${i.a11y.focusableTags?0:-1}\"\\n                    class=\"${i.classNames.tag} ${t.class||\"\"}\"\\n                    ${this.getAttributes(t)}>\\n            <x title='' class=\"${i.classNames.tagX}\" role='button' aria-label='remove tag'></x>\\n            <div>\\n                <span class=\"${i.classNames.tagText}\">${t[i.tagTextProp]||t.value}</span>\\n            </div>\\n        </tag>`},dropdown(t){var e=t.dropdown,i=\"manual\"==e.position,s=`${t.classNames.dropdown}`;return`<div class=\"${i?\"\":s} ${e.classname}\" role=\"listbox\" aria-labelledby=\"dropdown\">\\n                    <div data-selector='tagify-suggestions-wrapper' class=\"${t.classNames.dropdownWrapper}\"></div>\\n                </div>`},dropdownContent(t){var e=this.settings,i=this.state.dropdown.suggestions;return`\\n            ${e.templates.dropdownHeader.call(this,i)}\\n            ${t}\\n            ${e.templates.dropdownFooter.call(this,i)}\\n        `},dropdownItem(t){return`<div ${this.getAttributes(t)}\\n                    class='${this.settings.classNames.dropdownItem} ${t.class?t.class:\"\"}'\\n                    tabindex=\"0\"\\n                    role=\"option\">${t.mappedValue||t.value}</div>`},dropdownHeader(t){return`<header data-selector='tagify-suggestions-header' class=\"${this.settings.classNames.dropdownHeader}\"></header>`},dropdownFooter(t){var e=t.length-this.settings.dropdown.maxItems;return e>0?`<footer data-selector='tagify-suggestions-footer' class=\"${this.settings.classNames.dropdownFooter}\">\\n                ${e} more items. Refine your search.\\n            </footer>`:\"\"},dropdownItemNoMatch:null};var I={customBinding(){this.customEventsList.forEach((t=>{this.on(t,this.settings.callbacks[t])}))},binding(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];var e,i=this.events.callbacks,s=t?\"addEventListener\":\"removeEventListener\";if(!this.state.mainEvents||!t){for(var a in this.state.mainEvents=t,t&&!this.listeners.main&&(this.events.bindGlobal.call(this),this.settings.isJQueryPlugin&&jQuery(this.DOM.originalInput).on(\"tagify.removeAllTags\",this.removeAllTags.bind(this))),e=this.listeners.main=this.listeners.main||{focus:[\"input\",i.onFocusBlur.bind(this)],keydown:[\"input\",i.onKeydown.bind(this)],click:[\"scope\",i.onClickScope.bind(this)],dblclick:[\"scope\",i.onDoubleClickScope.bind(this)],paste:[\"input\",i.onPaste.bind(this)],drop:[\"input\",i.onDrop.bind(this)],compositionstart:[\"input\",i.onCompositionStart.bind(this)],compositionend:[\"input\",i.onCompositionEnd.bind(this)]})this.DOM[e[a][0]][s](a,e[a][1]);clearInterval(this.listeners.main.originalInputValueObserverInterval),this.listeners.main.originalInputValueObserverInterval=setInterval(i.observeOriginalInputValue.bind(this),500);var n=this.listeners.main.inputMutationObserver||new MutationObserver(i.onInputDOMChange.bind(this));n.disconnect(),\"mix\"==this.settings.mode&&n.observe(this.DOM.input,{childList:!0})}},bindGlobal(t){var e,i=this.events.callbacks,s=t?\"removeEventListener\":\"addEventListener\";if(this.listeners&&(t||!this.listeners.global))for(e of(this.listeners.global=this.listeners.global||[{type:this.isIE?\"keydown\":\"input\",target:this.DOM.input,cb:i[this.isIE?\"onInputIE\":\"onInput\"].bind(this)},{type:\"keydown\",target:window,cb:i.onWindowKeyDown.bind(this)},{type:\"blur\",target:this.DOM.input,cb:i.onFocusBlur.bind(this)},{type:\"click\",target:document,cb:i.onClickAnywhere.bind(this)}],this.listeners.global))e.target[s](e.type,e.cb)},unbindGlobal(){this.events.bindGlobal.call(this,!0)},callbacks:{onFocusBlur(t){var e=this.settings,i=t.target?this.trim(t.target.textContent):\"\",s=this.value?.[0]?.[e.tagTextProp],a=t.type,n=e.dropdown.enabled>=0,o={relatedTarget:t.relatedTarget},r=this.state.actions.selectOption&&(n||!e.dropdown.closeOnSelect),l=this.state.actions.addNew&&n,d=t.relatedTarget&&v.call(this,t.relatedTarget)&&this.DOM.scope.contains(t.relatedTarget);if(\"blur\"==a){if(t.relatedTarget===this.DOM.scope)return this.dropdown.hide(),void this.DOM.input.focus();this.postUpdate(),e.onChangeAfterBlur&&this.triggerChangeEvent()}if(!r&&!l)if(this.state.hasFocus=\"focus\"==a&&+new Date,this.toggleFocusClass(this.state.hasFocus),\"mix\"!=e.mode){if(\"focus\"==a)return this.trigger(\"focus\",o),void(0!==e.dropdown.enabled&&e.userInput||this.dropdown.show(this.value.length?\"\":void 0));\"blur\"==a&&(this.trigger(\"blur\",o),this.loading(!1),\"select\"==e.mode&&(d&&(this.removeTags(),i=\"\"),s===i&&(i=\"\")),i&&!this.state.actions.selectOption&&e.addTagOnBlur&&this.addTags(i,!0)),this.DOM.input.removeAttribute(\"style\"),this.dropdown.hide()}else\"focus\"==a?this.trigger(\"focus\",o):\"blur\"==t.type&&(this.trigger(\"blur\",o),this.loading(!1),this.dropdown.hide(),this.state.dropdown.visible=void 0,this.setStateSelection())},onCompositionStart(t){this.state.composing=!0},onCompositionEnd(t){this.state.composing=!1},onWindowKeyDown(t){var e,i=document.activeElement,s=v.call(this,i)&&this.DOM.scope.contains(document.activeElement),a=s&&i.hasAttribute(\"readonly\");if(s&&!a)switch(e=i.nextElementSibling,t.key){case\"Backspace\":this.settings.readonly||(this.removeTags(i),(e||this.DOM.input).focus());break;case\"Enter\":setTimeout(this.editTag.bind(this),0,i)}},onKeydown(t){var e=this.settings;if(!this.state.composing&&e.userInput){\"select\"==e.mode&&e.enforceWhitelist&&this.value.length&&\"Tab\"!=t.key&&t.preventDefault();var i=this.trim(t.target.textContent);if(this.trigger(\"keydown\",{event:t}),\"mix\"==e.mode){switch(t.key){case\"Left\":case\"ArrowLeft\":this.state.actions.ArrowLeft=!0;break;case\"Delete\":case\"Backspace\":if(this.state.editing)return;var s=document.getSelection(),a=\"Delete\"==t.key&&s.anchorOffset==(s.anchorNode.length||0),n=s.anchorNode.previousSibling,r=1==s.anchorNode.nodeType||!s.anchorOffset&&n&&1==n.nodeType&&s.anchorNode.previousSibling;o(this.DOM.input.innerHTML);var d,h,g,p=this.getTagElms();if(\"edit\"==e.backspace&&r)return d=1==s.anchorNode.nodeType?null:s.anchorNode.previousElementSibling,setTimeout(this.editTag.bind(this),0,d),void t.preventDefault();if(u()&&r instanceof Element)return g=l(r),r.hasAttribute(\"readonly\")||r.remove(),this.DOM.input.focus(),void setTimeout((()=>{this.placeCaretAfterNode(g),this.DOM.input.click()}));if(\"BR\"==s.anchorNode.nodeName)return;if((a||r)&&1==s.anchorNode.nodeType?h=0==s.anchorOffset?a?p[0]:null:p[Math.min(p.length,s.anchorOffset)-1]:a?h=s.anchorNode.nextElementSibling:r instanceof Element&&(h=r),3==s.anchorNode.nodeType&&!s.anchorNode.nodeValue&&s.anchorNode.previousElementSibling&&t.preventDefault(),(r||a)&&!e.backspace)return void t.preventDefault();if(\"Range\"!=s.type&&!s.anchorOffset&&s.anchorNode==this.DOM.input&&\"Delete\"!=t.key)return void t.preventDefault();if(\"Range\"!=s.type&&h&&h.hasAttribute(\"readonly\"))return void this.placeCaretAfterNode(l(h));clearTimeout(O),O=setTimeout((()=>{var t=document.getSelection();o(this.DOM.input.innerHTML),!a&&t.anchorNode.previousSibling,this.value=[].map.call(p,((t,e)=>{var i=T(t);if(t.parentNode||i.readonly)return i;this.trigger(\"remove\",{tag:t,index:e,data:i})})).filter((t=>t))}),20)}return!0}switch(t.key){case\"Backspace\":\"select\"==e.mode&&e.enforceWhitelist&&this.value.length?this.removeTags():this.state.dropdown.visible&&\"manual\"!=e.dropdown.position||\"\"!=t.target.textContent&&8203!=i.charCodeAt(0)||(!0===e.backspace?this.removeTags():\"edit\"==e.backspace&&setTimeout(this.editTag.bind(this),0));break;case\"Esc\":case\"Escape\":if(this.state.dropdown.visible)return;t.target.blur();break;case\"Down\":case\"ArrowDown\":this.state.dropdown.visible||this.dropdown.show();break;case\"ArrowRight\":{let t=this.state.inputSuggestion||this.state.ddItemData;if(t&&e.autoComplete.rightKey)return void this.addTags([t],!0);break}case\"Tab\":{let s=\"select\"==e.mode;if(!i||s)return!0;t.preventDefault()}case\"Enter\":if(this.state.dropdown.visible&&\"manual\"!=e.dropdown.position)return;t.preventDefault(),setTimeout((()=>{this.state.dropdown.visible||this.state.actions.selectOption||this.addTags(i,!0)}))}}},onInput(t){this.postUpdate();var e=this.settings;if(\"mix\"==e.mode)return this.events.callbacks.onMixTagsInput.call(this,t);var i=this.input.normalize.call(this),s=i.length>=e.dropdown.enabled,a={value:i,inputElm:this.DOM.input},n=this.validateTag({value:i});\"select\"==e.mode&&this.toggleScopeValidation(n),a.isValid=n,this.state.inputText!=i&&(this.input.set.call(this,i,!1),-1!=i.search(e.delimiters)?this.addTags(i)&&this.input.set.call(this):e.dropdown.enabled>=0&&this.dropdown[s?\"show\":\"hide\"](i),this.trigger(\"input\",a))},onMixTagsInput(t){var e,i,s,a,n,o,r,l,d=this.settings,h=this.value.length,p=this.getTagElms(),c=document.createDocumentFragment(),m=window.getSelection().getRangeAt(0),v=[].map.call(p,(t=>T(t).value));if(\"deleteContentBackward\"==t.inputType&&u()&&this.events.callbacks.onKeydown.call(this,{target:t.target,key:\"Backspace\"}),this.value.slice().forEach((t=>{t.readonly&&!v.includes(t.value)&&c.appendChild(this.createTagElem(t))})),c.childNodes.length&&(m.insertNode(c),this.setRangeAtStartEnd(!1,c.lastChild)),p.length!=h)return this.value=[].map.call(this.getTagElms(),(t=>T(t))),void this.update({withoutChangeEvent:!0});if(this.hasMaxTags())return!0;if(window.getSelection&&(o=window.getSelection()).rangeCount>0&&3==o.anchorNode.nodeType){if((m=o.getRangeAt(0).cloneRange()).collapse(!0),m.setStart(o.focusNode,0),s=(e=m.toString().slice(0,m.endOffset)).split(d.pattern).length-1,(i=e.match(d.pattern))&&(a=e.slice(e.lastIndexOf(i[i.length-1]))),a){if(this.state.actions.ArrowLeft=!1,this.state.tag={prefix:a.match(d.pattern)[0],value:a.replace(d.pattern,\"\")},this.state.tag.baseOffset=o.baseOffset-this.state.tag.value.length,l=this.state.tag.value.match(d.delimiters))return this.state.tag.value=this.state.tag.value.replace(d.delimiters,\"\"),this.state.tag.delimiters=l[0],this.addTags(this.state.tag.value,d.dropdown.clearOnSelect),void this.dropdown.hide();n=this.state.tag.value.length>=d.dropdown.enabled;try{r=(r=this.state.flaggedTags[this.state.tag.baseOffset]).prefix==this.state.tag.prefix&&r.value[0]==this.state.tag.value[0],this.state.flaggedTags[this.state.tag.baseOffset]&&!this.state.tag.value&&delete this.state.flaggedTags[this.state.tag.baseOffset]}catch(t){}(r||s<this.state.mixMode.matchedPatternCount)&&(n=!1)}else this.state.flaggedTags={};this.state.mixMode.matchedPatternCount=s}setTimeout((()=>{this.update({withoutChangeEvent:!0}),this.trigger(\"input\",g({},this.state.tag,{textContent:this.DOM.input.textContent})),this.state.tag&&this.dropdown[n?\"show\":\"hide\"](this.state.tag.value)}),10)},onInputIE(t){var e=this;setTimeout((function(){e.events.callbacks.onInput.call(e,t)}))},observeOriginalInputValue(){this.DOM.originalInput.parentNode||this.destroy(),this.DOM.originalInput.value!=this.DOM.originalInput.tagifyValue&&this.loadOriginalValues()},onClickAnywhere(t){t.target==this.DOM.scope||this.DOM.scope.contains(t.target)||(this.toggleFocusClass(!1),this.state.hasFocus=!1)},onClickScope(t){var e=this.settings,i=t.target.closest(\".\"+e.classNames.tag),s=+new Date-this.state.hasFocus;if(t.target!=this.DOM.scope){if(!t.target.classList.contains(e.classNames.tagX))return i?(this.trigger(\"click\",{tag:i,index:this.getNodeIndex(i),data:T(i),event:t}),void(1!==e.editTags&&1!==e.editTags.clicks||this.events.callbacks.onDoubleClickScope.call(this,t))):void(t.target==this.DOM.input&&(\"mix\"==e.mode&&this.fixFirefoxLastTagNoCaret(),s>500)?this.state.dropdown.visible?this.dropdown.hide():0===e.dropdown.enabled&&\"mix\"!=e.mode&&this.dropdown.show(this.value.length?\"\":void 0):\"select\"!=e.mode||0!==e.dropdown.enabled||this.state.dropdown.visible||this.dropdown.show());this.removeTags(t.target.parentNode)}else this.DOM.input.focus()},onPaste(t){t.preventDefault();var e,i,s=this.settings;if(\"select\"==s.mode&&s.enforceWhitelist||!s.userInput)return!1;s.readonly||(e=t.clipboardData||window.clipboardData,i=e.getData(\"Text\"),s.hooks.beforePaste(t,{tagify:this,pastedText:i,clipboardData:e}).then((e=>{void 0===e&&(e=i),e&&(this.injectAtCaret(e,window.getSelection().getRangeAt(0)),\"mix\"==this.settings.mode?this.events.callbacks.onMixTagsInput.call(this,t):this.settings.pasteAsTags?this.addTags(this.state.inputText+e,!0):this.state.inputText=e)})).catch((t=>t)))},onDrop(t){t.preventDefault()},onEditTagInput(t,e){var i=t.closest(\".\"+this.settings.classNames.tag),s=this.getNodeIndex(i),a=T(i),n=this.input.normalize.call(this,t),o={[this.settings.tagTextProp]:n,__tagId:a.__tagId},r=this.validateTag(o);this.editTagChangeDetected(g(a,o))||!0!==t.originalIsValid||(r=!0),i.classList.toggle(this.settings.classNames.tagInvalid,!0!==r),a.__isValid=r,i.title=!0===r?a.title||a.value:r,n.length>=this.settings.dropdown.enabled&&(this.state.editing&&(this.state.editing.value=n),this.dropdown.show(n)),this.trigger(\"edit:input\",{tag:i,index:s,data:g({},this.value[s],{newValue:n}),event:e})},onEditTagPaste(t,e){var i=(e.clipboardData||window.clipboardData).getData(\"Text\");e.preventDefault();var s=f(i);this.setRangeAtStartEnd(!1,s)},onEditTagFocus(t){this.state.editing={scope:t,input:t.querySelector(\"[contenteditable]\")}},onEditTagBlur(t){if(this.state.hasFocus||this.toggleFocusClass(),this.DOM.scope.contains(t)){var e,i,s=this.settings,a=t.closest(\".\"+s.classNames.tag),n=T(a),o=this.input.normalize.call(this,t),r={[s.tagTextProp]:o,__tagId:n.__tagId},l=n.__originalData,d=this.editTagChangeDetected(g(n,r)),h=this.validateTag(r);if(o)if(d){if(e=this.hasMaxTags(),i=g({},l,{[s.tagTextProp]:this.trim(o),__isValid:h}),s.transformTag.call(this,i,l),!0!==(h=(!e||!0===l.__isValid)&&this.validateTag(i))){if(this.trigger(\"invalid\",{data:i,tag:a,message:h}),s.editTags.keepInvalid)return;s.keepInvalidTags?i.__isValid=h:i=l}else s.keepInvalidTags&&(delete i.title,delete i[\"aria-invalid\"],delete i.class);this.onEditTagDone(a,i)}else this.onEditTagDone(a,l);else this.onEditTagDone(a)}},onEditTagkeydown(t,e){if(!this.state.composing)switch(this.trigger(\"edit:keydown\",{event:t}),t.key){case\"Esc\":case\"Escape\":e.parentNode.replaceChild(e.__tagifyTagData.__originalHTML,e),this.state.editing=!1;case\"Enter\":case\"Tab\":t.preventDefault(),t.target.blur()}},onDoubleClickScope(t){var e,i,s=t.target.closest(\".\"+this.settings.classNames.tag),a=T(s),n=this.settings;s&&n.userInput&&!1!==a.editable&&(e=s.classList.contains(this.settings.classNames.tagEditing),i=s.hasAttribute(\"readonly\"),\"select\"==n.mode||n.readonly||e||i||!this.settings.editTags||this.editTag(s),this.toggleFocusClass(!0),this.trigger(\"dblclick\",{tag:s,index:this.getNodeIndex(s),data:T(s)}))},onInputDOMChange(t){t.forEach((t=>{t.addedNodes.forEach((t=>{if(\"<div><br></div>\"==t.outerHTML)t.replaceWith(document.createElement(\"br\"));else if(1==t.nodeType&&t.querySelector(this.settings.classNames.tagSelector)){let e=document.createTextNode(\"\");3==t.childNodes[0].nodeType&&\"BR\"!=t.previousSibling.nodeName&&(e=document.createTextNode(\"\\n\")),t.replaceWith(e,...[...t.childNodes].slice(0,-1)),this.placeCaretAfterNode(e)}else if(v.call(this,t)&&(3!=t.previousSibling?.nodeType||t.previousSibling.textContent||t.previousSibling.remove(),t.previousSibling&&\"BR\"==t.previousSibling.nodeName)){t.previousSibling.replaceWith(\"\\nâ\");let e=t.nextSibling,i=\"\";for(;e;)i+=e.textContent,e=e.nextSibling;i.trim()&&this.placeCaretAfterNode(t.previousSibling)}})),t.removedNodes.forEach((t=>{t&&\"BR\"==t.nodeName&&v.call(this,e)&&(this.removeTags(e),this.fixFirefoxLastTagNoCaret())}))}));var e=this.DOM.input.lastChild;e&&\"\"==e.nodeValue&&e.remove(),e&&\"BR\"==e.nodeName||this.DOM.input.appendChild(document.createElement(\"br\"))}}};function N(t,e){if(!t){console.warn(\"Tagify:\",\"input element not found\",t);const e=new Proxy(this,{get:()=>()=>e});return e}if(t.__tagify)return console.warn(\"Tagify: \",\"input element is already Tagified - Same instance is returned.\",t),t.__tagify;var i;g(this,function(t){var e=document.createTextNode(\"\");function i(t,i,s){s&&i.split(/\\s+/g).forEach((i=>e[t+\"EventListener\"].call(e,i,s)))}return{off(t,e){return i(\"remove\",t,e),this},on(t,e){return e&&\"function\"==typeof e&&i(\"add\",t,e),this},trigger(i,s,a){var n;if(a=a||{cloneData:!0},i)if(t.settings.isJQueryPlugin)\"remove\"==i&&(i=\"removeTag\"),jQuery(t.DOM.originalInput).triggerHandler(i,[s]);else{try{var o=\"object\"==typeof s?s:{value:s};if((o=a.cloneData?g({},o):o).tagify=this,s.event&&(o.event=this.cloneEvent(s.event)),s instanceof Object)for(var r in s)s[r]instanceof HTMLElement&&(o[r]=s[r]);n=new CustomEvent(i,{detail:o})}catch(t){console.warn(t)}e.dispatchEvent(n)}}}}(this)),this.isFirefox=/firefox|fxios/i.test(navigator.userAgent)&&!/seamonkey/i.test(navigator.userAgent),this.isIE=window.document.documentMode,e=e||{},this.getPersistedData=(i=e.id,t=>{let e,s=\"/\"+t;if(1==localStorage.getItem(x+i+\"/v\",1))try{e=JSON.parse(localStorage[x+i+s])}catch(t){}return e}),this.setPersistedData=(t=>t?(localStorage.setItem(x+t+\"/v\",1),(e,i)=>{let s=\"/\"+i,a=JSON.stringify(e);e&&i&&(localStorage.setItem(x+t+s,a),dispatchEvent(new Event(\"storage\")))}):()=>{})(e.id),this.clearPersistedData=(t=>e=>{const i=x+\"/\"+t+\"/\";if(e)localStorage.removeItem(i+e);else for(let t in localStorage)t.includes(i)&&localStorage.removeItem(t)})(e.id),this.applySettings(t,e),this.state={inputText:\"\",editing:!1,composing:!1,actions:{},mixMode:{},dropdown:{},flaggedTags:{}},this.value=[],this.listeners={},this.DOM={},this.build(t),b.call(this),this.getCSSVars(),this.loadOriginalValues(),this.events.customBinding.call(this),this.events.binding.call(this),t.autofocus&&this.DOM.input.focus(),t.__tagify=this}return N.prototype={_dropdown:y,getSetTagData:T,helpers:{sameStr:s,removeCollectionProp:a,omit:n,isObject:h,parseHTML:r,escapeHTML:d,extend:g,concatWithoutDups:p,getUID:m,isNodeTag:v},customEventsList:[\"change\",\"add\",\"remove\",\"invalid\",\"input\",\"click\",\"keydown\",\"focus\",\"blur\",\"edit:input\",\"edit:beforeUpdate\",\"edit:updated\",\"edit:start\",\"edit:keydown\",\"dropdown:show\",\"dropdown:hide\",\"dropdown:select\",\"dropdown:updated\",\"dropdown:noMatch\",\"dropdown:scroll\"],dataProps:[\"__isValid\",\"__removed\",\"__originalData\",\"__originalHTML\",\"__tagId\"],trim(t){return this.settings.trim&&t&&\"string\"==typeof t?t.trim():t},parseHTML:r,templates:M,parseTemplate(t,e){return r((t=this.settings.templates[t]||t).apply(this,e))},set whitelist(t){const e=t&&Array.isArray(t);this.settings.whitelist=e?t:[],this.setPersistedData(e?t:[],\"whitelist\")},get whitelist(){return this.settings.whitelist},generateClassSelectors(t){for(let e in t){let i=e;Object.defineProperty(t,i+\"Selector\",{get(){return\".\"+this[i].split(\" \")[0]}})}},applySettings(t,i){w.templates=this.templates;var s=g({},w,\"mix\"==i.mode?{dropdown:{position:\"text\"}}:{}),a=this.settings=g({},s,i);if(a.disabled=t.hasAttribute(\"disabled\"),a.readonly=a.readonly||t.hasAttribute(\"readonly\"),a.placeholder=d(t.getAttribute(\"placeholder\")||a.placeholder||\"\"),a.required=t.hasAttribute(\"required\"),this.generateClassSelectors(a.classNames),void 0===a.dropdown.includeSelectedTags&&(a.dropdown.includeSelectedTags=a.duplicates),this.isIE&&(a.autoComplete=!1),[\"whitelist\",\"blacklist\"].forEach((e=>{var i=t.getAttribute(\"data-\"+e);i&&(i=i.split(a.delimiters))instanceof Array&&(a[e]=i)})),\"autoComplete\"in i&&!h(i.autoComplete)&&(a.autoComplete=w.autoComplete,a.autoComplete.enabled=i.autoComplete),\"mix\"==a.mode&&(a.pattern=a.pattern||/@/,a.autoComplete.rightKey=!0,a.delimiters=i.delimiters||null,a.tagTextProp&&!a.dropdown.searchKeys.includes(a.tagTextProp)&&a.dropdown.searchKeys.push(a.tagTextProp)),t.pattern)try{a.pattern=new RegExp(t.pattern)}catch(t){}if(a.delimiters){a._delimiters=a.delimiters;try{a.delimiters=new RegExp(this.settings.delimiters,\"g\")}catch(t){}}a.disabled&&(a.userInput=!1),this.TEXTS=e(e({},D),a.texts||{}),(\"select\"!=a.mode||i.dropdown?.enabled)&&a.userInput||(a.dropdown.enabled=0),a.dropdown.appendTarget=i.dropdown?.appendTarget||document.body;let n=this.getPersistedData(\"whitelist\");Array.isArray(n)&&(this.whitelist=Array.isArray(a.whitelist)?p(a.whitelist,n):n)},getAttributes(t){var e,i=this.getCustomAttributes(t),s=\"\";for(e in i)s+=\" \"+e+(void 0!==t[e]?`=\"${i[e]}\"`:\"\");return s},getCustomAttributes(t){if(!h(t))return\"\";var e,i={};for(e in t)\"__\"!=e.slice(0,2)&&\"class\"!=e&&t.hasOwnProperty(e)&&void 0!==t[e]&&(i[e]=d(t[e]));return i},setStateSelection(){var t=window.getSelection(),e={anchorOffset:t.anchorOffset,anchorNode:t.anchorNode,range:t.getRangeAt&&t.rangeCount&&t.getRangeAt(0)};return this.state.selection=e,e},getCSSVars(){var t=getComputedStyle(this.DOM.scope,null);var e;this.CSSVars={tagHideTransition:(t=>{let e=t.value;return\"s\"==t.unit?1e3*e:e})(function(t){if(!t)return{};var e=(t=t.trim().split(\" \")[0]).split(/\\d+/g).filter((t=>t)).pop().trim();return{value:+t.split(e).filter((t=>t))[0].trim(),unit:e}}((e=\"tag-hide-transition\",t.getPropertyValue(\"--\"+e))))}},build(t){var e=this.DOM;this.settings.mixMode.integrated?(e.originalInput=null,e.scope=t,e.input=t):(e.originalInput=t,e.originalInput_tabIndex=t.tabIndex,e.scope=this.parseTemplate(\"wrapper\",[t,this.settings]),e.input=e.scope.querySelector(this.settings.classNames.inputSelector),t.parentNode.insertBefore(e.scope,t),t.tabIndex=-1)},destroy(){this.events.unbindGlobal.call(this),this.DOM.scope.parentNode.removeChild(this.DOM.scope),this.DOM.originalInput.tabIndex=this.DOM.originalInput_tabIndex,delete this.DOM.originalInput.__tagify,this.dropdown.hide(!0),clearTimeout(this.dropdownHide__bindEventsTimeout),clearInterval(this.listeners.main.originalInputValueObserverInterval)},loadOriginalValues(t){var e,i=this.settings;if(this.state.blockChangeEvent=!0,void 0===t){const e=this.getPersistedData(\"value\");t=e&&!this.DOM.originalInput.value?e:i.mixMode.integrated?this.DOM.input.textContent:this.DOM.originalInput.value}if(this.removeAllTags(),t)if(\"mix\"==i.mode)this.parseMixTags(t),(e=this.DOM.input.lastChild)&&\"BR\"==e.tagName||this.DOM.input.insertAdjacentHTML(\"beforeend\",\"<br>\");else{try{JSON.parse(t)instanceof Array&&(t=JSON.parse(t))}catch(t){}this.addTags(t,!0).forEach((t=>t&&t.classList.add(i.classNames.tagNoAnimation)))}else this.postUpdate();this.state.lastOriginalValueReported=i.mixMode.integrated?\"\":this.DOM.originalInput.value},cloneEvent(t){var e={};for(var i in t)\"path\"!=i&&(e[i]=t[i]);return e},loading(t){return this.state.isLoading=t,this.DOM.scope.classList[t?\"add\":\"remove\"](this.settings.classNames.scopeLoading),this},tagLoading(t,e){return t&&t.classList[e?\"add\":\"remove\"](this.settings.classNames.tagLoading),this},toggleClass(t,e){\"string\"==typeof t&&this.DOM.scope.classList.toggle(t,e)},toggleScopeValidation(t){var e=!0===t||void 0===t;!this.settings.required&&t&&t===this.TEXTS.empty&&(e=!0),this.toggleClass(this.settings.classNames.tagInvalid,!e),this.DOM.scope.title=e?\"\":t},toggleFocusClass(t){this.toggleClass(this.settings.classNames.focus,!!t)},triggerChangeEvent:function(){if(!this.settings.mixMode.integrated){var t=this.DOM.originalInput,e=this.state.lastOriginalValueReported!==t.value,i=new CustomEvent(\"change\",{bubbles:!0});e&&(this.state.lastOriginalValueReported=t.value,i.simulated=!0,t._valueTracker&&t._valueTracker.setValue(Math.random()),t.dispatchEvent(i),this.trigger(\"change\",this.state.lastOriginalValueReported),t.value=this.state.lastOriginalValueReported)}},events:I,fixFirefoxLastTagNoCaret(){},setRangeAtStartEnd(t,e){if(e){t=\"number\"==typeof t?t:!!t,e=e.lastChild||e;var i=document.getSelection();if(i.focusNode instanceof Element&&!this.DOM.input.contains(i.focusNode))return!0;try{i.rangeCount>=1&&[\"Start\",\"End\"].forEach((s=>i.getRangeAt(0)[\"set\"+s](e,t||e.length)))}catch(t){}}},placeCaretAfterNode(t){if(t&&t.parentNode){var e=t,i=window.getSelection(),s=i.getRangeAt(0);i.rangeCount&&(s.setStartAfter(e),s.collapse(!0),i.removeAllRanges(),i.addRange(s))}},insertAfterTag(t,e){if(e=e||this.settings.mixMode.insertAfterTag,t&&t.parentNode&&e)return e=\"string\"==typeof e?document.createTextNode(e):e,t.parentNode.insertBefore(e,t.nextSibling),e},editTagChangeDetected(t){var e=t.__originalData;for(var i in e)if(!this.dataProps.includes(i)&&t[i]!=e[i])return!0;return!1},getTagTextNode(t){return t.querySelector(this.settings.classNames.tagTextSelector)},setTagTextNode(t,e){this.getTagTextNode(t).innerHTML=d(e)},editTag(t,e){t=t||this.getLastTag(),e=e||{},this.dropdown.hide();var i=this.settings,s=this.getTagTextNode(t),a=this.getNodeIndex(t),n=T(t),o=this.events.callbacks,r=this,l=!0;if(s){if(!(n instanceof Object&&\"editable\"in n)||n.editable)return n=T(t,{__originalData:g({},n),__originalHTML:t.cloneNode(!0)}),T(n.__originalHTML,n.__originalData),s.setAttribute(\"contenteditable\",!0),t.classList.add(i.classNames.tagEditing),s.addEventListener(\"focus\",o.onEditTagFocus.bind(this,t)),s.addEventListener(\"blur\",(function(){setTimeout((()=>o.onEditTagBlur.call(r,r.getTagTextNode(t))))})),s.addEventListener(\"input\",o.onEditTagInput.bind(this,s)),s.addEventListener(\"paste\",o.onEditTagPaste.bind(this,s)),s.addEventListener(\"keydown\",(e=>o.onEditTagkeydown.call(this,e,t))),s.addEventListener(\"compositionstart\",o.onCompositionStart.bind(this)),s.addEventListener(\"compositionend\",o.onCompositionEnd.bind(this)),e.skipValidation||(l=this.editTagToggleValidity(t)),s.originalIsValid=l,this.trigger(\"edit:start\",{tag:t,index:a,data:n,isValid:l}),s.focus(),this.setRangeAtStartEnd(!1,s),this}else console.warn(\"Cannot find element in Tag template: .\",i.classNames.tagTextSelector)},editTagToggleValidity(t,e){var i;if(e=e||T(t))return(i=!(\"__isValid\"in e)||!0===e.__isValid)||this.removeTagsFromValue(t),this.update(),t.classList.toggle(this.settings.classNames.tagNotAllowed,!i),e.__isValid;console.warn(\"tag has no data: \",t,e)},onEditTagDone(t,e){e=e||{};var i={tag:t=t||this.state.editing.scope,index:this.getNodeIndex(t),previousData:T(t),data:e};this.trigger(\"edit:beforeUpdate\",i,{cloneData:!1}),this.state.editing=!1,delete e.__originalData,delete e.__originalHTML,t&&e[this.settings.tagTextProp]?(t=this.replaceTag(t,e),this.editTagToggleValidity(t,e),this.settings.a11y.focusableTags?t.focus():this.placeCaretAfterNode(t)):t&&this.removeTags(t),this.trigger(\"edit:updated\",i),this.dropdown.hide(),this.settings.keepInvalidTags&&this.reCheckInvalidTags()},replaceTag(t,e){e&&e.value||(e=t.__tagifyTagData),e.__isValid&&1!=e.__isValid&&g(e,this.getInvalidTagAttrs(e,e.__isValid));var i=this.createTagElem(e);return t.parentNode.replaceChild(i,t),this.updateValueByDOMTags(),i},updateValueByDOMTags(){this.value.length=0,[].forEach.call(this.getTagElms(),(t=>{t.classList.contains(this.settings.classNames.tagNotAllowed.split(\" \")[0])||this.value.push(T(t))})),this.update()},injectAtCaret(t,e){return!(e=e||this.state.selection?.range)&&t?(this.appendMixTags(t),this):(f(t,e),this.setRangeAtStartEnd(!1,t),this.updateValueByDOMTags(),this.update(),this)},input:{set(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:\"\",e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var i=this.settings.dropdown.closeOnSelect;this.state.inputText=t,e&&(this.DOM.input.innerHTML=d(\"\"+t)),!t&&i&&this.dropdown.hide.bind(this),this.input.autocomplete.suggest.call(this),this.input.validate.call(this)},raw(){return this.DOM.input.textContent},validate(){var t=!this.state.inputText||!0===this.validateTag({value:this.state.inputText});return this.DOM.input.classList.toggle(this.settings.classNames.inputInvalid,!t),t},normalize(t){var e=t||this.DOM.input,i=[];e.childNodes.forEach((t=>3==t.nodeType&&i.push(t.nodeValue))),i=i.join(\"\\n\");try{i=i.replace(/(?:\\r\\n|\\r|\\n)/g,this.settings.delimiters.source.charAt(0))}catch(t){}return i=i.replace(/\\s/g,\" \"),this.trim(i)},autocomplete:{suggest(t){if(this.settings.autoComplete.enabled){\"string\"==typeof(t=t||{value:\"\"})&&(t={value:t});var e=this.dropdown.getMappedValue(t);if(\"number\"!=typeof e){var i=e.substr(0,this.state.inputText.length).toLowerCase(),s=e.substring(this.state.inputText.length);e&&this.state.inputText&&i==this.state.inputText.toLowerCase()?(this.DOM.input.setAttribute(\"data-suggest\",s),this.state.inputSuggestion=t):(this.DOM.input.removeAttribute(\"data-suggest\"),delete this.state.inputSuggestion)}}},set(t){var e=this.DOM.input.getAttribute(\"data-suggest\"),i=t||(e?this.state.inputText+e:null);return!!i&&(\"mix\"==this.settings.mode?this.replaceTextWithNode(document.createTextNode(this.state.tag.prefix+i)):(this.input.set.call(this,i),this.setRangeAtStartEnd(!1,this.DOM.input)),this.input.autocomplete.suggest.call(this),this.dropdown.hide(),!0)}}},getTagIdx(t){return this.value.findIndex((e=>e.__tagId==(t||{}).__tagId))},getNodeIndex(t){var e=0;if(t)for(;t=t.previousElementSibling;)e++;return e},getTagElms(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var s=\".\"+[...this.settings.classNames.tag.split(\" \"),...e].join(\".\");return[].slice.call(this.DOM.scope.querySelectorAll(s))},getLastTag(){var t=this.DOM.scope.querySelectorAll(`${this.settings.classNames.tagSelector}:not(.${this.settings.classNames.tagHide}):not([readonly])`);return t[t.length-1]},isTagDuplicate(t,e,i){var a=0;if(\"select\"==this.settings.mode)return!1;for(let n of this.value){s(this.trim(\"\"+t),n.value,e)&&i!=n.__tagId&&a++}return a},getTagIndexByValue(t){var e=[];return this.getTagElms().forEach(((i,a)=>{s(this.trim(i.textContent),t,this.settings.dropdown.caseSensitive)&&e.push(a)})),e},getTagElmByValue(t){var e=this.getTagIndexByValue(t)[0];return this.getTagElms()[e]},flashTag(t){t&&(t.classList.add(this.settings.classNames.tagFlash),setTimeout((()=>{t.classList.remove(this.settings.classNames.tagFlash)}),100))},isTagBlacklisted(t){return t=this.trim(t.toLowerCase()),this.settings.blacklist.filter((e=>(\"\"+e).toLowerCase()==t)).length},isTagWhitelisted(t){return!!this.getWhitelistItem(t)},getWhitelistItem(t,e,i){e=e||\"value\";var a,n=this.settings;return(i=i||n.whitelist).some((i=>{var o=\"string\"==typeof i?i:i[e]||i.value;if(s(o,t,n.dropdown.caseSensitive,n.trim))return a=\"string\"==typeof i?{value:i}:i,!0})),a||\"value\"!=e||\"value\"==n.tagTextProp||(a=this.getWhitelistItem(t,n.tagTextProp,i)),a},validateTag(t){var e=this.settings,i=\"value\"in t?\"value\":e.tagTextProp,s=this.trim(t[i]+\"\");return(t[i]+\"\").trim()?e.pattern&&e.pattern instanceof RegExp&&!e.pattern.test(s)?this.TEXTS.pattern:!e.duplicates&&this.isTagDuplicate(s,e.dropdown.caseSensitive,t.__tagId)?this.TEXTS.duplicate:this.isTagBlacklisted(s)||e.enforceWhitelist&&!this.isTagWhitelisted(s)?this.TEXTS.notAllowed:!e.validate||e.validate(t):this.TEXTS.empty},getInvalidTagAttrs(t,e){return{\"aria-invalid\":!0,class:`${t.class||\"\"} ${this.settings.classNames.tagNotAllowed}`.trim(),title:e}},hasMaxTags(){return this.value.length>=this.settings.maxTags&&this.TEXTS.exceed},setReadonly(t,e){var i=this.settings;document.activeElement.blur(),i[e||\"readonly\"]=t,this.DOM.scope[(t?\"set\":\"remove\")+\"Attribute\"](e||\"readonly\",!0),this.setContentEditable(!t)},setContentEditable(t){this.settings.userInput&&(this.DOM.input.contentEditable=t,this.DOM.input.tabIndex=t?0:-1)},setDisabled(t){this.setReadonly(t,\"disabled\")},normalizeTags(t){var e=this.settings,i=e.whitelist,s=e.delimiters,a=e.mode,n=e.tagTextProp,o=[],r=!!i&&i[0]instanceof Object,l=Array.isArray(t),d=l&&t[0].value,h=t=>(t+\"\").split(s).filter((t=>t)).map((t=>({[n]:this.trim(t),value:this.trim(t)})));if(\"number\"==typeof t&&(t=t.toString()),\"string\"==typeof t){if(!t.trim())return[];t=h(t)}else l&&(t=[].concat(...t.map((t=>null!=t.value?t:h(t)))));return r&&!d&&(t.forEach((t=>{var e=o.map((t=>t.value)),i=this.dropdown.filterListItems.call(this,t[n],{exact:!0});this.settings.duplicates||(i=i.filter((t=>!e.includes(t.value))));var s=i.length>1?this.getWhitelistItem(t[n],n,i):i[0];s&&s instanceof Object?o.push(s):\"mix\"!=a&&(null==t.value&&(t.value=t[n]),o.push(t))})),o.length&&(t=o)),t},parseMixTags(t){var e=this.settings,i=e.mixTagsInterpolator,s=e.duplicates,a=e.transformTag,n=e.enforceWhitelist,o=e.maxTags,r=e.tagTextProp,l=[];return t=t.split(i[0]).map(((t,e)=>{var d,h,g,p=t.split(i[1]),c=p[0],u=l.length==o;try{if(c==+c)throw Error;h=JSON.parse(c)}catch(t){h=this.normalizeTags(c)[0]||{value:c}}if(a.call(this,h),u||!(p.length>1)||n&&!this.isTagWhitelisted(h.value)||!s&&this.isTagDuplicate(h.value)){if(t)return e?i[0]+t:t}else h[d=h[r]?r:\"value\"]=this.trim(h[d]),g=this.createTagElem(h),l.push(h),g.classList.add(this.settings.classNames.tagNoAnimation),p[0]=g.outerHTML,this.value.push(h);return p.join(\"\")})).join(\"\"),this.DOM.input.innerHTML=t,this.DOM.input.appendChild(document.createTextNode(\"\")),this.DOM.input.normalize(),this.getTagElms().forEach(((t,e)=>T(t,l[e]))),this.update({withoutChangeEvent:!0}),t},replaceTextWithNode(t,e){if(this.state.tag||e){e=e||this.state.tag.prefix+this.state.tag.value;var i,s,a=this.state.selection||window.getSelection(),n=a.anchorNode,o=this.state.tag.delimiters?this.state.tag.delimiters.length:0;return n.splitText(a.anchorOffset-o),-1==(i=n.nodeValue.lastIndexOf(e))?!0:(s=n.splitText(i),t&&n.parentNode.replaceChild(t,s),!0)}},selectTag(t,e){var i=this.settings;if(!i.enforceWhitelist||this.isTagWhitelisted(e.value)){this.input.set.call(this,e[i.tagTextProp]||e.value,!0),this.state.actions.selectOption&&setTimeout((()=>this.setRangeAtStartEnd(!1,this.DOM.input)));var s=this.getLastTag();return s?this.replaceTag(s,e):this.appendTag(t),this.value[0]=e,this.update(),this.trigger(\"add\",{tag:t,data:e}),[t]}},addEmptyTag(t){var e=g({value:\"\"},t||{}),i=this.createTagElem(e);T(i,e),this.appendTag(i),this.editTag(i,{skipValidation:!0})},addTags(t,e,i){var s=[],a=this.settings,n=[],o=document.createDocumentFragment();if(i=i||a.skipInvalid,!t||0==t.length)return s;switch(t=this.normalizeTags(t),a.mode){case\"mix\":return this.addMixTags(t);case\"select\":e=!1,this.removeAllTags()}return this.DOM.input.removeAttribute(\"style\"),t.forEach((t=>{var e,r={},l=Object.assign({},t,{value:t.value+\"\"});if(t=Object.assign({},l),a.transformTag.call(this,t),t.__isValid=this.hasMaxTags()||this.validateTag(t),!0!==t.__isValid){if(i)return;if(g(r,this.getInvalidTagAttrs(t,t.__isValid),{__preInvalidData:l}),t.__isValid==this.TEXTS.duplicate&&this.flashTag(this.getTagElmByValue(t.value)),!a.createInvalidTags)return void n.push(t.value)}if(\"readonly\"in t&&(t.readonly?r[\"aria-readonly\"]=!0:delete t.readonly),e=this.createTagElem(t,r),s.push(e),\"select\"==a.mode)return this.selectTag(e,t);o.appendChild(e),t.__isValid&&!0===t.__isValid?(this.value.push(t),this.trigger(\"add\",{tag:e,index:this.value.length-1,data:t})):(this.trigger(\"invalid\",{data:t,index:this.value.length,tag:e,message:t.__isValid}),a.keepInvalidTags||setTimeout((()=>this.removeTags(e,!0)),1e3)),this.dropdown.position()})),this.appendTag(o),this.update(),t.length&&e&&(this.input.set.call(this,a.createInvalidTags?\"\":n.join(a._delimiters)),this.setRangeAtStartEnd(!1,this.DOM.input)),a.dropdown.enabled&&this.dropdown.refilter(),s},addMixTags(t){if((t=this.normalizeTags(t))[0].prefix||this.state.tag)return this.prefixedTextToTag(t[0]);var e=document.createDocumentFragment();return t.forEach((t=>{var i=this.createTagElem(t);e.appendChild(i)})),this.appendMixTags(e),e},appendMixTags(t){var e=!!this.state.selection;e?this.injectAtCaret(t):(this.DOM.input.focus(),(e=this.setStateSelection()).range.setStart(this.DOM.input,e.range.endOffset),e.range.setEnd(this.DOM.input,e.range.endOffset),this.DOM.input.appendChild(t),this.updateValueByDOMTags(),this.update())},prefixedTextToTag(t){var e,i=this.settings,s=this.state.tag.delimiters;if(i.transformTag.call(this,t),t.prefix=t.prefix||this.state.tag?this.state.tag.prefix:(i.pattern.source||i.pattern)[0],e=this.createTagElem(t),this.replaceTextWithNode(e)||this.DOM.input.appendChild(e),setTimeout((()=>e.classList.add(this.settings.classNames.tagNoAnimation)),300),this.value.push(t),this.update(),!s){var a=this.insertAfterTag(e)||e;setTimeout(this.placeCaretAfterNode,0,a)}return this.state.tag=null,this.trigger(\"add\",g({},{tag:e},{data:t})),e},appendTag(t){var e=this.DOM,i=e.input;e.scope.insertBefore(t,i)},createTagElem(t,i){t.__tagId=m();var s,a=g({},t,e({value:d(t.value+\"\")},i));return function(t){for(var e,i=document.createNodeIterator(t,NodeFilter.SHOW_TEXT,null,!1);e=i.nextNode();)e.textContent.trim()||e.parentNode.removeChild(e)}(s=this.parseTemplate(\"tag\",[a,this])),T(s,t),s},reCheckInvalidTags(){var t=this.settings;this.getTagElms(t.classNames.tagNotAllowed).forEach(((e,i)=>{var s=T(e),a=this.hasMaxTags(),n=this.validateTag(s),o=!0===n&&!a;if(\"select\"==t.mode&&this.toggleScopeValidation(n),o)return s=s.__preInvalidData?s.__preInvalidData:{value:s.value},this.replaceTag(e,s);e.title=a||n}))},removeTags(t,e,i){var s,a=this.settings;if(t=t&&t instanceof HTMLElement?[t]:t instanceof Array?t:t?[t]:[this.getLastTag()],s=t.reduce(((t,e)=>{e&&\"string\"==typeof e&&(e=this.getTagElmByValue(e));var i=T(e);return e&&i&&!i.readonly&&t.push({node:e,idx:this.getTagIdx(i),data:T(e,{__removed:!0})}),t}),[]),i=\"number\"==typeof i?i:this.CSSVars.tagHideTransition,\"select\"==a.mode&&(i=0,this.input.set.call(this)),1==s.length&&\"select\"!=a.mode&&s[0].node.classList.contains(a.classNames.tagNotAllowed)&&(e=!0),s.length)return a.hooks.beforeRemoveTag(s,{tagify:this}).then((()=>{function t(t){t.node.parentNode&&(t.node.parentNode.removeChild(t.node),e?a.keepInvalidTags&&this.trigger(\"remove\",{tag:t.node,index:t.idx}):(this.trigger(\"remove\",{tag:t.node,index:t.idx,data:t.data}),this.dropdown.refilter(),this.dropdown.position(),this.DOM.input.normalize(),a.keepInvalidTags&&this.reCheckInvalidTags()))}i&&i>10&&1==s.length?function(e){e.node.style.width=parseFloat(window.getComputedStyle(e.node).width)+\"px\",document.body.clientTop,e.node.classList.add(a.classNames.tagHide),setTimeout(t.bind(this),i,e)}.call(this,s[0]):s.forEach(t.bind(this)),e||(this.removeTagsFromValue(s.map((t=>t.node))),this.update(),\"select\"==a.mode&&this.setContentEditable(!0))})).catch((t=>{}))},removeTagsFromDOM(){[].slice.call(this.getTagElms()).forEach((t=>t.parentNode.removeChild(t)))},removeTagsFromValue(t){(t=Array.isArray(t)?t:[t]).forEach((t=>{var e=T(t),i=this.getTagIdx(e);i>-1&&this.value.splice(i,1)}))},removeAllTags(t){t=t||{},this.value=[],\"mix\"==this.settings.mode?this.DOM.input.innerHTML=\"\":this.removeTagsFromDOM(),this.dropdown.refilter(),this.dropdown.position(),this.state.dropdown.visible&&setTimeout((()=>{this.DOM.input.focus()})),\"select\"==this.settings.mode&&(this.input.set.call(this),this.setContentEditable(!0)),this.update(t)},postUpdate(){this.state.blockChangeEvent=!1;var t=this.settings,e=t.classNames,i=\"mix\"==t.mode?t.mixMode.integrated?this.DOM.input.textContent:this.DOM.originalInput.value.trim():this.value.length+this.input.raw.call(this).length;this.toggleClass(e.hasMaxTags,this.value.length>=t.maxTags),this.toggleClass(e.hasNoTags,!this.value.length),this.toggleClass(e.empty,!i),\"select\"==t.mode&&this.toggleScopeValidation(this.value?.[0]?.__isValid)},setOriginalInputValue(t){var e=this.DOM.originalInput;this.settings.mixMode.integrated||(e.value=t,e.tagifyValue=e.value,this.setPersistedData(t,\"value\"))},update(t){clearTimeout(this.debouncedUpdateTimeout),this.debouncedUpdateTimeout=setTimeout(function(){var e=this.getInputValue();this.setOriginalInputValue(e),this.settings.onChangeAfterBlur&&(t||{}).withoutChangeEvent||this.state.blockChangeEvent||this.triggerChangeEvent();this.postUpdate()}.bind(this),100)},getInputValue(){var t=this.getCleanValue();return\"mix\"==this.settings.mode?this.getMixedTagsAsString(t):t.length?this.settings.originalInputValueFormat?this.settings.originalInputValueFormat(t):JSON.stringify(t):\"\"},getCleanValue(t){return a(t||this.value,this.dataProps)},getMixedTagsAsString(){var t=\"\",e=this,i=this.settings,s=i.originalInputValueFormat||JSON.stringify,a=i.mixTagsInterpolator;return function i(o){o.childNodes.forEach((o=>{if(1==o.nodeType){const r=T(o);if(\"BR\"==o.tagName&&(t+=\"\\r\\n\"),r&&v.call(e,o)){if(r.__removed)return;t+=a[0]+s(n(r,e.dataProps))+a[1]}else o.getAttribute(\"style\")||[\"B\",\"I\",\"U\"].includes(o.tagName)?t+=o.textContent:\"DIV\"!=o.tagName&&\"P\"!=o.tagName||(t+=\"\\r\\n\",i(o))}else t+=o.textContent}))}(this.DOM.input),t}},N.prototype.removeTag=N.prototype.removeTags,N}));\n","// TODO: Tagify and rollup using vite with .js?\r\nimport { onManageActiveEffect, prepareActiveEffectCategories } from \"../helpers/effects.mjs\";\r\nimport { onManageRule } from \"../rules/rules.mjs\";\r\nimport { options } from \"../rules/rule-field.mjs\";\r\nimport Tagify from \"@yaireo/tagify\";\r\n\r\n/**\r\n * Extend the basic ItemSheet with some very simple modifications\r\n * @extends {ItemSheet}\r\n */\r\nexport class AbbrewItemSheet extends ItemSheet {\r\n\r\n  /** @override */\r\n  static get defaultOptions() {\r\n    return mergeObject(super.defaultOptions, {\r\n      classes: [\"abbrew\", \"sheet\", \"item\"],\r\n      width: 520,\r\n      height: 480,\r\n      tabs: [{ navSelector: \".sheet-tabs\", contentSelector: \".sheet-body\", initial: \"description\" }]\r\n    });\r\n  }\r\n\r\n  /** @override */\r\n  get template() {\r\n    const path = \"systems/abbrew/templates/item\";\r\n    // Return a single sheet for all item types.\r\n    // return `${path}/item-sheet.html`;\r\n\r\n    // Alternatively, you could use the following return statement to do a\r\n    // unique item sheet by type, like `weapon-sheet.html`.\r\n    return `${path}/item-${this.item.type}-sheet.hbs`;\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n\r\n  /** @override */\r\n  async getData() {\r\n    // Retrieve base data structure.\r\n    const context = super.getData();\r\n\r\n    // Use a safe clone of the item data for further operations.\r\n    const itemData = context.item;\r\n\r\n    // Retrieve the roll data for TinyMCE editors.\r\n    context.rollData = {};\r\n    let actor = this.object?.parent ?? null;\r\n    if (actor) {\r\n      context.rollData = actor.getRollData();\r\n    }\r\n\r\n    // Prepare active effects\r\n    context.effects = prepareActiveEffectCategories(this.item.effects);\r\n\r\n    // Add the actor's data to context.data for easier access, as well as flags.\r\n    context.system = itemData.system;\r\n    context.flags = itemData.flags;\r\n    context.system.enrichedDescription = await TextEditor.enrichHTML(context.system.description, {\r\n      async: true,\r\n      relativeTo: this,\r\n      links: true\r\n    });\r\n\r\n    return context;\r\n  }\r\n\r\n  /* -------------------------------------------- */\r\n\r\n  /** @override */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n\r\n    // Everything below here is only needed if the sheet is editable\r\n    if (!this.isEditable) {\r\n      return;\r\n    }\r\n\r\n    // Weapon\r\n    const requirements = html[0].querySelector('input[name=\"system.weapon.requirements\"]');\r\n    if (requirements) {\r\n      var taggedRequirements = new Tagify(requirements, {});\r\n    }\r\n\r\n    // Armour\r\n    const form = html[0].querySelector('input[name=\"system.armour.form\"]');\r\n    if (form) {\r\n      var taggedForm = new Tagify(form, {});\r\n    }\r\n    const anatomy = html[0].querySelector('input[name=\"system.armour.anatomy\"]');\r\n    if (anatomy) {\r\n      var taggedAnatomy = new Tagify(anatomy, {});\r\n    }\r\n    const type = html[0].querySelector('input[name=\"system.armour.type\"]');\r\n    if (type) {\r\n      var taggedType = new Tagify(type, {});\r\n    }\r\n    const armourPoints = html[0].querySelector('input[name=\"system.armour.armourPoints\"]');\r\n    if (type) {\r\n      var taggedArmourPoints = new Tagify(armourPoints, {});\r\n    }\r\n\r\n    // Active Effect management\r\n    html.find(\".effect-control\").click(ev => onManageActiveEffect(ev, this.item));\r\n\r\n    // Rules management\r\n    html.find(\".rule-control\").click(async ev => await onManageRule(ev, this.item));\r\n\r\n    // Render child item sheet for viewing/editing prior to the editable check.\r\n    html.find('.item-edit').click(ev => {\r\n      const li = $(ev.currentTarget).parents(\".item\");\r\n      const item = this.actor.items.get(li.data(\"itemId\"));\r\n      item.sheet.render(true);\r\n    });\r\n\r\n    // Roll handlers, click handlers, etc. would go here.\r\n  }\r\n\r\n  async _updateObject(event, formData) {\r\n    if ((event.handleObj && event.handleObj.type == 'change') || (event.type && event.type == 'change')) {\r\n\r\n      if (event.currentTarget) {\r\n        await this.manualUpdate(event, formData);\r\n      }\r\n      else {\r\n        super._updateObject(event, formData);\r\n      }\r\n    } else {\r\n      super._updateObject(event, formData);\r\n    }\r\n  }\r\n\r\n  async manualUpdate(event, formData) {\r\n    const target = event.currentTarget;\r\n    if (target.classList.contains(\"rule-editor\")) {\r\n      const dataset = target.dataset;\r\n      const ruleId = dataset.ruleId;\r\n      const field = dataset.field;\r\n      const updateData = formData[target.name];\r\n      let rules = foundry.utils.deepClone(this.item.system.rules);\r\n      const index = rules.findIndex(r => r.id == ruleId);\r\n      rules[index][field] = updateData;\r\n      if (field == \"type\") {\r\n        rules[index].content = options[updateData].template();\r\n      }\r\n      return await this.item.update({\r\n        \"system.rules\": rules\r\n      });\r\n    } else {\r\n      super._updateObject(event, formData);\r\n    }\r\n  }\r\n\r\n  close(options = {}) {\r\n    console.log('closing sheet');\r\n    // this.getData();\r\n    options.submit = false;\r\n    super.close(options);\r\n  }\r\n}\r\n","import { AbbrewItemSheet } from \"./item-sheet.mjs\";\r\nimport Tagify from \"@yaireo/tagify\";\r\n\r\n\r\nexport class AbbrewItemAnatomySheet extends AbbrewItemSheet {\r\n    /** @override */\r\n    activateListeners(html) {\r\n        super.activateListeners(html);\r\n        const requirements = html[0].querySelector('input[name=\"system.tags\"]');\r\n        if (requirements) {\r\n            var taggedRequirements = new Tagify(requirements, {});\r\n        }\r\n        const armourPoints = html[0].querySelector('input[name=\"system.armourPoints\"]');\r\n        if (requirements) {\r\n            var taggedArmourPoints = new Tagify(armourPoints, {});\r\n        }\r\n    }\r\n\r\n    /** @override */\r\n    get template() {\r\n        const path = \"systems/abbrew/templates/item\";\r\n        // Return a single sheet for all item types.\r\n        // return `${path}/item-sheet.html`;\r\n\r\n        // Alternatively, you could use the following return statement to do a\r\n        // unique item sheet by type, like `weapon-sheet.html`.\r\n        return `${path}/item-anatomy-sheet.hbs`;\r\n    }\r\n\r\n}","/**\r\n * Define a set of template paths to pre-load\r\n * Pre-loaded templates are compiled and cached for fast access when rendering\r\n * @return {Promise}\r\n */\r\nexport const preloadHandlebarsTemplates = async function () {\r\n  return loadTemplates([\r\n\r\n    // Actor partials.\r\n    \"systems/abbrew/templates/actor/parts/actor-features.hbs\",\r\n    \"systems/abbrew/templates/actor/parts/actor-items.hbs\",\r\n    \"systems/abbrew/templates/actor/parts/actor-anatomy.hbs\",\r\n    \"systems/abbrew/templates/actor/parts/actor-resources.hbs\",\r\n    \"systems/abbrew/templates/actor/parts/actor-spells.hbs\",\r\n    \"systems/abbrew/templates/actor/parts/actor-effects.hbs\",\r\n    \"systems/abbrew/templates/actor/parts/actor-attacks.hbs\",\r\n    \"systems/abbrew/templates/actor/parts/actor-defences.hbs\",\r\n    \"systems/abbrew/templates/actor/parts/actor-armour.hbs\",\r\n    \"systems/abbrew/templates/actor/parts/actor-form.hbs\",\r\n    \"systems/abbrew/templates/actor/parts/actor-conditions.hbs\",\r\n    \"systems/abbrew/templates/parts/active-effects.hbs\",\r\n    \"systems/abbrew/templates/chat/damage-roll.hbs\",\r\n    \"systems/abbrew/templates/parts/item-rules.hbs\"\r\n  ]);\r\n};\r\n","export default class AbbrewRoll extends Roll {\r\n    constructor(formula, data, options) {\r\n        super(formula, data, options);\r\n        if (!this.options.configured) {\r\n            this._configureModifiers();\r\n        }\r\n    }\r\n\r\n    static async fromRoll(roll) {\r\n        const newRoll = new this(roll.formula, roll.data, roll.options);\r\n        await newRoll.evaluate({async: true});\r\n        return newRoll;\r\n    }\r\n\r\n    get validD10Roll() {\r\n        return (this.terms[0].rolls[0].terms[0] instanceof Die) && (this.terms[0].rolls[0].terms[0].faces === 10);\r\n    }\r\n\r\n    static EVALUATION_TEMPLATE = \"systems/abbrew/templates/chat/roll-dialog.hbs\";\r\n\r\n    static CHAT_TEMPLATE = \"systems/abbrew/templates/chat/damage-roll.hbs\";\r\n\r\n    async render(flavor, template, isPrivate) {\r\n        template = this.CHAT_TEMPLATE;\r\n\r\n        return super.render(flavor, template, isPrivate);\r\n    }\r\n\r\n    /** @inheritdoc */\r\n    async toMessage(messageData = {}, options = {}) {\r\n\r\n        // return early for invalid roll formula\r\n        if (!this.validD10Roll) {\r\n            return;\r\n        }\r\n\r\n        // Evaluate the roll now so we have the results available to determine whether reliable talent came into play\r\n        if (!this._evaluated) await this.evaluate({ async: true });\r\n\r\n        // Add appropriate advantage mode message flavor and dnd5e roll flags\r\n        // messageData.flavor = messageData.flavor || this.options.flavor;\r\n        // if (this.hasAdvantage) messageData.flavor += ` (${game.i18n.localize(\"DND5E.Advantage\")})`;\r\n        // else if (this.hasDisadvantage) messageData.flavor += ` (${game.i18n.localize(\"DND5E.Disadvantage\")})`;\r\n\r\n        // Add reliable talent to the d20-term flavor text if it applied\r\n        // if (this.validD20Roll && this.options.reliableTalent) {\r\n        //     const d20 = this.dice[0];\r\n        //     const isRT = d20.results.every(r => !r.active || (r.result < 10));\r\n        //     const label = `(${game.i18n.localize(\"DND5E.FlagsReliableTalent\")})`;\r\n        //     if (isRT) d20.options.flavor = d20.options.flavor ? `${d20.options.flavor} (${label})` : label;\r\n        // }\r\n\r\n        // Record the preferred rollMode\r\n        options.rollMode = options.rollMode ?? this.options.rollMode;\r\n        // messageData.flags = { data: { foo: \"bar\", baz: \"fuck\" } };\r\n        return super.toMessage(messageData, options);\r\n    }\r\n\r\n    async configureDialog({ title, template } = {}, options = {}) {\r\n\r\n        // Render the Dialog inner HTML\r\n        const content = await renderTemplate(template ?? this.constructor.EVALUATION_TEMPLATE, {\r\n            formula: `d10!`\r\n        });\r\n\r\n        let defaultButton = \"normal\";\r\n        // switch ( defaultAction ) {\r\n        //   case D20Roll.ADV_MODE.ADVANTAGE: defaultButton = \"advantage\"; break;\r\n        //   case D20Roll.ADV_MODE.DISADVANTAGE: defaultButton = \"disadvantage\"; break;\r\n        // }\r\n\r\n        // Create the Dialog window and await submission of the form\r\n        return new Promise(resolve => {\r\n            new Dialog({\r\n                title,\r\n                content,\r\n                buttons: {\r\n                    advantage: {\r\n                        label: \"1\"/* game.i18n.localize(\"DND5E.Advantage\") */,\r\n                        callback: html => resolve(this._onDialogSubmit(html/* , D20Roll.ADV_MODE.ADVANTAGE */))\r\n                    },\r\n                    normal: {\r\n                        label: \"2\"/* game.i18n.localize(\"DND5E.Normal\") */,\r\n                        callback: html => resolve(this._onDialogSubmit(html/* , D20Roll.ADV_MODE.NORMAL */))\r\n                    },\r\n                    disadvantage: {\r\n                        label: \"3\"/* game.i18n.localize(\"DND5E.Disadvantage\") */,\r\n                        callback: html => resolve(this._onDialogSubmit(html/* , D20Roll.ADV_MODE.DISADVANTAGE */))\r\n                    }\r\n                },\r\n                default: defaultButton,\r\n                close: () => resolve(null)\r\n            }, options).render(true);\r\n        });\r\n    }\r\n\r\n    // async RollAbbrew(element, dataset, actor) {\r\n\r\n    //   // Handle item rolls.\r\n    //   if (dataset.rollType) {\r\n    //     if (dataset.rollType == 'item') {\r\n    //       const itemId = element.closest('.item').dataset.itemId;\r\n    //       const item = actor.items.get(itemId);\r\n    //       if (item) {\r\n    //         return await ChatAbbrew(actor, item);\r\n    //         //   let label = item.name;\r\n    //         //   let roll = new Roll(\"d10! + \" + item.system.formula, actor.getRollData());\r\n    //         //   roll.toMessage({\r\n    //         //     speaker: ChatMessage.getSpeaker({ actor: actor }),\r\n    //         //     flavor: label,\r\n    //         //     rollMode: game.settings.get('core', 'rollMode'),\r\n    //         //   });\r\n    //         //   Hooks.callAll('abbrew.ability', label);\r\n    //         //   return roll;\r\n    //       }\r\n    //     }\r\n    //   }\r\n\r\n    //   // Handle rolls that supply the formula directly.\r\n    //   if (dataset.ability) {\r\n    //     let label = dataset.label ? `[ability] ${dataset.label}` : '';\r\n    //     let roll = new Roll(\"d10 + \" + dataset.ability, actor.getRollData());\r\n    //     roll.toMessage({\r\n    //       speaker: ChatMessage.getSpeaker({ actor: actor }),\r\n    //       flavor: label,\r\n    //       rollMode: game.settings.get('core', 'rollMode'),\r\n    //     });\r\n    //     Hooks.callAll('abbrew.ability', label);\r\n    //     return roll;\r\n    //   }\r\n    // }\r\n\r\n    _onDialogSubmit(html, advantageMode) {\r\n        const form = html[0].querySelector(\"form\");\r\n\r\n        // // Append a situational bonus term\r\n        // if (form.bonus.value) {\r\n        //   const bonus = new Roll(form.bonus.value, this.data);\r\n        //   if (!(bonus.terms[0] instanceof OperatorTerm)) this.terms.push(new OperatorTerm({ operator: \"+\" }));\r\n        //   this.terms = this.terms.concat(bonus.terms);\r\n        // }\r\n\r\n        if (form.weakOrStrong.value) {\r\n            const weakOrStrong = form.weakOrStrong.value;\r\n            if (weakOrStrong < 0) {\r\n                this.options.weak = true;\r\n                this.options.weakValue = Math.abs(weakOrStrong)\r\n            }\r\n            else if (weakOrStrong > 0) {\r\n                this.options.strong = true;\r\n                this.options.strongValue = Math.abs(weakOrStrong)\r\n            }\r\n        }\r\n\r\n        // // Customize the modifier\r\n        // if (form.ability?.value) {\r\n        //   const abl = this.data.statistics[form.ability.value];\r\n        //   this.terms = this.terms.flatMap(t => {\r\n        //     if (t.term === \"@mod\") return new NumericTerm({ number: abl.mod });\r\n        //     if (t.term === \"@abilityCheckBonus\") {\r\n        //       const bonus = abl.bonuses?.check;\r\n        //       if (bonus) return new Roll(bonus, this.data).terms;\r\n        //       return new NumericTerm({ number: 0 });\r\n        //     }\r\n        //     return t;\r\n        //   });\r\n        //   this.options.flavor += ` (${CONFIG.DND5E.statistics[form.ability.value]})`;\r\n        // }\r\n\r\n        // Apply advantage or disadvantage\r\n        // this.options.advantageMode = advantageMode;\r\n        // this.options.rollMode = form.rollMode.value;\r\n        this._configureModifiers();\r\n        return this;\r\n\r\n        // let roll = new Roll(\"d10\", {});\r\n        // roll.toMessage({\r\n        //     speaker: ChatMessage.getSpeaker({ actor: this.actor }),\r\n        //     flavor: \"label\",\r\n        //     rollMode: game.settings.get('core', 'rollMode'),\r\n        // });\r\n        // return roll;\r\n    }\r\n\r\n    _configureModifiers() {\r\n        const d10 = this.terms[0].rolls[0];\r\n\r\n        if (this.options.weak) {\r\n            d10.terms[4].number += this.options.weakValue;\r\n        }\r\n\r\n        if (this.options.strong) {\r\n            d10.terms[0].number += this.options.strongValue;\r\n        }\r\n\r\n        // d10.number = 3;\r\n\r\n        this._formula = this.constructor.getFormula(this.terms);\r\n\r\n        this.options.configured = true;\r\n    }\r\n}","export async function handleTurnStart(combat, updateData, updateOptions) {\r\n    if (updateData.round < combat.round || (updateData.round == combat.round && updateData.turn < combat.turn)) {\r\n        return;\r\n    }\r\n    let nextActor = combat.current.combatantId ? combat.nextCombatant.actor : combat.turns[0].actor;\r\n    await turnStart(nextActor);\r\n}\r\n\r\nasync function turnStart(actor) {\r\n    ChatMessage.create({ content: `${actor.name} starts their turn`, speaker: ChatMessage.getSpeaker({ actor: actor }) });\r\n\r\n    if (actor.system.canBleed) {\r\n        let activeWounds = actor.system.wounds.active;\r\n        console.log(activeWounds);\r\n\r\n        let currentBlood = actor.system.blood.value;\r\n        console.log(currentBlood);\r\n\r\n        let bleedPrevention = actor.system.conditions.bleedPrevention;\r\n        if (bleedPrevention > 0) {\r\n            bleedPrevention = bleedPrevention < activeWounds ? bleedPrevention : activeWounds;\r\n            let healingWounds = actor.system.wounds.healing + bleedPrevention;\r\n            await actor.update({ \"system.wounds.healing\": healingWounds });\r\n        }\r\n\r\n        activeWounds = activeWounds - bleedPrevention;\r\n        await actor.update({ system: { wounds: { active: activeWounds } } });\r\n\r\n        let gushingWounds = 0;\r\n        if (activeWounds === 0) {\r\n            await actor.update({ \"system.conditions.gushingWounds\": 0 });\r\n        }\r\n\r\n        if (actor.system.conditions.gushingWounds > 0) {\r\n            gushingWounds = actor.system.conditions.gushingWounds * 5;\r\n        }\r\n\r\n        let newBlood = Math.max(currentBlood - (activeWounds + gushingWounds), 0);\r\n        console.log(newBlood);\r\n\r\n        if (newBlood != currentBlood) {\r\n            await actor.update({ \"system.blood.value\": newBlood });\r\n        }\r\n\r\n        if (newBlood <= actor.system.blood.nausea) {\r\n            await actor.update({ \"system.conditions.nausea\": 1 });\r\n        } else {\r\n            await actor.update({ \"system.conditions.nausea\": 0 });\r\n        }\r\n\r\n        if (newBlood <= actor.system.blood.unconscious) {\r\n            await actor.update({ \"system.conditions.unconscious\": 1 });\r\n        } else {\r\n            await actor.update({ \"system.conditions.unconscious\": 0 });\r\n        }\r\n    }\r\n\r\n    let armour = actor.system.armour;\r\n    let newArmour = armour.value;\r\n    console.log('Armour: ', armour);\r\n\r\n    if (armour.value < armour.max) {\r\n        getOut: if (actor.effects.find(e => e.label === \"Regenerating\")) {\r\n            console.log('Check for regain Armour');\r\n            // TODO: Replace with Exposed\r\n            if (actor.effects.find(e => e.label === \"Weakened\")) {\r\n                console.log('Exposed so no armour regained');\r\n                break getOut;\r\n            }\r\n\r\n            let armourMultiplier = 1;\r\n            // TODO: Was to be from sundered. just reduce max for that.\r\n            if (actor.effects.find(e => e.label === \"Cursed\")) {\r\n                armourMultiplier = 0.5;\r\n            }\r\n\r\n            console.log('Regain Armour');\r\n            let missingArmour = armour.max - armour.value;\r\n            console.log('Missing Armour: ', missingArmour);\r\n\r\n            newArmour = armour.value + Math.max(Math.floor((missingArmour * armourMultiplier) / 2), 1);\r\n            console.log('newArmour', newArmour);\r\n\r\n        }\r\n    } else {\r\n        newArmour = armour.max;\r\n    }\r\n\r\n    await actor.update({ \"system.armour.value\": newArmour });\r\n}","import { AbbrewItemSheet } from \"./item-sheet.mjs\";\r\nimport Tagify from \"@yaireo/tagify\";\r\n\r\n\r\nexport class AbbrewItemFormSheet extends AbbrewItemSheet {\r\n    /** @override */\r\n    activateListeners(html) {\r\n        super.activateListeners(html);\r\n        const requirements = html[0].querySelector('input[name=\"system.tags\"]');\r\n        if (requirements) {\r\n            var taggedRequirements = new Tagify(requirements, {});\r\n        }\r\n    }\r\n\r\n    /** @override */\r\n    get template() {\r\n        const path = \"systems/abbrew/templates/item\";\r\n        // Return a single sheet for all item types.\r\n        // return `${path}/item-sheet.html`;\r\n\r\n        // Alternatively, you could use the following return statement to do a\r\n        // unique item sheet by type, like `weapon-sheet.html`.\r\n        return `${path}/item-form-sheet.hbs`;\r\n    }\r\n\r\n}","// Import document classes.\r\nimport { AbbrewActor } from \"./documents/actor.mjs\";\r\nimport { AbbrewItem } from \"./documents/item.mjs\";\r\n// Import sheet classes.\r\nimport { AbbrewActorSheet } from \"./sheets/actor-sheet.mjs\";\r\nimport { AbbrewItemSheet } from \"./sheets/item-sheet.mjs\";\r\nimport { AbbrewItemAnatomySheet } from \"./sheets/item-anatomy-sheet.mjs\";\r\n// Import helper/utility classes and constants.\r\nimport { preloadHandlebarsTemplates } from \"./helpers/templates.mjs\";\r\nimport { ABBREW } from \"./helpers/config.mjs\";\r\nimport AbbrewRoll from \"./helpers/abbrew-roll.mjs\";\r\nimport { handleTurnStart } from \"./helpers/turn-start.mjs\";\r\nimport { ChoiceSetPrompt } from \"./rules/choice-set-prompt.mjs\";\r\nimport { AbbrewItemFormSheet } from \"./sheets/item-form-sheet.mjs\";\r\n\r\n/* -------------------------------------------- */\r\n/*  Init Hook                                   */\r\n/* -------------------------------------------- */\r\n\r\nHooks.once('init', async function () {\r\n\r\n  Handlebars.registerHelper('json', function (context) {\r\n    return JSON.stringify(context);\r\n  });\r\n\r\n  // Add utility classes to the global game object so that they're more easily\r\n  // accessible in global contexts.\r\n  game.abbrew = {\r\n    AbbrewActor,\r\n    AbbrewItem,\r\n    rollItemMacro\r\n  };\r\n\r\n  // Add custom constants for configuration.\r\n  CONFIG.ABBREW = ABBREW;\r\n\r\n  /**\r\n   * Set an initiative formula for the system\r\n   * @type {String}\r\n   */\r\n  CONFIG.Combat.initiative = {\r\n    formula: \"1d10 + @statistics.dexterity.mod + @statistics.agility.mod + @statistics.wits.mod\",\r\n    decimals: 2\r\n  };\r\n\r\n  // Record Configuration Values\r\n  CONFIG.Dice.AbbrewRoll = AbbrewRoll;\r\n  CONFIG.Dice.rolls.push(AbbrewRoll);\r\n\r\n  // Define custom Document classes\r\n  CONFIG.Actor.documentClass = AbbrewActor;\r\n  CONFIG.Item.documentClass = AbbrewItem;\r\n\r\n  // Register sheet application classes\r\n  Actors.unregisterSheet(\"core\", ActorSheet);\r\n  Actors.registerSheet(\"abbrew\", AbbrewActorSheet, { makeDefault: true });\r\n  Items.unregisterSheet(\"core\", ItemSheet);\r\n  // Items.registerSheet(\"abbrew\", AbbrewItemSheet, { makeDefault: true });\r\n  const sheetEntries = [\r\n    [\"anatomy\", AbbrewItemAnatomySheet],\r\n    [\"item\", AbbrewItemSheet],\r\n    [\"feature\", AbbrewItemSheet],\r\n    [\"spell\", AbbrewItemSheet],\r\n    [\"resource\", AbbrewItemSheet],\r\n    [\"attack\", AbbrewItemSheet],\r\n    [\"defence\", AbbrewItemSheet],    \r\n    [\"form\", AbbrewItemFormSheet]\r\n  ]\r\n  for (const [type, Sheet] of sheetEntries) {\r\n    Items.registerSheet(\"abbrew\", Sheet, {\r\n      types: [type],\r\n      label: game.i18n.localize(ABBREW.SheetLabel, { type: type }),\r\n      makeDefault: true,\r\n    });\r\n  }\r\n\r\n  // Preload Handlebars templates.\r\n  return preloadHandlebarsTemplates();\r\n});\r\n\r\n\r\nHooks.on(\"pauseGame\", async function (paused) {\r\n  const actor = game.actors.get(\"rLEUu5Vg7QCj59dE\");\r\n  console.log('paused');\r\n  const items = actor.items;\r\n  const choices = items.map(i => ({ id: i._id, name: i.name }));\r\n  const data = { content: { promptTitle: \"Hello\", choices }, buttons: {} };\r\n  const returned = await new ChoiceSetPrompt(data).resolveSelection();\r\n  console.log(returned);\r\n  // const template = \"systems/abbrew/templates/rules/choice-set-prompt.hbs\";\r\n  // const html = await renderTemplate(template, data);\r\n  // let d = new Dialog({\r\n  //   content: html,\r\n  //   buttons: {},\r\n  //   render: html => console.log(\"Register interactivity in the rendered dialog\"),\r\n  //   close: html => console.log(\"This always is logged no matter which option is chosen\")\r\n  //  });\r\n  //  d.render(true);   \r\n});\r\n\r\n/* -------------------------------------------- */\r\n/*  Handlebars Helpers                          */\r\n/* -------------------------------------------- */\r\n\r\n// If you need to add Handlebars helpers, here are a few useful examples:\r\nHandlebars.registerHelper('concat', function () {\r\n  var outStr = '';\r\n  for (var arg in arguments) {\r\n    if (typeof arguments[arg] != 'object') {\r\n      outStr += arguments[arg];\r\n    }\r\n  }\r\n  return outStr;\r\n});\r\n\r\nHandlebars.registerHelper('toLowerCase', function (str) {\r\n  return str.toLowerCase();\r\n});\r\n\r\nHandlebars.registerHelper(\"isNumber\", function (value) {\r\n  return typeof value === \"number\";\r\n});\r\n\r\n/* -------------------------------------------- */\r\n/*  Ready Hook                                  */\r\n/* -------------------------------------------- */\r\n\r\nHooks.once(\"ready\", async function () {\r\n  // Wait to register hotbar drop hook on ready so that modules could register earlier if they want to\r\n  Hooks.on(\"hotbarDrop\", (bar, data, slot) => createItemMacro(data, slot));\r\n});\r\n\r\n/* -------------------------------------------- */\r\n/*  Hotbar Macros                               */\r\n/* -------------------------------------------- */\r\n\r\n/**\r\n * Create a Macro from an Item drop.\r\n * Get an existing item macro if one exists, otherwise create a new one.\r\n * @param {Object} data     The dropped data\r\n * @param {number} slot     The hotbar slot to use\r\n * @returns {Promise}\r\n */\r\nasync function createItemMacro(data, slot) {\r\n  // First, determine if this is a valid owned item.\r\n  if (data.type !== \"Item\") return;\r\n  if (!data.uuid.includes('Actor.') && !data.uuid.includes('Token.')) {\r\n    return ui.notifications.warn(\"You can only create macro buttons for owned Items\");\r\n  }\r\n  // If it is, retrieve it based on the uuid.\r\n  const item = await Item.fromDropData(data);\r\n\r\n  // Create the macro command using the uuid.\r\n  const command = `game.abbrew.rollItemMacro(\"${data.uuid}\");`;\r\n  let macro = game.macros.find(m => (m.name === item.name) && (m.command === command));\r\n  if (!macro) {\r\n    macro = await Macro.create({\r\n      name: item.name,\r\n      type: \"script\",\r\n      img: item.img,\r\n      command: command,\r\n      flags: { \"abbrew.itemMacro\": true }\r\n    });\r\n  }\r\n  game.user.assignHotbarMacro(macro, slot);\r\n  return false;\r\n}\r\n\r\n/**\r\n * Create a Macro from an Item drop.\r\n * Get an existing item macro if one exists, otherwise create a new one.\r\n * @param {string} itemUuid\r\n */\r\nfunction rollItemMacro(itemUuid) {\r\n  // Reconstruct the drop data so that we can load the item.\r\n  const dropData = {\r\n    type: 'Item',\r\n    uuid: itemUuid\r\n  };\r\n  // Load the item from the uuid.\r\n  Item.fromDropData(dropData).then(item => {\r\n    // Determine if the item loaded and if it's an owned item.\r\n    if (!item || !item.parent) {\r\n      const itemName = item?.name ?? itemUuid;\r\n      return ui.notifications.warn(`Could not find item ${itemName}. You may need to delete and recreate this macro.`);\r\n    }\r\n\r\n    // Trigger the item roll\r\n    item.roll();\r\n  });\r\n}\r\n\r\nHooks.on(\"renderChatLog\", (app, html, data) => {\r\n  AbbrewActor.chatListeners(html);\r\n  AbbrewItem.chatListeners(html);\r\n});\r\n\r\nHooks.on(\"abbrew.ability\", function (ability) {\r\n  console.log(\"Hooked on \" + ability);\r\n});\r\n\r\nHooks.once(\"dragRuler.ready\", (SpeedProvider) => {\r\n  class AbbrewSpeedProvider extends SpeedProvider {\r\n    get colors() {\r\n      return [\r\n        { id: \"walk\", default: 0x00FF00, name: \"abbrew.speeds.walk\" },\r\n        { id: \"dash\", default: 0xFFFF00, name: \"abbrew.speeds.dash\" },\r\n        { id: \"run\", default: 0xFF8000, name: \"abbrew.speeds.run\" }\r\n      ]\r\n    }\r\n\r\n    getRanges(token) {\r\n      const baseSpeed = token.actor.system.movement.base\r\n\r\n      // A character can always walk it's base speed and dash twice it's base speed\r\n      const ranges = [\r\n        { range: baseSpeed, color: \"walk\" },\r\n        { range: baseSpeed * 2, color: \"dash\" },\r\n        { range: baseSpeed * 3, color: \"run\" }\r\n      ]\r\n\r\n      return ranges\r\n    }\r\n  }\r\n\r\n  dragRuler.registerSystem(\"abbrew\", AbbrewSpeedProvider)\r\n})\r\n\r\n// Combat Start Hooks\r\n\r\nHooks.on(\"combatStart\", async (combat, updateData, updateOptions) => {\r\n  await handleTurnStart(combat, updateData, updateOptions);\r\n});\r\n\r\nHooks.on(\"combatRound\", async (combat, updateData, updateOptions) => {\r\n  await handleTurnStart(combat, updateData, updateOptions);\r\n})\r\n\r\nHooks.on(\"combatTurn\", async (combat, updateData, updateOptions) => {\r\n  await handleTurnStart(combat, updateData, updateOptions);\r\n})\r\n\r\n// Update Hooks\r\n\r\nHooks.on(\"updateActor\", (value) => {\r\n  console.log('ActorUpdated');\r\n})\r\n\r\nHooks.on(\"updateToken\", (value) => {\r\n  console.log('TokenUpdated');\r\n})"],"names":["options","choices","uuid","key","this","t","e","i","s","a","n","o","r","l","d","h","g","p","c","u","m","v","f","Tagify"],"mappings":"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","x_google_ignoreList":[16]}